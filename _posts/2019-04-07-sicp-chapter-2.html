---
layout: page
title: SICP Chapter 2 Exercises & Solutions
category: note
tags: 
- post
- SICP
- solutions
---
<style>
.outline-text-3 > p.verse {
    background-color: #eee8d5;
    font: italic 400 1.0em Calibri,-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol" !important;
    padding: 1em;
    padding-left: 1.5em;
    border-left: 3px solid #2aa198;
}
</style>


<section id="outline-container-orgf583982" class="outline-2">
<h2 id="orgf583982"></h2>
<div class="outline-text-2" id="text-orgf583982">
<p>
The HTML for this page has been automatically generated by parsing the loosely
formatted source code &amp; comments included in my solutions repository
(<a href="https://github.com/zv/SICP-guile">https://github.com/zv/SICP-guile</a>), if you encounter any unformatted
solutions, you think you've spotted an error or you have something you'd like
to share about the exercises, don't hesitate to leave a comment below
(or a pull request on the source repo).
</p>
</div>
</section>

<section id="outline-container-orgca3c73b" class="outline-2">
<h2 id="orgca3c73b">Exercises Chapter 2</h2>
<div class="outline-text-2" id="text-orgca3c73b">
</div>
<div id="outline-container-org504ad72" class="outline-3">
<h3 id="org504ad72">Exercise: 2.1</h3>
<div class="outline-text-3" id="text-org504ad72">
<p class="verse">
Define a better version of `make-rat' that handles both positive and<br>
negative arguments. `Make-rat' should normalize the sign so that if the<br>
rational number is positive, both the numerator and denominator are<br>
positive, and if the rational number is negative, only the numerator is<br>
negative.<br>
</p>
</div>
<div id="outline-container-orgf62c723" class="outline-4">
<h4 id="orgf62c723">Answer</h4>
<div class="outline-text-4" id="text-orgf62c723">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-rat</span> n d<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let*</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>g <span style="color: #859900;">(</span>abs <span style="color: #b58900;">(</span>gcd n d<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>nsign <span style="color: #859900;">(</span>xor <span style="color: #b58900;">(</span>negative? d<span style="color: #b58900;">)</span>
                     <span style="color: #b58900;">(</span>negative? n<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>num <span style="color: #859900;">(</span>/ <span style="color: #b58900;">(</span>abs n<span style="color: #b58900;">)</span> g<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>den <span style="color: #859900;">(</span>/ <span style="color: #b58900;">(</span>abs d<span style="color: #b58900;">)</span> g<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> nsign <span style="color: #6c71c4;">(</span>cons <span style="color: #859900;">(</span>* <span style="color: #6c71c4;">-1</span> num<span style="color: #859900;">)</span> den<span style="color: #6c71c4;">)</span>
        <span style="color: #6c71c4;">(</span>cons num den<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd6bb9dc" class="outline-3">
<h3 id="orgd6bb9dc">Exercise: 2.2</h3>
<div class="outline-text-3" id="text-orgd6bb9dc">
<p class="verse">
Consider the problem of representing line segments in a plane. Each segment<br>
is represented as a pair of points: a starting point and an ending point.<br>
Define a constructor `make-segment' and selectors `start-segment' and<br>
`end-segment' that define the representation of segments in terms of<br>
points. Furthermore, a point can be represented as a pair of numbers: the x<br>
coordinate and the y coordinate. Accordingly, specify a constructor<br>
`make-point' and selectors `x-point' and `y-point' that define this<br>
representation. Finally, using your selectors and constructors, define a<br>
procedure `midpoint-segment' that takes a line segment as argument and<br>
returns its midpoint (the point whose coordinates are the average of the<br>
coordinates of the endpoints). To try your procedures, you'll need a way to<br>
print points:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (print-point p)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(newline)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(display "(")<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(display (x-point p))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(display ",")<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(display (y-point p))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(display ")"))<br>
</p>
</div>
<div id="outline-container-orgf8f8df3" class="outline-4">
<h4 id="orgf8f8df3">Answer</h4>
<div class="outline-text-4" id="text-orgf8f8df3">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span>struct coordinate <span style="color: #b58900;">(</span>x y<span style="color: #b58900;">)</span> <span style="color: #657b83; font-weight: bold;">#:transparent</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>struct segment <span style="color: #b58900;">(</span>start end<span style="color: #b58900;">)</span> <span style="color: #657b83; font-weight: bold;">#:transparent</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">midpoint</span> segment<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>mid-x <span style="color: #859900;">(</span>/ <span style="color: #b58900;">(</span>+ <span style="color: #268bd2;">(</span>coordinate-x <span style="color: #6c71c4;">(</span>segment-start segment<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
                     <span style="color: #268bd2;">(</span>coordinate-x <span style="color: #6c71c4;">(</span>segment-end segment<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span> <span style="color: #6c71c4;">2</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
        <span style="color: #6c71c4;">(</span>mid-y <span style="color: #859900;">(</span>/ <span style="color: #b58900;">(</span>+ <span style="color: #268bd2;">(</span>coordinate-y <span style="color: #6c71c4;">(</span>segment-start segment<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
                     <span style="color: #268bd2;">(</span>coordinate-y <span style="color: #6c71c4;">(</span>segment-end segment<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span> <span style="color: #6c71c4;">2</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
    <span style="color: #268bd2;">(</span>coordinate mid-x mid-y<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">alternative scheme</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-point</span> x y<span style="color: #b58900;">)</span> `<span style="color: #b58900;">(</span>,x . ,y<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-segment</span> s e<span style="color: #b58900;">)</span> `<span style="color: #b58900;">(</span>,s . ,e<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">x-point</span> p<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>car p<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">y-point</span> p<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>cdr p<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">start-segment</span> segment<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>car segment<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">end-segment</span> segment<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>cdr segment<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">print-point</span> p<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>display <span style="color: #2aa198;">"("</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>display <span style="color: #268bd2;">(</span>x-point p<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>display <span style="color: #2aa198;">","</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>display <span style="color: #268bd2;">(</span>y-point p<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>display <span style="color: #2aa198;">")"</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>newline<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">midpoint-s</span> segment<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>make-segment
   <span style="color: #268bd2;">(</span>/ <span style="color: #6c71c4;">(</span>+ <span style="color: #859900;">(</span>x-point <span style="color: #b58900;">(</span>start-segment segment<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
         <span style="color: #859900;">(</span>x-point <span style="color: #b58900;">(</span>end-segment segment<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
      <span style="color: #6c71c4;">2</span><span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span>/ <span style="color: #6c71c4;">(</span>+ <span style="color: #859900;">(</span>y-point <span style="color: #b58900;">(</span>start-segment segment<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
         <span style="color: #859900;">(</span>y-point <span style="color: #b58900;">(</span>end-segment segment<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
      <span style="color: #6c71c4;">2</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org0ba59b2" class="outline-3">
<h3 id="org0ba59b2">Exercise 2.3</h3>
<div class="outline-text-3" id="text-org0ba59b2">
<p class="verse">
Implement a representation for rectangles in a plane. (Hint: You may want<br>
to make use of *Note Exercise 2-2::.) In terms of your constructors and<br>
selectors, create procedures that compute the perimeter and the area of a<br>
given rectangle. Now implement a different representation for rectangles.<br>
Can you design your system with suitable abstraction barriers, so that the<br>
</p>
</div>
<div id="outline-container-org6edc56c" class="outline-4">
<h4 id="org6edc56c">Answer</h4>
<div class="outline-text-4" id="text-org6edc56c">
<div class="org-src-container">
<pre class="src src-scheme">s<span style="color: #2aa198;">(</span>struct rectangle-s <span style="color: #b58900;">(</span>height width<span style="color: #b58900;">)</span>
   <span style="color: #657b83; font-weight: bold;">#:guard</span> <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #268bd2;">(</span>height width type-name<span style="color: #268bd2;">)</span>
             <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">[</span>and <span style="color: #859900;">(</span>segment? height<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>segment? width<span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span>
                 <span style="color: #6c71c4;">(</span>values height width<span style="color: #6c71c4;">)</span>
                 <span style="color: #6c71c4;">(</span>error <span style="color: #2aa198;">"not a valid rectangle"</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>struct rectangle <span style="color: #b58900;">(</span>a b<span style="color: #b58900;">)</span>
  <span style="color: #657b83; font-weight: bold;">#:guard</span> <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #268bd2;">(</span>a b type-name<span style="color: #268bd2;">)</span>
            <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">[</span>and <span style="color: #859900;">(</span>coordinate? a<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>coordinate? b<span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span>
                <span style="color: #6c71c4;">(</span>values a b<span style="color: #6c71c4;">)</span>
                <span style="color: #6c71c4;">(</span>error <span style="color: #2aa198;">"not a valid rectangle"</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">area</span> rect<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>* <span style="color: #268bd2;">(</span>rect-height rect<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>rect-width rect<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">rect-height</span> rect<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>abs <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">(</span>rectangle-s? rect<span style="color: #6c71c4;">)</span>
           <span style="color: #6c71c4;">(</span>- <span style="color: #859900;">(</span>coordinate-y <span style="color: #b58900;">(</span>segment-start <span style="color: #268bd2;">(</span>rectangle-s-height rect<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
              <span style="color: #859900;">(</span>coordinate-y <span style="color: #b58900;">(</span>segment-end   <span style="color: #268bd2;">(</span>rectangle-s-height rect<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
           <span style="color: #6c71c4;">(</span>- <span style="color: #859900;">(</span>coordinate-y <span style="color: #b58900;">(</span>rectangle-a rect<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
              <span style="color: #859900;">(</span>coordinate-y <span style="color: #b58900;">(</span>rectangle-b rect<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">rect-width</span> rect<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>abs <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">(</span>rectangle-s? rect<span style="color: #6c71c4;">)</span>
           <span style="color: #6c71c4;">(</span>- <span style="color: #859900;">(</span>coordinate-x <span style="color: #b58900;">(</span>segment-start <span style="color: #268bd2;">(</span>rectangle-s-width rect<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
              <span style="color: #859900;">(</span>coordinate-x <span style="color: #b58900;">(</span>segment-end   <span style="color: #268bd2;">(</span>rectangle-s-width rect<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
           <span style="color: #6c71c4;">(</span>- <span style="color: #859900;">(</span>coordinate-x <span style="color: #b58900;">(</span>rectangle-a rect<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
              <span style="color: #859900;">(</span>coordinate-x <span style="color: #b58900;">(</span>rectangle-b rect<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org6aec31f" class="outline-3">
<h3 id="org6aec31f">Exercise: 2.4</h3>
<div class="outline-text-3" id="text-org6aec31f">
<p class="verse">
Here is an alternative procedural representation<br>
of pairs.  For this representation, verify that `(car (cons x y))'<br>
yields `x' for any objects `x' and `y'.<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (cons x y)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(lambda (m) (m x y)))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (car z)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(z (lambda (p q) p)))<br>
<br>
What is the corresponding definition of `cdr'? (Hint: To verify that this<br>
works, make use of the substitution model of section *Note 1-1-5.)<br>
</p>
</div>
<div id="outline-container-orgf98a252" class="outline-4">
<h4 id="orgf98a252">Answer</h4>
<div class="outline-text-4" id="text-orgf98a252">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #93a1a1;">;;; </span><span style="color: #93a1a1;">whoa!!!</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">recons</span> x y<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #268bd2;">(</span>m<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>m x y<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">recar</span> z<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>z <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #6c71c4;">(</span>p q<span style="color: #6c71c4;">)</span> p<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">recdr</span> z<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>z <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #6c71c4;">(</span>p q<span style="color: #6c71c4;">)</span> q<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc445249" class="outline-3">
<h3 id="orgc445249">Exercise: 2.5</h3>
<div class="outline-text-3" id="text-orgc445249">
<p class="verse">
Show that we can represent pairs of nonnegative integers using only numbers<br>
and arithmetic operations if we represent the pair a and b as the integer<br>
that is the product 2<sup>a</sup> 3<sup>b</sup>. Give the corresponding definitions of the<br>
</p>
</div>
<div id="outline-container-org20abbda" class="outline-4">
<h4 id="org20abbda">Answer</h4>
<div class="outline-text-4" id="text-org20abbda">
<div class="org-src-container">
<pre class="src src-scheme">p<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">lower-expt</span> <span style="color: #6c71c4;">2</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">higher-expt</span> <span style="color: #6c71c4;">5</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">pack-pair</span> a b<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>* <span style="color: #268bd2;">(</span>expt lower-expt a<span style="color: #268bd2;">)</span>
     <span style="color: #268bd2;">(</span>expt higher-expt b<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">unpack-base</span> x base<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">[</span>= <span style="color: #6c71c4;">0</span> <span style="color: #6c71c4;">(</span>remainder x base<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
      <span style="color: #268bd2;">(</span>+ <span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">(</span>unpack-base <span style="color: #859900;">(</span>/ x base<span style="color: #859900;">)</span> base<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
      <span style="color: #6c71c4;">0</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">unpack-pair</span> d<span style="color: #b58900;">)</span>
  `<span style="color: #b58900;">(</span>,<span style="color: #268bd2;">(</span>unpack-base d lower-expt<span style="color: #268bd2;">)</span>
    ,<span style="color: #268bd2;">(</span>unpack-base d higher-expt<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org4f80ef1" class="outline-3">
<h3 id="org4f80ef1">Exercise: 2.6</h3>
<div class="outline-text-3" id="text-org4f80ef1">
<p class="verse">
In case representing pairs as procedures wasn't mind-boggling enough,<br>
consider that, in a language that can manipulate procedures, we can get by<br>
without numbers (at least insofar as nonnegative integers are concerned) by<br>
implementing 0 and the operation of adding 1 as<br>
</p>
</div>
<div id="outline-container-orgd897224" class="outline-4">
<h4 id="orgd897224">Answer</h4>
<div class="outline-text-4" id="text-orgd897224">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">church-zero</span> <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #6c71c4;">(</span>f<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #859900;">(</span>x<span style="color: #859900;">)</span> x<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

 <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">church-add-1</span> n<span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #6c71c4;">(</span>f<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #859900;">(</span>x<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>f <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>n f<span style="color: #268bd2;">)</span> x<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

 <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">church-one</span>
   <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #6c71c4;">(</span>f<span style="color: #6c71c4;">)</span>
     <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #859900;">(</span>x<span style="color: #859900;">)</span>
       <span style="color: #859900;">(</span>f x<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

 <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">church-two</span>
   <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #6c71c4;">(</span>f<span style="color: #6c71c4;">)</span>
     <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #859900;">(</span>x<span style="color: #859900;">)</span>
       <span style="color: #859900;">(</span>f
        <span style="color: #b58900;">(</span>f x<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

 <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">church-addition</span> m n<span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #6c71c4;">(</span>f<span style="color: #6c71c4;">)</span>
     <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #859900;">(</span>x<span style="color: #859900;">)</span>
       <span style="color: #859900;">(</span><span style="color: #b58900;">(</span>n f<span style="color: #b58900;">)</span>
        <span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span>m f<span style="color: #268bd2;">)</span>
         x<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org25f8a6c" class="outline-3">
<h3 id="org25f8a6c">Exercise: 2.7</h3>
<div class="outline-text-3" id="text-org25f8a6c">
<p class="verse">
Alyssa's program is incomplete because she has not specified the<br>
implementation of the interval abstraction. Here is a definition of the<br>
interval constructor:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (make-interval a b) (cons a b))<br>
<br>
Define selectors `upper-bound' and `lower-bound' to complete the<br>
</p>
</div>
<div id="outline-container-orgc45ec21" class="outline-4">
<h4 id="orgc45ec21">Answer</h4>
<div class="outline-text-4" id="text-orgc45ec21">
<div class="org-src-container">
<pre class="src src-scheme">i<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">(module interval racket</span>
<span style="color: #93a1a1;">;;   </span><span style="color: #93a1a1;">(provide add-interval mul-interval div-interval)</span>
<span style="color: #93a1a1;">;;   </span><span style="color: #93a1a1;">(define (add-interval x y)</span>
<span style="color: #93a1a1;">;;     </span><span style="color: #93a1a1;">(make-interval (+ (lower-bound x) (lower-bound y))</span>
<span style="color: #93a1a1;">;;                    </span><span style="color: #93a1a1;">(+ (upper-bound x) (upper-bound y))))</span>
<span style="color: #93a1a1;">;;   </span><span style="color: #93a1a1;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-interval</span> a b<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>cons a b<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">upper-bound</span> interval<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>cdr interval<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">lower-bound</span> interval<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>car interval<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org5c622bd" class="outline-3">
<h3 id="org5c622bd">Exercise: 2.8</h3>
<div class="outline-text-3" id="text-org5c622bd">
<p class="verse">
Using reasoning analogous to Alyssa's, describe how the difference of two<br>
intervals may be computed. Define a corresponding subtraction procedure,<br>
</p>
</div>
<div id="outline-container-orgc51556a" class="outline-4">
<h4 id="orgc51556a">Answer</h4>
<div class="outline-text-4" id="text-orgc51556a">
<div class="org-src-container">
<pre class="src src-scheme">c<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">sub-interval</span> x y<span style="color: #b58900;">)</span>
   <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>p1 <span style="color: #859900;">(</span>- <span style="color: #b58900;">(</span>lower-bound x<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>lower-bound y<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>p2 <span style="color: #859900;">(</span>- <span style="color: #b58900;">(</span>lower-bound y<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>upper-bound x<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
     <span style="color: #268bd2;">(</span>make-interval <span style="color: #6c71c4;">(</span>min p1 p2<span style="color: #6c71c4;">)</span>
                    <span style="color: #6c71c4;">(</span>max p1 p2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org174c8e3" class="outline-3">
<h3 id="org174c8e3">Exercise: 2.9</h3>
<div class="outline-text-3" id="text-org174c8e3">
<p class="verse">
The "width" of an interval is half of the difference between its upper and<br>
lower bounds. The width is a measure of the uncertainty of the number<br>
specified by the interval. For some arithmetic operations the width of the<br>
result of combining two intervals is a function only of the widths of the<br>
argument intervals, whereas for others the width of the combination is not<br>
a function of the widths of the argument intervals. Show that the width of<br>
the sum (or difference) of two intervals is a function only of the widths<br>
of the intervals being added (or subtracted). Give quotes to show that<br>
</p>
</div>
<div id="outline-container-org8888c8d" class="outline-4">
<h4 id="org8888c8d">Answer</h4>
<div class="outline-text-4" id="text-org8888c8d">
<div class="org-src-container">
<pre class="src src-scheme">t
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf79657a" class="outline-3">
<h3 id="orgf79657a">Exercise: 2.10</h3>
<div class="outline-text-3" id="text-orgf79657a">
<p class="verse">
Ben Bitdiddle, an expert systems programmer, looks over Alyssa's shoulder<br>
and comments that it is not clear what it means to divide by an interval<br>
that spans zero. Modify Alyssa's code to check for this condition and to<br>
</p>
</div>
<div id="outline-container-org69dc299" class="outline-4">
<h4 id="org69dc299">Answer</h4>
<div class="outline-text-4" id="text-org69dc299">
<div class="org-src-container">
<pre class="src src-scheme">s<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">div-interval</span> x y<span style="color: #b58900;">)</span>
   <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">or</span> <span style="color: #859900;">(</span>= <span style="color: #6c71c4;">0</span> <span style="color: #b58900;">(</span>upper-bound y<span style="color: #b58900;">)</span><span style="color: #859900;">)</span> <span style="color: #859900;">(</span>= <span style="color: #6c71c4;">0</span> <span style="color: #b58900;">(</span>lower-bound y<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
          <span style="color: #6c71c4;">(</span>error <span style="color: #2aa198;">"attempted to divide by the zero"</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
         <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #6c71c4;">(</span>mul-interval x
                             <span style="color: #859900;">(</span>make-interval <span style="color: #b58900;">(</span>/ <span style="color: #6c71c4;">1.0</span> <span style="color: #268bd2;">(</span>upper-bound y<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
                                            <span style="color: #b58900;">(</span>/ <span style="color: #6c71c4;">1.0</span> <span style="color: #268bd2;">(</span>lower-bound y<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org7d4100f" class="outline-3">
<h3 id="org7d4100f">Exercise: 2.11</h3>
<div class="outline-text-3" id="text-org7d4100f">
<p class="verse">
In passing, Ben also cryptically comments: "By testing the signs of the<br>
endpoints of the intervals, it is possible to break `mul-interval' into<br>
nine cases, only one of which requires more than two multiplications."<br>
Rewrite this procedure using Ben's suggestion.<br>
<br>
After debugging her program, Alyssa shows it to a potential user, who<br>
complains that her program solves the wrong problem. He wants a program<br>
that can deal with numbers represented as a center value and an additive<br>
tolerance; for quote, he wants to work with intervals such as 3.5 +/-<br>
0.15 rather than [3.35, 3.65]. Alyssa returns to her desk and fixes this<br>
problem by supplying an alternate constructor and alternate selectors:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (make-center-width c w) (make-interval (- c w) (+ c w)))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (center i) (/ (+ (lower-bound i) (upper-bound i)) 2))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (width i) (/ (- (upper-bound i) (lower-bound i)) 2))<br>
<br>
Unfortunately, most of Alyssa's users are engineers. Real engineering<br>
situations usually involve measurements with only a small uncertainty,<br>
measured as the ratio of the width of the interval to the midpoint of the<br>
interval. Engineers usually specify percentage tolerances on the parameters<br>
</p>
</div>
<div id="outline-container-org4a183d2" class="outline-4">
<h4 id="org4a183d2">Answer</h4>
<div class="outline-text-4" id="text-org4a183d2">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">mul-interval</span> x y<span style="color: #b58900;">)</span>
    <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>p1 <span style="color: #859900;">(</span>* <span style="color: #b58900;">(</span>lower-bound x<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>lower-bound y<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
          <span style="color: #6c71c4;">(</span>p2 <span style="color: #859900;">(</span>* <span style="color: #b58900;">(</span>lower-bound x<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>upper-bound y<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
          <span style="color: #6c71c4;">(</span>p3 <span style="color: #859900;">(</span>* <span style="color: #b58900;">(</span>upper-bound x<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>lower-bound y<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
          <span style="color: #6c71c4;">(</span>p4 <span style="color: #859900;">(</span>* <span style="color: #b58900;">(</span>upper-bound x<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>upper-bound y<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
      <span style="color: #268bd2;">(</span>make-interval <span style="color: #6c71c4;">(</span>min p1 p2 p3 p4<span style="color: #6c71c4;">)</span>
                     <span style="color: #6c71c4;">(</span>max p1 p2 p3 p4<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org262701b" class="outline-3">
<h3 id="org262701b">Exercise: 2.17</h3>
<div class="outline-text-3" id="text-org262701b">
<p class="verse">
Define a procedure `last-pair' that returns the list that contains only the<br>
last element of a given (nonempty) list:<br>
</p>
</div>
<div id="outline-container-org6be224f" class="outline-4">
<h4 id="org6be224f">Answer</h4>
<div class="outline-text-4" id="text-org6be224f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">last-pair</span> lst<span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #6c71c4;">[</span><span style="color: #859900;">(</span>lastls <span style="color: #b58900;">(</span>cdr lst<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span>
     <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #859900;">(</span>null? lastls<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>car lst<span style="color: #859900;">)</span>
         <span style="color: #859900;">(</span>last-pair lastls<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org8d6313a" class="outline-3">
<h3 id="org8d6313a">Exercise: 2.18</h3>
<div class="outline-text-3" id="text-org8d6313a">
<p class="verse">
Define a procedure `reverse' that takes a list as argument and returns a<br>
list of the same elements in reverse order:<br>
</p>
</div>
<div id="outline-container-orgba097e8" class="outline-4">
<h4 id="orgba097e8">Answer</h4>
<div class="outline-text-4" id="text-orgba097e8">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">reverse-l</span> lst<span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">(</span>null? lst<span style="color: #6c71c4;">)</span> null
       <span style="color: #6c71c4;">(</span>append <span style="color: #859900;">(</span>reverse-l <span style="color: #b58900;">(</span>cdr lst<span style="color: #b58900;">)</span><span style="color: #859900;">)</span> <span style="color: #859900;">(</span>list <span style="color: #b58900;">(</span>car lst<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

 <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">reverse-ls</span> xs <span style="color: #6c71c4;">[</span>result null<span style="color: #6c71c4;">]</span><span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #6c71c4;">[</span><span style="color: #859900;">(</span>null? xs<span style="color: #859900;">)</span> result<span style="color: #6c71c4;">]</span>
         <span style="color: #6c71c4;">[</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #859900;">(</span>reverse-ls <span style="color: #b58900;">(</span>cdr xs<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>cons <span style="color: #268bd2;">(</span>car xs<span style="color: #268bd2;">)</span> result<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org98cab59" class="outline-3">
<h3 id="org98cab59">Exercise: 2.19</h3>
<div class="outline-text-3" id="text-org98cab59">
<p class="verse">
Consider the change-counting program of section *Note 1-2-2::. It would be<br>
nice to be able to easily change the currency used by the program, so that<br>
we could compute the number of ways to change a British pound, for quote.<br>
As the program is written, the knowledge of the currency is distributed<br>
partly into the procedure `first-denomination' and partly into the<br>
procedure `count-change' (which knows that there are five kinds of U.S.<br>
coins). It would be nicer to be able to supply a list of coins to be used<br>
for making change.<br>
<br>
We want to rewrite the procedure `cc' so that its second argument is a list<br>
of the values of the coins to use rather than an integer specifying which<br>
coins to use. We could then have lists that defined each kind of currency:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define us-coins (list 50 25 10 5 1))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define uk-coins (list 100 50 20 10 5 2 1 0.5))<br>
<br>
We could then call `cc' as follows:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cc 100 us-coins) 292<br>
<br>
To do this will require changing the program `cc' somewhat. It will still<br>
have the same form, but it will access its second argument differently, as<br>
follows:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (cc amount coin-values) (cond ((= amount 0) 1) ((or (&lt; amount 0)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(no-more? coin-values)) 0) (else (+ (cc amount (except-first-denomination<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;coin-values)) (cc (- amount (first-denomination coin-values))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;coin-values)))))<br>
<br>
Define the procedures `first-denomination', `except-first-denomination',<br>
and `no-more?' in terms of primitive operations on list structures. Does<br>
the order of the list `coin-values' affect the answer produced by `cc'? Why<br>
</p>
</div>
<div id="outline-container-org6ecc903" class="outline-4">
<h4 id="org6ecc903">Answer</h4>
<div class="outline-text-4" id="text-org6ecc903">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">valid-change</span> n types<span style="color: #b58900;">)</span>
   <span style="color: #b58900;">(</span>filter <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #6c71c4;">(</span>x<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>&lt;= x n<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> types<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">zv-count-change</span> amt types<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>= amt <span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">1</span><span style="color: #268bd2;">)</span>
        <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">or</span> <span style="color: #859900;">(</span>&lt; amt <span style="color: #6c71c4;">0</span><span style="color: #859900;">)</span> <span style="color: #859900;">(</span>empty? <span style="color: #b58900;">(</span>valid-change amt types<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">0</span><span style="color: #268bd2;">)</span>
        <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #6c71c4;">(</span>foldr <span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #b58900;">(</span>x res<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>+ res <span style="color: #268bd2;">(</span>zv-count-change <span style="color: #6c71c4;">(</span>- amt x<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
                     <span style="color: #6c71c4;">0</span>
                     <span style="color: #859900;">(</span>valid-change amt types<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org0e0b149" class="outline-3">
<h3 id="org0e0b149">Exercise: 2.20</h3>
<div class="outline-text-3" id="text-org0e0b149">
<p class="verse">
The procedures `+', `*', and `list' take arbitrary numbers of arguments.<br>
One way to define such procedures is to use `define' with notation<br>
"dotted-tail notation". In a procedure definition, a parameter list that<br>
has a dot before the last parameter name indicates that, when the procedure<br>
is called, the initial parameters (if any) will have as values the initial<br>
arguments, as usual, but the final parameter's value will be a "list" of<br>
any remaining arguments. For instance, given the definition<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (f x y . z) &lt;QUOTE&gt;)<br>
<br>
the procedure `f' can be called with two or more arguments. If we evaluate<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(f 1 2 3 4 5 6)<br>
<br>
then in the body of `f', `x' will be 1, `y' will be 2, and `z' will be the<br>
list `(3 4 5 6)'. Given the definition<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (g . w) &lt;QUOTE&gt;)<br>
<br>
the procedure `g' can be called with zero or more arguments. If we evaluate<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(g 1 2 3 4 5 6)<br>
<br>
then in the body of `g', `w' will be the list `(1 2 3 4 5 6)'.(4)<br>
<br>
Use this notation to write a procedure `same-parity' that takes one or more<br>
integers and returns a list of all the arguments that have the same<br>
even-odd parity as the first argument. For quote,<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(same-parity 1 2 3 4 5 6 7) (1 3 5 7)<br>
</p>
</div>
<div id="outline-container-org958e7b0" class="outline-4">
<h4 id="org958e7b0">Answer</h4>
<div class="outline-text-4" id="text-org958e7b0">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span>
 <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">same-parity</span> elt . xs<span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #6c71c4;">(</span><span style="color: #268bd2;">test-parity</span> n<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>= <span style="color: #859900;">(</span>remainder elt <span style="color: #6c71c4;">2</span><span style="color: #859900;">)</span> <span style="color: #859900;">(</span>remainder n <span style="color: #6c71c4;">2</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span>filter test-parity xs<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd2f2de9" class="outline-3">
<h3 id="orgd2f2de9">Exercise: 2.21</h3>
<div class="outline-text-3" id="text-orgd2f2de9">
<p class="verse">
The procedure `square-list' takes a list of numbers as argument and returns<br>
a list of the squares of those numbers.<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(square-list (list 1 2 3 4)) (1 4 9 16)<br>
<br>
Here are two different definitions of `square-list'. Complete both of them<br>
by filling in the missing expressions:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (square-list items) (if (null? items) nil (cons &lt;??&gt; &lt;??&gt;)))<br>
</p>
</div>
<div id="outline-container-orga7b0918" class="outline-4">
<h4 id="orga7b0918">Answer</h4>
<div class="outline-text-4" id="text-orga7b0918">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">square</span> n<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>* n n<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

 <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">square-list</span> items<span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">(</span>null? items<span style="color: #6c71c4;">)</span> null
       <span style="color: #6c71c4;">(</span>cons <span style="color: #859900;">(</span>square <span style="color: #b58900;">(</span>car items<span style="color: #b58900;">)</span><span style="color: #859900;">)</span> <span style="color: #859900;">(</span>square-list <span style="color: #b58900;">(</span>cdr items<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

 <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">square-list-x</span> items<span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">map</span> square items<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org8e25347" class="outline-3">
<h3 id="org8e25347">Exercise: 2.22</h3>
<div class="outline-text-3" id="text-org8e25347">
<p class="verse">
Louis Reasoner tries to rewrite the first `square-list' procedure of *Note<br>
Exercise 2-21:: so that it evolves an iterative process:<br>
<br>
(define (square-list items) (define (iter things answer) (if (null?<br>
things) answer (iter (cdr things) (cons (square (car things)) answer))))<br>
(iter items nil))<br>
<br>
Unfortunately, defining `square-list' this way produces the answer list in<br>
the reverse order of the one desired. Why?<br>
<br>
Louis then tries to fix his bug by interchanging the arguments to `cons':<br>
<br>
(define (square-list items) (define (iter things answer) (if (null? things)<br>
answer (iter (cdr things) (cons answer (square (car things)))))) (iter<br>
items nil))<br>
</p>
</div>
<div id="outline-container-orge117ee6" class="outline-4">
<h4 id="orge117ee6">Answer</h4>
<div class="outline-text-4" id="text-orge117ee6">
<div class="org-src-container">
<pre class="src src-scheme">T<span style="color: #93a1a1;">;;; </span><span style="color: #93a1a1;">Louis Reasoner has mixed up the arguments `answer' and `(square (car things))'</span>
<span style="color: #93a1a1;">;;; </span><span style="color: #93a1a1;">In his second attempt</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">correct version of iterative</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">(define (square-list-b things [answer null])</span>
<span style="color: #93a1a1;">;;     </span><span style="color: #93a1a1;">(if (null? things) answer</span>
<span style="color: #93a1a1;">;;         </span><span style="color: #93a1a1;">(square-list-b (cdr things)</span>
<span style="color: #93a1a1;">;;                        </span><span style="color: #93a1a1;">(append answer (list (square (car things)))))))</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org1e1b5e9" class="outline-3">
<h3 id="org1e1b5e9">Exercise: 2.23</h3>
<div class="outline-text-3" id="text-org1e1b5e9">
<p class="verse">
The procedure `for-each' is similar to `map'. It takes as arguments a<br>
procedure and a list of elements. However, rather than forming a list of<br>
the results, `for-each' just applies the procedure to each of the elements<br>
in turn, from left to right. The values returned by applying the procedure<br>
to the elements are not used at all&#x2013;`for-each' is used with procedures<br>
that perform an action, such as printing. For quote,<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(for-each (lambda (x) (newline) (display x)) (list 57 321 88)) 57 321 88<br>
<br>
The value returned by the call to `for-each' (not illustrated above) can be<br>
</p>
</div>
<div id="outline-container-orgc281bd8" class="outline-4">
<h4 id="orgc281bd8">Answer</h4>
<div class="outline-text-4" id="text-orgc281bd8">
<div class="org-src-container">
<pre class="src src-scheme">s
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">for-each-zv</span> fn xs<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">[</span>empty? xs<span style="color: #268bd2;">]</span> null
      <span style="color: #268bd2;">(</span>cons <span style="color: #6c71c4;">(</span>fn <span style="color: #859900;">(</span>car xs<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
            <span style="color: #6c71c4;">(</span>for-each-zv fn <span style="color: #859900;">(</span>cdr xs<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  #t<span style="color: #2aa198;">)</span>


<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">not a exercize</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">closest</span> a b x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>&lt; <span style="color: #6c71c4;">(</span>abs <span style="color: #859900;">(</span>- x <span style="color: #b58900;">(</span>/ <span style="color: #268bd2;">(</span>numer a<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>denom a<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>abs <span style="color: #859900;">(</span>- x <span style="color: #b58900;">(</span>/ <span style="color: #268bd2;">(</span>numer b<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>denom b<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> a
      b<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">find-closest-rational</span> x limit<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">search-rationals</span> n d top<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #6c71c4;">[</span><span style="color: #859900;">(</span>&gt; n limit<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>search-rationals <span style="color: #6c71c4;">0</span> <span style="color: #b58900;">(</span>inc d<span style="color: #b58900;">)</span> top<span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span>
          <span style="color: #6c71c4;">[</span><span style="color: #859900;">(</span>&gt; d limit<span style="color: #859900;">)</span> top<span style="color: #6c71c4;">]</span>
          <span style="color: #6c71c4;">[</span><span style="color: #859900; font-weight: bold;">else</span>
           <span style="color: #859900;">(</span>search-rationals <span style="color: #b58900;">(</span>inc n<span style="color: #b58900;">)</span>
                             d
                             <span style="color: #b58900;">(</span>closest <span style="color: #268bd2;">(</span>make-rat n d<span style="color: #268bd2;">)</span> top x<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>search-rationals <span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">1</span> <span style="color: #268bd2;">(</span>make-rat <span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">1</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">find-closest-rational-t</span> x limit<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">search-rationals</span> n d<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">or</span> <span style="color: #859900;">(</span>&gt; n limit<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>&gt; d limit<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>make-rat n d<span style="color: #6c71c4;">)</span>
        <span style="color: #6c71c4;">(</span>closest <span style="color: #859900;">(</span>make-rat n d<span style="color: #859900;">)</span>
                 <span style="color: #859900;">(</span>closest
                  <span style="color: #b58900;">(</span>search-rationals <span style="color: #268bd2;">(</span>inc n<span style="color: #268bd2;">)</span> d<span style="color: #b58900;">)</span>
                  <span style="color: #b58900;">(</span>search-rationals n <span style="color: #268bd2;">(</span>inc d<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
                  x<span style="color: #859900;">)</span> x<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>search-rationals <span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">1</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">count-leaves</span> x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>null? x<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">0</span><span style="color: #268bd2;">)</span>
        <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>not <span style="color: #859900;">(</span>pair? x<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">1</span><span style="color: #268bd2;">)</span>
        <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #6c71c4;">(</span>+ <span style="color: #859900;">(</span>count-leaves <span style="color: #b58900;">(</span>car x<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
                 <span style="color: #859900;">(</span>count-leaves <span style="color: #b58900;">(</span>cdr x<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb099661" class="outline-3">
<h3 id="orgb099661">Exercise: 2.24</h3>
<div class="outline-text-3" id="text-orgb099661">
<p class="verse">
Suppose we evaluate the expression `(list 1 (list 2 (list 3 4)))'. Give the<br>
result printed by the interpreter, the corresponding box-and-pointer<br>
structure, and the interpretation of this as a tree (as in *Note Figure<br>
</p>
</div>
<div id="outline-container-orgc558740" class="outline-4">
<h4 id="orgc558740">Answer</h4>
<div class="outline-text-4" id="text-orgc558740">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #6c71c4;">2</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org77a89c8" class="outline-3">
<h3 id="org77a89c8">Exercise: 2.25</h3>
<div class="outline-text-3" id="text-org77a89c8">
<p class="verse">
Give combinations of `car's and `cdr's that will pick 7 from each of the<br>
following lists:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(1 3 (5 7) 9)<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;((7))<br>
</p>
</div>
<div id="outline-container-org0228b37" class="outline-4">
<h4 id="org0228b37">Answer</h4>
<div class="outline-text-4" id="text-org0228b37">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">is-sevens</span><span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">[</span> printf <span style="color: #2aa198;">"~a\n"</span> <span style="color: #6c71c4;">(</span>car <span style="color: #859900;">(</span>cdaddr '<span style="color: #b58900;">(</span><span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">3</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">5</span> <span style="color: #6c71c4;">7</span><span style="color: #268bd2;">)</span> <span style="color: #6c71c4;">9</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
   <span style="color: #268bd2;">[</span> printf <span style="color: #2aa198;">"~a\n"</span> <span style="color: #6c71c4;">(</span>caar '<span style="color: #859900;">(</span><span style="color: #b58900;">(</span><span style="color: #6c71c4;">7</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
   <span style="color: #268bd2;">[</span> printf <span style="color: #2aa198;">"~a\n"</span> <span style="color: #6c71c4;">(</span>cadadr <span style="color: #859900;">(</span>cadadr <span style="color: #b58900;">(</span>cadadr '<span style="color: #268bd2;">(</span><span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">(</span><span style="color: #6c71c4;">2</span> <span style="color: #859900;">(</span><span style="color: #6c71c4;">3</span> <span style="color: #2aa198;">(</span><span style="color: #6c71c4;">4</span> <span style="color: #b58900;">(</span><span style="color: #6c71c4;">5</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">6</span> <span style="color: #6c71c4;">7</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd104de7" class="outline-3">
<h3 id="orgd104de7">Exercise: 2.26</h3>
<div class="outline-text-3" id="text-orgd104de7">
<p class="verse">
Suppose we define `x' and `y' to be two lists:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define x (list 1 2 3))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define y (list 4 5 6))<br>
<br>
What result is printed by the interpreter in response to evaluating each of<br>
the following expressions:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(append x y)<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cons x y)<br>
</p>
</div>
<div id="outline-container-org80393dc" class="outline-4">
<h4 id="org80393dc">Answer</h4>
<div class="outline-text-4" id="text-org80393dc">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">two-twentysix-x</span> <span style="color: #268bd2;">(</span>list <span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">2</span> <span style="color: #6c71c4;">3</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
 <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">two-twentysix-y</span> <span style="color: #268bd2;">(</span>list <span style="color: #6c71c4;">4</span> <span style="color: #6c71c4;">5</span> <span style="color: #6c71c4;">6</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
 <span style="color: #93a1a1;">;;; </span><span style="color: #93a1a1;">(append two-twentysix-x two-twentysix-y) =&gt; '(1 2 3 4 5 6)</span>
 <span style="color: #93a1a1;">;;; </span><span style="color: #93a1a1;">(cons two-twentysix-x two-twentysix-y)   =&gt; '((1 2 3) 4 5 6)</span>
 <span style="color: #93a1a1;">;;;  </span><span style="color: #93a1a1;">(list two-twentysix-x two-twentysix-y)  =&gt; '((1 2 3) (4 5 6))</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc3a6800" class="outline-3">
<h3 id="orgc3a6800">Exercise: 2.27</h3>
<div class="outline-text-3" id="text-orgc3a6800">
<p class="verse">
Modify your `reverse' procedure of *Note Exercise 2-18:: to produce a<br>
`deep-reverse' procedure that takes a list as argument and returns as its<br>
value the list with its elements reversed and with all sublists<br>
deep-reversed as well. For quote,<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define x (list (list 1 2) (list 3 4)))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;x ((1 2) (3 4))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(reverse x) ((3 4) (1 2))<br>
<br>
</p>
</div>
<div id="outline-container-org14604fa" class="outline-4">
<h4 id="org14604fa">Answer</h4>
<div class="outline-text-4" id="text-org14604fa">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">deep-reverse-l</span> lst<span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #6c71c4;">[</span><span style="color: #859900;">(</span>null? lst<span style="color: #859900;">)</span> null<span style="color: #6c71c4;">]</span>
         <span style="color: #6c71c4;">[</span><span style="color: #859900;">(</span>list? lst<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>append
                       <span style="color: #b58900;">(</span>deep-reverse-l <span style="color: #268bd2;">(</span>rest lst<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
                       <span style="color: #b58900;">(</span>list <span style="color: #268bd2;">(</span>deep-reverse-l <span style="color: #6c71c4;">(</span>first lst<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span>
         <span style="color: #6c71c4;">[</span><span style="color: #859900; font-weight: bold;">else</span> lst<span style="color: #6c71c4;">]</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org959f610" class="outline-3">
<h3 id="org959f610">Exercise: 2.28</h3>
<div class="outline-text-3" id="text-org959f610">
<p class="verse">
Write a procedure `fringe' that takes as argument a tree (represented as a<br>
list) and returns a list whose elements are all the leaves of the tree<br>
arranged in left-to-right order. For quote,<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define x (list (list 1 2) (list 3 4)))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(fringe x) (1 2 3 4)<br>
<br>
</p>
</div>
<div id="outline-container-org6c8d313" class="outline-4">
<h4 id="org6c8d313">Answer</h4>
<div class="outline-text-4" id="text-org6c8d313">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">fringe</span> xs<span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #6c71c4;">[</span><span style="color: #859900;">(</span>null? xs<span style="color: #859900;">)</span> null<span style="color: #6c71c4;">]</span>
         <span style="color: #6c71c4;">[</span><span style="color: #859900;">(</span>list? xs<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>append <span style="color: #b58900;">(</span>fringe <span style="color: #268bd2;">(</span>first xs<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
                             <span style="color: #b58900;">(</span>fringe <span style="color: #268bd2;">(</span>rest xs<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span>
         <span style="color: #6c71c4;">[</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #859900;">(</span>list xs<span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>


</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org3435b1d" class="outline-3">
<h3 id="org3435b1d">Exercise: 2.29</h3>
<div class="outline-text-3" id="text-org3435b1d">
<p class="verse">
A binary mobile consists of two branches, a left branch and a right branch.<br>
Each branch is a rod of a certain length, from which hangs either a weight<br>
or another binary mobile. We can represent a binary mobile using compound<br>
data by constructing it from two branches (for quote, using `list'):<br>
<br>
(define (make-mobile left right) (list left right))<br>
<br>
A branch is constructed from a `length' (which must be a number) together<br>
with a `structure', which may be either a number (representing a simple<br>
weight) or another mobile:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (make-branch length structure) (list length structure))<br>
<br>
a. Write the corresponding selectors `left-branch' and `right-branch',<br>
which return the branches of a mobile, and `branch-length' and<br>
`branch-structure', which return the components of a branch.<br>
<br>
b. Using your selectors, define a procedure `total-weight' that returns the<br>
total weight of a mobile.<br>
<br>
c. A mobile is said to be "balanced" if the torque applied by its top-left<br>
branch is equal to that applied by its top-right branch (that is, if the<br>
length of the left rod multiplied by the weight hanging from that rod is<br>
equal to the corresponding product for the right side) and if each of the<br>
submobiles hanging off its branches is balanced. Design a predicate that<br>
tests whether a binary mobile is balanced.<br>
<br>
d. Suppose we change the representation of mobiles so that the constructors<br>
are<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (make-mobile left right) (cons left right))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (make-branch length structure) (cons length structure))<br>
<br>
How much do you need to change your programs to convert to the new<br>
</p>
</div>
<div id="outline-container-org966e1f6" class="outline-4">
<h4 id="org966e1f6">Answer</h4>
<div class="outline-text-4" id="text-org966e1f6">
<div class="org-src-container">
<pre class="src src-scheme">r<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">Racket Style</span>
<span style="color: #2aa198;">(</span>struct mobile <span style="color: #b58900;">(</span>l r<span style="color: #b58900;">)</span>
  <span style="color: #657b83; font-weight: bold;">#:transparent</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>struct mbranch <span style="color: #b58900;">(</span>len structure<span style="color: #b58900;">)</span>
  <span style="color: #657b83; font-weight: bold;">#:transparent</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">total-weight</span> node<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>mstruct <span style="color: #859900;">(</span>mbranch-structure node<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">(</span>mobile? mstruct<span style="color: #6c71c4;">)</span>
        <span style="color: #6c71c4;">(</span>+ <span style="color: #859900;">(</span>total-weight <span style="color: #b58900;">(</span>mobile-l node<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
           <span style="color: #859900;">(</span>total-weight <span style="color: #b58900;">(</span>mobile-r node<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
        mstruct<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">balanced-mobile?</span> mbl<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>= <span style="color: #268bd2;">(</span>total-weight <span style="color: #6c71c4;">(</span>mobile-l mbl<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
     <span style="color: #268bd2;">(</span>total-weight <span style="color: #6c71c4;">(</span>mobile-r mbl<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;;; </span><span style="color: #93a1a1;">Guile Style</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-mobile</span> left right<span style="color: #b58900;">)</span> '<span style="color: #b58900;">(</span>left right<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-branch</span> len structure<span style="color: #b58900;">)</span> '<span style="color: #b58900;">(</span>len structure<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">sip-total-weight</span> node<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>mstruct <span style="color: #859900;">(</span>cadr node<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">(</span>number? mstruct<span style="color: #6c71c4;">)</span> mstruct
        <span style="color: #6c71c4;">(</span>+ <span style="color: #859900;">(</span>sip-total-weight <span style="color: #b58900;">(</span>left-branch node<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
           <span style="color: #859900;">(</span>sip-total-weight <span style="color: #b58900;">(</span>right-branch node<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">sip-balanced-mobile?</span> mbl<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>= <span style="color: #268bd2;">(</span>total-weight <span style="color: #6c71c4;">(</span>left-branch mbl<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
     <span style="color: #268bd2;">(</span>total-weight <span style="color: #6c71c4;">(</span>right-branch mbl<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org92184e3" class="outline-3">
<h3 id="org92184e3">Exercise: 2.30</h3>
<div class="outline-text-3" id="text-org92184e3">
<p class="verse">
Define a procedure `square-tree' analogous to the `square-list' procedure<br>
of *Note Exercise 2-21::. That is, `square-list' should behave as follows:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(square-tree (list 1 (list 2 (list 3 4) 5) (list 6 7))) (1 (4 (9 16) 25)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(36 49))<br>
<br>
Define `square-tree' both directly (i.e., without using any higher-order<br>
</p>
</div>
<div id="outline-container-org8636461" class="outline-4">
<h4 id="org8636461">Answer</h4>
<div class="outline-text-4" id="text-org8636461">
<div class="org-src-container">
<pre class="src src-scheme">p<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">square-tree</span> tree<span style="color: #b58900;">)</span>
   <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">map</span> <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #6c71c4;">(</span>node<span style="color: #6c71c4;">)</span>
          <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #859900;">(</span>list? node<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>square-tree node<span style="color: #859900;">)</span>
              <span style="color: #859900;">(</span>* node node<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> tree<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgfae5f6d" class="outline-3">
<h3 id="orgfae5f6d">Exercise: 2.31</h3>
<div class="outline-text-3" id="text-orgfae5f6d">
<p class="verse">
Abstract your answer to *Note Exercise 2-30:: to produce a procedure<br>
`tree-map' with the property that `square-tree' could be defined as<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (square-tree tree) (tree-map square tree))<br>
<br>
We can represent a set as a list of distinct elements, and we can represent<br>
the set of all subsets of the set as a list of lists. For quote, if the<br>
set is `(1 2 3)', then the set of all subsets is `(() (3) (2) (2 3) (1) (1<br>
3) (1 2) (1 2 3))'. Complete the following definition of a procedure that<br>
generates the set of subsets of a set and give a clear explanation of why<br>
it works:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (subsets s) (if (null? s) (list nil) (let ((rest (subsets (cdr<br>
</p>
</div>
<div id="outline-container-org3b70c0e" class="outline-4">
<h4 id="org3b70c0e">Answer</h4>
<div class="outline-text-4" id="text-org3b70c0e">
<div class="org-src-container">
<pre class="src src-scheme">s<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">tree-map</span> fn tree<span style="color: #b58900;">)</span>
   <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">map</span> <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #6c71c4;">(</span>node<span style="color: #6c71c4;">)</span>
          <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #859900;">(</span>list? node<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>tree-map fn node<span style="color: #859900;">)</span>
              <span style="color: #859900;">(</span>fn node<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> tree<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org447d6dc" class="outline-3">
<h3 id="org447d6dc">Exercise: 2.32</h3>
<div class="outline-text-3" id="text-org447d6dc">
<p class="verse">
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (subsets s)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(if (null? s) (list null)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(let [(restl (subsets (cdr s)))]<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(append restl (map (λ (x) (cons (car s) x)) restl)))))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;;; &#x2013; UTILITIES --------------------------------&#x2013;&#x2014;<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (filter predicate sequence)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cond ((null? sequence) null)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;((predicate (car sequence))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cons (car sequence)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(filter predicate (cdr sequence))))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(else (filter predicate (cdr sequence)))))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (accumulate op initial sequence)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(if (null? sequence)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;initial<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(op (car sequence)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(accumulate op initial (cdr sequence)))))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (flatmap proc seq)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(accumulate append null (map proc seq)))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (permutations s)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(if (null? s)                    ; empty set?<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(list null)                  ; sequence containing empty set<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(flatmap (lambda (x)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(map (lambda (p) (cons x p))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(permutations (remove x s))))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;s)))<br>
;; ---------------------------------------------&#x2013;&#x2014;<br>
</p>
</div>
<div id="outline-container-orgfc05413" class="outline-4">
<h4 id="orgfc05413">Answer</h4>
<div class="outline-text-4" id="text-orgfc05413">
<div class="org-src-container">
<pre class="src src-scheme">#
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">map-z</span> p sequence<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>accumulate <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #6c71c4;">(</span>x y<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>cons <span style="color: #859900;">(</span>p x<span style="color: #859900;">)</span> y<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> null sequence<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">append-z</span> seq1 seq2<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>accumulate cons seq2 seq1<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">length-z</span> sequence<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>accumulate <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #6c71c4;">(</span>x y<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>+ y <span style="color: #6c71c4;">1</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> <span style="color: #6c71c4;">0</span> sequence<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>


</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orga18c665" class="outline-3">
<h3 id="orga18c665">Exercise: 2.34</h3>
<div class="outline-text-3" id="text-orga18c665">
<p class="verse">
Evaluating a polynomial in x at a given value of x can be formulated as an<br>
accumulation. We evaluate the polynomial<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;a<sub>n</sub> r<sup>n</sup> | a<sub>(n-1)</sub> r<sup>(n-1)</sup> + &#x2026; + a<sub>1</sub> r + a<sub>0</sub><br>
<br>
using a well-known algorithm called "Horner's rule", which structures the<br>
computation as<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(&#x2026; (a<sub>n</sub> r + a<sub>(n-1)</sub>) r + &#x2026; + a<sub>1</sub>) r + a<sub>0</sub><br>
<br>
In other words, we start with a<sub>n</sub>, multiply by x, add a<sub>(n-1)</sub>, multiply by<br>
x, and so on, until we reach a<sub>0</sub>.(3)<br>
<br>
Fill in the following template to produce a procedure that evaluates a<br>
polynomial using Horner's rule. Assume that the coefficients of the<br>
polynomial are arranged in a sequence, from a<sub>0</sub> through a<sub>n</sub>.<br>
<br>
(define (horner-eval x coefficient-sequence) (accumulate (lambda<br>
(this-coeff higher-terms) &lt;??&gt;) 0 coefficient-sequence))<br>
<br>
For quote, to compute 1 + 3x + 5x<sup>3</sup> + x<sup>(5)</sup> at x = 2 you would evaluate<br>
</p>
</div>
<div id="outline-container-org20c2a53" class="outline-4">
<h4 id="org20c2a53">Answer</h4>
<div class="outline-text-4" id="text-org20c2a53">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">horner-eval</span> x coefficient-sequence<span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span>accumulate <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #859900;">(</span>this-coeff higher-terms<span style="color: #859900;">)</span>
                 <span style="color: #859900;">(</span>+ this-coeff <span style="color: #b58900;">(</span>* x higher-terms<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
               <span style="color: #6c71c4;">0</span>
               coefficient-sequence<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>


</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb734fff" class="outline-3">
<h3 id="orgb734fff">Exercise: 2.35</h3>
<div class="outline-text-3" id="text-orgb734fff">
<p class="verse">
Redefine `count-leaves' from section *Note 2-2-2 as an accumulation:<br>
</p>
</div>
<div id="outline-container-org5aaa3d7" class="outline-4">
<h4 id="org5aaa3d7">Answer</h4>
<div class="outline-text-4" id="text-org5aaa3d7">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">count-leaves-z</span> t<span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span>accumulate + <span style="color: #6c71c4;">0</span> <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">map</span> count-leaves t<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc77a510" class="outline-3">
<h3 id="orgc77a510">Exercise: 2.36</h3>
</div>

<div id="outline-container-org4e5859f" class="outline-3">
<h3 id="org4e5859f">Exercise: 2.37</h3>
<div class="outline-text-3" id="text-org4e5859f">
<p class="verse">
Suppose we represent vectors v = (v<sub>i</sub>) as sequences of numbers, and<br>
matrices m = (m<sub>(ij)</sub>) as sequences of vectors (the rows of the matrix). For<br>
quote, the matrix<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;<del>- -</del> | 1 2 3 4 | | 4 5 6 6 | | 6 7 8 9 | <del>- -</del><br>
<br>
is represented as the sequence `((1 2 3 4) (4 5 6 6) (6 7 8 9))'. With this<br>
representation, we can use sequence operations to concisely express the<br>
basic matrix and vector operations. These operations (which are described<br>
in any book on matrix algebra) are the following:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;__ (dot-product v w) returns the sum &gt;<sub>i</sub> v<sub>i</sub> w<sub>i</sub><br>
<br>
(matrix-*-vector m v) returns the vector t, __ where t<sub>i</sub> = &gt;<sub>j</sub> m<sub>(ij)</sub> v<sub>j</sub><br>
<br>
(matrix-*-matrix m n) returns the matrix p, __ where p<sub>(ij)</sub> = &gt;<sub>k</sub> m<sub>(ik)</sub><br>
n<sub>(kj)</sub><br>
<br>
(transpose m) returns the matrix n, where n<sub>(ij)</sub> = m<sub>(ji)</sub><br>
<br>
We can define the dot product as(4)<br>
<br>
(define (dot-product v w) (accumulate + 0 (map * v w)))<br>
<br>
Fill in the missing expressions in the following procedures for computing<br>
the other matrix operations. (The procedure `accumulate-n' is defined in<br>
*Note Exercise 2-36::.)<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (matrix-*-vector m v) (map &lt;??&gt; m))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (transpose mat) (accumulate-n &lt;??&gt; &lt;??&gt; mat))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (matrix-*-matrix m n) (let ((cols (transpose n))) (map &lt;??&gt; m)))<br>
</p>
</div>
<div id="outline-container-org4808f23" class="outline-4">
<h4 id="org4808f23">Answer</h4>
<div class="outline-text-4" id="text-org4808f23">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">zv-matrix</span> '<span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span><span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">2</span> <span style="color: #6c71c4;">3</span> <span style="color: #6c71c4;">4</span><span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">4</span> <span style="color: #6c71c4;">5</span> <span style="color: #6c71c4;">6</span> <span style="color: #6c71c4;">6</span><span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">6</span> <span style="color: #6c71c4;">7</span> <span style="color: #6c71c4;">8</span> <span style="color: #6c71c4;">9</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">zv-square</span> '<span style="color: #b58900;">(</span><span style="color: #268bd2;">(</span><span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">2</span> <span style="color: #6c71c4;">3</span><span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">4</span> <span style="color: #6c71c4;">5</span> <span style="color: #6c71c4;">6</span><span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">6</span> <span style="color: #6c71c4;">7</span> <span style="color: #6c71c4;">8</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">dot-product</span> v w<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>accumulate + <span style="color: #6c71c4;">0</span> <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">map</span> * v w<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">matrix-*-vector</span> m v<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">map</span> <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #6c71c4;">(</span>row<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>dot-product row v<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> m<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">transpose</span> mat<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>accumulate-n cons '<span style="color: #268bd2;">()</span> mat<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">matrix-*-matrix</span> m n<span style="color: #b58900;">)</span>
   <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>elems <span style="color: #859900;">(</span>transpose n<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
     <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">map</span> <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #859900;">(</span>row<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>matrix-*-vector elems row<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> m<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdd93279" class="outline-3">
<h3 id="orgdd93279">Exercise: 2.38</h3>
<div class="outline-text-3" id="text-orgdd93279">
<p class="verse">
The `accumulate' procedure is also known as `fold-right', because it<br>
combines the first element of the sequence with the result of combining all<br>
the elements to the right. There is also a `fold-left', which is similar to<br>
`fold-right', except that it combines elements working in the opposite<br>
direction:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (fold-left op initial sequence) (define (iter result rest) (if<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(null? rest) result (iter (op result (car rest)) (cdr rest)))) (iter<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;initial sequence))<br>
<br>
What are the values of<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(fold-right / 1 (list 1 2 3))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(fold-left / 1 (list 1 2 3))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(fold-right list nil (list 1 2 3))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(fold-left list nil (list 1 2 3))<br>
<br>
Give a property that `op' should satisfy to guarantee that `fold-right' and<br>
`fold-left' will produce the same values for any sequence.<br>
</p>
</div>
<div id="outline-container-org708494e" class="outline-4">
<h4 id="org708494e">Answer</h4>
<div class="outline-text-4" id="text-org708494e">
<div class="org-src-container">
<pre class="src src-scheme">
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org4ab52a9" class="outline-3">
<h3 id="org4ab52a9">Exercise: 2.39</h3>
<div class="outline-text-3" id="text-org4ab52a9">
<p class="verse">
Complete the following definitions of `reverse' (*Note Exercise 2-18::) in<br>
terms of `fold-right' and `fold-left' from *Note Exercise 2-38:::<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (reverse sequence) (fold-right (lambda (x y) &lt;??&gt;) nil sequence))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (reverse sequence) (fold-left (lambda (x y) &lt;??&gt;) nil sequence))<br>
</p>
</div>
<div id="outline-container-org6427dfa" class="outline-4">
<h4 id="org6427dfa">Answer</h4>
<div class="outline-text-4" id="text-org6427dfa">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">reverse-fr</span> sequence<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>foldr <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #6c71c4;">(</span>x y<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>append y `<span style="color: #859900;">(</span>,x<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> null sequence<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">reverse-fl</span> sequence<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>foldl <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #6c71c4;">(</span>x y<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>cons x y<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> null sequence<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc8ffc4a" class="outline-3">
<h3 id="orgc8ffc4a">Exercise: 2.40</h3>
<div class="outline-text-3" id="text-orgc8ffc4a">
<p class="verse">
Define a procedure `unique-pairs' that, given an integer n, generates the<br>
sequence of pairs (i,j) with 1 &lt;= j&lt; i &lt;= n. Use `unique-pairs' to simplify<br>
the definition of `prime-sum-pairs' given above.<br>
</p>
</div>
<div id="outline-container-orgdf91541" class="outline-4">
<h4 id="orgdf91541">Answer</h4>
<div class="outline-text-4" id="text-orgdf91541">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">unique-pairs</span> n<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>flatmap <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #6c71c4;">(</span>i<span style="color: #6c71c4;">)</span>
             <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">map</span> <span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #b58900;">(</span>j<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>list i j<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
                  <span style="color: #859900;">(</span>range i n<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
           <span style="color: #268bd2;">(</span>range <span style="color: #6c71c4;">1</span> n<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">prime?</span> n<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>empty?
   <span style="color: #268bd2;">(</span>filter <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #859900;">(</span>p<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>= n <span style="color: #b58900;">(</span>* <span style="color: #268bd2;">(</span>car p<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>cadr p<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
           <span style="color: #6c71c4;">(</span>unique-pairs n<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">prime-sum?</span> pair<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>prime? <span style="color: #268bd2;">(</span>+ <span style="color: #6c71c4;">(</span>car pair<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>cadr pair<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-pair-sum</span> pair<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>list <span style="color: #268bd2;">(</span>car pair<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>cadr pair<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>+ <span style="color: #6c71c4;">(</span>car pair<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>cadr pair<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">prime-sum-pairs</span> n<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">map</span> make-pair-sum <span style="color: #268bd2;">(</span>filter prime-sum? <span style="color: #6c71c4;">(</span>unique-pairs n<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org78cd3d0" class="outline-3">
<h3 id="org78cd3d0">Exercise: 2.41</h3>
<div class="outline-text-3" id="text-org78cd3d0">
<p class="verse">
Write a procedure to find all ordered triples of distinct positive integers<br>
i, j, and k less than or equal to a given integer n that sum to a given<br>
integer s.<br>
</p>
</div>
<div id="outline-container-orgfc759ee" class="outline-4">
<h4 id="orgfc759ee">Answer</h4>
<div class="outline-text-4" id="text-orgfc759ee">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">triplets-summing-to</span> s n<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">unique-triplets</span> n<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>flatmap <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #859900;">(</span>i<span style="color: #859900;">)</span>
               <span style="color: #859900;">(</span>flatmap <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #268bd2;">(</span>j<span style="color: #268bd2;">)</span>
                          <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">map</span> <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #859900;">(</span>k<span style="color: #859900;">)</span>
                                 <span style="color: #859900;">(</span>list i j k<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
                               <span style="color: #6c71c4;">(</span>range j n<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
                        <span style="color: #b58900;">(</span>range i n<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
             <span style="color: #6c71c4;">(</span>range <span style="color: #6c71c4;">0</span> n<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

  <span style="color: #b58900;">(</span>filter <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #6c71c4;">(</span>t<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>= s <span style="color: #859900;">(</span>foldr + <span style="color: #6c71c4;">0</span> t<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
          <span style="color: #268bd2;">(</span>unique-triplets n<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0ae7c7f" class="outline-3">
<h3 id="org0ae7c7f">Exercise: 2.41</h3>
<div class="outline-text-3" id="text-org0ae7c7f">
<p class="verse">
The "eight-queens puzzle" asks how to place eight queens on a chessboard so<br>
that no queen is in check from any other (i.e., no two queens are in the<br>
same row, column, or diagonal). One possible solution is shown in *Note<br>
Figure 2-8. One way to solve the puzzle is to work across the board,<br>
placing a queen in each column. Once we have placed k - 1 queens, we must<br>
place the kth queen in a position where it does not check any of the queens<br>
already on the board. We can formulate this approach recursively: Assume<br>
that we have already generated the sequence of all possible ways to place k<br>
- 1 queens in the first k - 1 columns of the board. For each of these ways,<br>
generate an extended set of positions by placing a queen in each row of the<br>
kth column. Now filter these, keeping only the positions for which the<br>
queen in the kth column is safe with respect to the other queens. This<br>
produces the sequence of all ways to place k queens in the first k columns.<br>
By continuing this process, we will produce not only one solution, but all<br>
solutions to the puzzle.<br>
<br>
We implement this solution as a procedure `queens', which returns a<br>
sequence of all solutions to the problem of placing n queens on an n*n<br>
chessboard. `Queens' has an internal procedure `queen-cols' that returns<br>
the sequence of all ways to place queens in the first k columns of the<br>
board.<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (queens board-size) (define (queen-cols k) (if (= k 0) (list<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;empty-board) (filter (lambda (positions) (safe? k positions)) (flatmap<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(lambda (rest-of-queens) (map (lambda (new-row) (adjoin-position new-row k<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;rest-of-queens)) (enumerate-interval 1 board-size))) (queen-cols (- k<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;1)))))) (queen-cols board-size))<br>
<br>
In this procedure `rest-of-queens' is a way to place k - 1 queens in the<br>
first k - 1 columns, and `new-row' is a proposed row in which to place the<br>
queen for the kth column. Complete the program by implementing the<br>
representation for sets of board positions, including the procedure<br>
`adjoin-position', which adjoins a new row-column position to a set of<br>
positions, and `empty-board', which represents an empty set of positions.<br>
You must also write the procedure `safe?', which determines for a set of<br>
positions, whether the queen in the kth column is safe with respect to the<br>
others. (Note that we need only check whether the new queen is safe&#x2013;the<br>
other queens are already guaranteed safe with respect to each other.)<br>
</p>
</div>
<div id="outline-container-orgdeeb7ba" class="outline-4">
<h4 id="orgdeeb7ba">Answer</h4>
<div class="outline-text-4" id="text-orgdeeb7ba">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">queens</span> board-size<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">queen-cols</span> k<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">(</span>= k <span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">)</span>
        <span style="color: #6c71c4;">(</span>list empty-board<span style="color: #6c71c4;">)</span>
        <span style="color: #6c71c4;">(</span>filter
         <span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #b58900;">(</span>positions<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>safe? k positions<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
         <span style="color: #859900;">(</span>flatmap
          <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #268bd2;">(</span>rest-of-queens<span style="color: #268bd2;">)</span>
            <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">map</span> <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #859900;">(</span>new-row<span style="color: #859900;">)</span>
                   <span style="color: #859900;">(</span>adjoin-position new-row k rest-of-queens<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
                 <span style="color: #6c71c4;">(</span>range <span style="color: #6c71c4;">1</span> board-size<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
          <span style="color: #b58900;">(</span>queen-cols <span style="color: #268bd2;">(</span>- k <span style="color: #6c71c4;">1</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>queen-cols board-size<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">(struct posn (row col)</span>
<span style="color: #93a1a1;">;;   </span><span style="color: #93a1a1;">#:transparent)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">(define (make-position row col) (cons row col))</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">(define empty-board null)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">(define (adjoin-position row col positions)</span>
<span style="color: #93a1a1;">;;   </span><span style="color: #93a1a1;">(append positions (list (posn row col))))</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">(define (safe? col positions)</span>
<span style="color: #93a1a1;">;;   </span><span style="color: #93a1a1;">(let ((kth-queen (list-ref positions (- col 1)))</span>
<span style="color: #93a1a1;">;;         </span><span style="color: #93a1a1;">(other-queens (filter (&#955; (q)</span>
<span style="color: #93a1a1;">;;                                 </span><span style="color: #93a1a1;">(not (= col (posn-col q))))</span>
<span style="color: #93a1a1;">;;                               </span><span style="color: #93a1a1;">positions)))</span>
<span style="color: #93a1a1;">;;     </span><span style="color: #93a1a1;">(define (attacks? q1 q2)</span>
<span style="color: #93a1a1;">;;       </span><span style="color: #93a1a1;">;; what the fuck???</span>
<span style="color: #93a1a1;">;;       </span><span style="color: #93a1a1;">(or (= (posn-row q1) (posn-row q2))</span>
<span style="color: #93a1a1;">;;           </span><span style="color: #93a1a1;">(= (abs (- (posn-row q1) (posn-row q2)))</span>
<span style="color: #93a1a1;">;;              </span><span style="color: #93a1a1;">(abs (- (posn-col q1) (posn-col q2))))))</span>

<span style="color: #93a1a1;">;;     </span><span style="color: #93a1a1;">(define (iter q board)</span>
<span style="color: #93a1a1;">;;       </span><span style="color: #93a1a1;">(or (null? board)</span>
<span style="color: #93a1a1;">;;           </span><span style="color: #93a1a1;">(and (not (attacks? q (car board)))</span>
<span style="color: #93a1a1;">;;                </span><span style="color: #93a1a1;">(iter q (cdr board)))))</span>
<span style="color: #93a1a1;">;;     </span><span style="color: #93a1a1;">(iter kth-queen other-queens)))</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">empty-board</span> null<span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">adjoin-position</span> row positions<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>cons row positions<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">safe?</span> position<span style="color: #b58900;">)</span>

  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">board-size</span> <span style="color: #268bd2;">(</span>length position<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">safe-diagonal?</span> position<span style="color: #268bd2;">)</span>

    <span style="color: #93a1a1;">; </span><span style="color: #93a1a1;">test the position for the newly placed queen</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #6c71c4;">(</span><span style="color: #268bd2;">col-safe?</span> new-row col position<span style="color: #6c71c4;">)</span>
      <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #859900;">(</span><span style="color: #b58900;">(</span>&gt; col board-size<span style="color: #b58900;">)</span> true<span style="color: #859900;">)</span>
            <span style="color: #859900;">(</span><span style="color: #b58900;">(</span>= <span style="color: #268bd2;">(</span>abs <span style="color: #6c71c4;">(</span>- new-row <span style="color: #859900;">(</span>car position<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
                <span style="color: #93a1a1;">; </span><span style="color: #93a1a1;">the new qeeen's position is always on column 1</span>
                <span style="color: #268bd2;">(</span>abs <span style="color: #6c71c4;">(</span>- col <span style="color: #6c71c4;">1</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span> false<span style="color: #859900;">)</span>
            <span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #b58900;">(</span>col-safe? new-row <span style="color: #268bd2;">(</span>+ col <span style="color: #6c71c4;">1</span><span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>cdr position<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>

    <span style="color: #93a1a1;">; </span><span style="color: #93a1a1;">the new queen's position is always in column 1</span>
    <span style="color: #93a1a1;">; </span><span style="color: #93a1a1;">so the initial column to check is always 2</span>
    <span style="color: #268bd2;">(</span>col-safe? <span style="color: #6c71c4;">(</span>car position<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">2</span> <span style="color: #6c71c4;">(</span>cdr position<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">safe-horizontal?</span> position<span style="color: #268bd2;">)</span>
    <span style="color: #93a1a1;">; </span><span style="color: #93a1a1;">does the new row (car) appear anywhere else?</span>
    <span style="color: #268bd2;">(</span>not <span style="color: #6c71c4;">(</span>member <span style="color: #859900;">(</span>car position<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>cdr position<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>

  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">or</span> <span style="color: #268bd2;">(</span>= <span style="color: #6c71c4;">(</span>length position<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">1</span><span style="color: #268bd2;">)</span>  <span style="color: #93a1a1;">; </span><span style="color: #93a1a1;">1x1 board</span>
      <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">and</span> <span style="color: #6c71c4;">(</span>safe-horizontal? position<span style="color: #6c71c4;">)</span>
           <span style="color: #6c71c4;">(</span>safe-diagonal?   position<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7cd85a7" class="outline-3">
<h3 id="org7cd85a7">Exercise: 2.53</h3>
<div class="outline-text-3" id="text-org7cd85a7">
<p class="verse">
What would the interpreter print in response to evaluating each of the<br>
following expressions?<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(list 'a 'b 'c)<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(list (list 'george))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cdr '((x1 x2) (y1 y2)))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cadr '((x1 x2) (y1 y2)))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(pair? (car '(a short list)))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(memq 'red '((red shoes) (blue socks)))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(memq 'red '(red shoes blue socks))<br>
</p>
</div>
<div id="outline-container-org39508a4" class="outline-4">
<h4 id="org39508a4">Answer</h4>
<div class="outline-text-4" id="text-org39508a4">
<div class="org-src-container">
<pre class="src src-scheme">
<span style="color: #93a1a1;">;;; </span><span style="color: #93a1a1;">(list 'a 'b 'c)                         =&gt; '(a b c)</span>
<span style="color: #93a1a1;">;;; </span><span style="color: #93a1a1;">(list (list 'george))                   =&gt; '((georger))</span>
<span style="color: #93a1a1;">;;; </span><span style="color: #93a1a1;">(cdr '((x1 x2) (y1 y2)))                =&gt; '(y1 y2)</span>
<span style="color: #93a1a1;">;;; </span><span style="color: #93a1a1;">(cadr '((x1 x2) (y1 y2)))               =&gt; '(y1 y2)</span>
<span style="color: #93a1a1;">;;; </span><span style="color: #93a1a1;">(pair? (car '(a short list)))           =&gt; 'a</span>
<span style="color: #93a1a1;">;;; </span><span style="color: #93a1a1;">(memq 'red '((red shoes) (blue socks))) =&gt; null</span>
<span style="color: #93a1a1;">;;; </span><span style="color: #93a1a1;">(memq 'red '(red shoes blue socks))     =&gt; '(shoes blue socks)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9391ef8" class="outline-3">
<h3 id="org9391ef8">Exercise: 2.54</h3>
<div class="outline-text-3" id="text-org9391ef8">
<p class="verse">
Two lists are said to be `equal?' if they contain equal elements arranged<br>
in the same order. For quote,<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(equal? '(this is a list) '(this is a list))<br>
<br>
is true, but<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(equal? '(this is a list) '(this (is a) list))<br>
<br>
is false. To be more precise, we can define `equal?' recursively in terms<br>
of the basic `eq?' equality of symbols by saying that `a' and `b' are<br>
`equal?' if they are both symbols and the symbols are `eq?', or if they are<br>
both lists such that `(car a)' is `equal?' to `(car b)' and `(cdr a)' is<br>
`equal?' to `(cdr b)'. Using this idea, implement `equal?' as a<br>
procedure.(5)<br>
<br>
</p>
</div>
<div id="outline-container-org431ba66" class="outline-4">
<h4 id="org431ba66">Answer</h4>
<div class="outline-text-4" id="text-org431ba66">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">zv-equal?</span> a b<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">or</span> <span style="color: #859900;">(</span>empty? a<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>empty? b<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>eq? a b<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">and</span> <span style="color: #859900;">(</span>list? a<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>list? b<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">and</span> <span style="color: #859900;">(</span>eq? <span style="color: #b58900;">(</span>car a<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>car b<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
              <span style="color: #859900;">(</span>zv-equal? <span style="color: #b58900;">(</span>cdr a<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>cdr b<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">or</span> <span style="color: #859900;">(</span>list? a<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>list? b<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> false<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #6c71c4;">(</span>eq? a b<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc9950f6" class="outline-3">
<h3 id="orgc9950f6">Exercise: 2.55</h3>
<div class="outline-text-3" id="text-orgc9950f6">
<p class="verse">
Eva Lu Ator types to the interpreter the expression<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(car ''abracadabra)<br>
<br>
To her surprise, the interpreter prints back `quote'. Explain.<br>
</p>
</div>
<div id="outline-container-orge266e23" class="outline-4">
<h4 id="orge266e23">Answer</h4>
<div class="outline-text-4" id="text-orge266e23">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">It is a "double quoted" item, e.g the symbols (quote abracadabra) resolve to</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">the *function* quote, which is created from syntax sugar.</span>

&#12;
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">Utilities</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">deriv</span> expr var<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>number? expr<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">0</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>variable? expr<span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #859900;">(</span>same-variable? expr var<span style="color: #859900;">)</span> <span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>sum? expr<span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>make-sum <span style="color: #859900;">(</span>deriv <span style="color: #b58900;">(</span>addend expr<span style="color: #b58900;">)</span> var<span style="color: #859900;">)</span>
                   <span style="color: #859900;">(</span>deriv <span style="color: #b58900;">(</span>augend expr<span style="color: #b58900;">)</span> var<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>product? expr<span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>make-sum
          <span style="color: #859900;">(</span>make-product
           <span style="color: #b58900;">(</span>multiplier expr<span style="color: #b58900;">)</span>
           <span style="color: #b58900;">(</span>deriv <span style="color: #268bd2;">(</span>multiplicand expr<span style="color: #268bd2;">)</span> var<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
          <span style="color: #859900;">(</span>make-product
           <span style="color: #b58900;">(</span>deriv <span style="color: #268bd2;">(</span>multiplier expr<span style="color: #268bd2;">)</span> var<span style="color: #b58900;">)</span>
           <span style="color: #b58900;">(</span>multiplicand expr<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>exponentiation? expr<span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>make-product
          <span style="color: #859900;">(</span>make-product
           <span style="color: #b58900;">(</span>exponent expr<span style="color: #b58900;">)</span>
           <span style="color: #b58900;">(</span>make-exponent <span style="color: #268bd2;">(</span>base expr<span style="color: #268bd2;">)</span>
                          <span style="color: #268bd2;">(</span>- <span style="color: #6c71c4;">(</span>exponent expr<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">1</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
          <span style="color: #859900;">(</span>deriv <span style="color: #b58900;">(</span>base expr<span style="color: #b58900;">)</span> var<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #6c71c4;">(</span>error <span style="color: #2aa198;">"unknown exprression type: DERIV"</span> expr<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">variable?</span> x<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>symbol? x<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">same-variable?</span> v1 v2<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">and</span> <span style="color: #268bd2;">(</span>variable? v1<span style="color: #268bd2;">)</span>
       <span style="color: #268bd2;">(</span>variable? v2<span style="color: #268bd2;">)</span>
       <span style="color: #268bd2;">(</span>eq? v1 v2<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">=number?</span> exp num<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">and</span> <span style="color: #268bd2;">(</span>number? exp<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>= exp num<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">A sum is a list whose first element is the symbol +:</span>
<span style="color: #93a1a1;">;; </span><span style="color: #cc9393;">TODO</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">sum?</span> x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">and</span> <span style="color: #268bd2;">(</span>list? x<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>eq? <span style="color: #6c71c4;">(</span>car x<span style="color: #6c71c4;">)</span> '+<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">product?</span> x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">and</span> <span style="color: #268bd2;">(</span>list? x<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>eq? <span style="color: #6c71c4;">(</span>car x<span style="color: #6c71c4;">)</span> '*<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
&#12;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd785d0f" class="outline-3">
<h3 id="orgd785d0f">Exercise: 2.56</h3>
<div class="outline-text-3" id="text-orgd785d0f">
<p class="verse">
Show how to extend the basic differentiator to handle more kinds of<br>
expressions. For instance, implement the differentiation rule<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;n<sub>1</sub> n<sub>2</sub> &#x2014; = &#x2014; if and only if n<sub>1</sub> d<sub>2</sub> = n<sub>2</sub> d<sub>1</sub> d<sub>1</sub> d<sub>2</sub><br>
<br>
by adding a new clause to the `deriv' program and defining appropriate<br>
procedures `exponentiation?', `base', `exponent', and<br>
`make-exponentiation'. (You may use the symbol `**' to denote<br>
exponentiation.) Build in the rules that anything raised to the power 0 is<br>
1 and anything raised to the power 1 is the thing itself.<br>
</p>
</div>
<div id="outline-container-org1ec2fc1" class="outline-4">
<h4 id="org1ec2fc1">Answer</h4>
<div class="outline-text-4" id="text-org1ec2fc1">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">exponentiation?</span> x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">and</span> <span style="color: #268bd2;">(</span>list? x<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>eq? <span style="color: #6c71c4;">(</span>car x<span style="color: #6c71c4;">)</span> 'expt<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">base</span> p<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>cadr p<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">exponent</span> p<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>caddr p<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-exponent</span> e1 e2<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>=number? e1 <span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">1</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>=number? e2 <span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">1</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">and</span> <span style="color: #859900;">(</span>number? e1<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>number? e2<span style="color: #859900;">)</span>
              <span style="color: #859900;">(</span>expt e1 e2<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #859900; font-weight: bold;">else</span> `<span style="color: #6c71c4;">(</span>expt ,e1 ,e2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb39328f" class="outline-3">
<h3 id="orgb39328f">Exercise: 2.57</h3>
<div class="outline-text-3" id="text-orgb39328f">
<p class="verse">
Extend the differentiation program to handle sums and products of arbitrary<br>
numbers of (two or more) terms. Then the last quote above could be<br>
expressed as<br>
<br>
(deriv '(* x y (+ x 3)) 'x)<br>
<br>
Try to do this by changing only the representation for sums and products,<br>
without changing the `deriv' procedure at all. For quote, the `addend' of<br>
a sum would be the first term, and the `augend' would be the sum of the<br>
rest of the terms.<br>
</p>
</div>
<div id="outline-container-org9985bfb" class="outline-4">
<h4 id="org9985bfb">Answer</h4>
<div class="outline-text-4" id="text-org9985bfb">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-sum</span> a1 a2<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>=number? a1 <span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">)</span> a2<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>=number? a2 <span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">)</span> a1<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">and</span> <span style="color: #859900;">(</span>number? a1<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>number? a2<span style="color: #859900;">)</span>
              <span style="color: #859900;">(</span>+ a1 a2<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #859900; font-weight: bold;">else</span> `<span style="color: #6c71c4;">(</span>+ ,a1 ,a2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-product</span> m1 m2<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">or</span> <span style="color: #859900;">(</span>=number? m1 <span style="color: #6c71c4;">0</span><span style="color: #859900;">)</span>
             <span style="color: #859900;">(</span>=number? m2 <span style="color: #6c71c4;">0</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">0</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>=number? m1 <span style="color: #6c71c4;">1</span><span style="color: #6c71c4;">)</span> m2<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>=number? m2 <span style="color: #6c71c4;">1</span><span style="color: #6c71c4;">)</span> m1<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">and</span> <span style="color: #859900;">(</span>number? m1<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>number? m2<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>* m1 m2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #6c71c4;">(</span>list '* m1 m2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">addend</span> s<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>cadr s<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">augend</span> s<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>null? <span style="color: #6c71c4;">(</span>cdddr s<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
      <span style="color: #268bd2;">(</span>caddr s<span style="color: #268bd2;">)</span>
      `<span style="color: #268bd2;">(</span>+ ,@<span style="color: #6c71c4;">(</span>cddr s<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">multiplier</span> s<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>cadr s<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">multiplicand</span> s<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>null? <span style="color: #6c71c4;">(</span>cdddr s<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
      <span style="color: #268bd2;">(</span>caddr s<span style="color: #268bd2;">)</span>
      `<span style="color: #268bd2;">(</span>* ,@<span style="color: #6c71c4;">(</span>cddr s<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org712455c" class="outline-3">
<h3 id="org712455c">Exercise: 2.58</h3>
<div class="outline-text-3" id="text-org712455c">
<p class="verse">
Suppose we want to modify the differentiation program so that it works with<br>
ordinary mathematical notation, in which `+' and `*' are infix rather than<br>
prefix operators. Since the differentiation program is defined in terms of<br>
abstract data, we can modify it to work with different representations of<br>
expressions solely by changing the predicates, selectors, and constructors<br>
that define the representation of the algebraic expressions on which the<br>
differentiator is to operate.<br>
<br>
a. Show how to do this in order to differentiate algebraic expressions<br>
presented in infix form, such as `(x + (3 * (x + (y + 2))))'. To simplify<br>
the task, assume that `+' and `*' always take two arguments and that<br>
expressions are fully parenthesized.<br>
<br>
b. The problem becomes substantially harder if we allow standard algebraic<br>
notation, such as `(x + 3 * (x + y + 2))', which drops unnecessary<br>
parentheses and assumes that multiplication is done before addition. Can<br>
you design appropriate predicates, selectors, and constructors for this<br>
notation such that our derivative program still works?<br>
<br>
<br>
</p>
</div>
<div id="outline-container-orgabb91f5" class="outline-4">
<h4 id="orgabb91f5">Answer</h4>
<div class="outline-text-4" id="text-orgabb91f5">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #93a1a1;">;;; </span><span style="color: #93a1a1;">1.</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">infix-addend</span> s<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>car s<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">infix-augend</span> s<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>caddr s<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">infix-multiplier</span> s<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>car s<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">infix-multiplicand</span> s<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>caddr s<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">infix-sum?</span> x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">and</span> <span style="color: #268bd2;">(</span>list? x<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>eq? <span style="color: #6c71c4;">(</span>cadr x<span style="color: #6c71c4;">)</span> '+<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">infix-product?</span> x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">and</span> <span style="color: #268bd2;">(</span>list? x<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>eq? <span style="color: #6c71c4;">(</span>cadr x<span style="color: #6c71c4;">)</span> '*<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">infix-make-sum</span> a1 a2<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>=number? a1 <span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">)</span> a2<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>=number? a2 <span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">)</span> a1<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">and</span> <span style="color: #859900;">(</span>number? a1<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>number? a2<span style="color: #859900;">)</span>
              <span style="color: #859900;">(</span>+ a1 a2<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #859900; font-weight: bold;">else</span> `<span style="color: #6c71c4;">(</span>,a1 + ,a2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">infix-make-product</span> m1 m2<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">or</span> <span style="color: #859900;">(</span>=number? m1 <span style="color: #6c71c4;">0</span><span style="color: #859900;">)</span>
             <span style="color: #859900;">(</span>=number? m2 <span style="color: #6c71c4;">0</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">0</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>=number? m1 <span style="color: #6c71c4;">1</span><span style="color: #6c71c4;">)</span> m2<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>=number? m2 <span style="color: #6c71c4;">1</span><span style="color: #6c71c4;">)</span> m1<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">and</span> <span style="color: #859900;">(</span>number? m1<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>number? m2<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>* m1 m2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #859900; font-weight: bold;">else</span> `<span style="color: #6c71c4;">(</span>,m1 * ,m2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">infix-deriv</span> expr var<span style="color: #b58900;">)</span>
  <span style="color: #2aa198;">"This function is for computing the derivative of a simple, infix'd function"</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>number? expr<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">0</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>variable? expr<span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #859900;">(</span>same-variable? expr var<span style="color: #859900;">)</span> <span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>infix-sum? expr<span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>infix-make-sum <span style="color: #859900;">(</span>infix-deriv <span style="color: #b58900;">(</span>infix-addend expr<span style="color: #b58900;">)</span> var<span style="color: #859900;">)</span>
                         <span style="color: #859900;">(</span>infix-deriv <span style="color: #b58900;">(</span>infix-augend expr<span style="color: #b58900;">)</span> var<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>infix-product? expr<span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>infix-make-sum
          <span style="color: #859900;">(</span>infix-make-product
           <span style="color: #b58900;">(</span>infix-multiplier expr<span style="color: #b58900;">)</span>
           <span style="color: #b58900;">(</span>infix-deriv <span style="color: #268bd2;">(</span>infix-multiplicand expr<span style="color: #268bd2;">)</span> var<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
          <span style="color: #859900;">(</span>infix-make-product
           <span style="color: #b58900;">(</span>infix-deriv <span style="color: #268bd2;">(</span>infix-multiplier expr<span style="color: #268bd2;">)</span> var<span style="color: #b58900;">)</span>
           <span style="color: #b58900;">(</span>infix-multiplicand expr<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #6c71c4;">(</span>error <span style="color: #2aa198;">"unknown exprression type: DERIV"</span> expr<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org888a952" class="outline-3">
<h3 id="org888a952">Exercise:</h3>
<div class="outline-text-3" id="text-org888a952">
</div>
<div id="outline-container-org69c6422" class="outline-4">
<h4 id="org69c6422">Answer</h4>
<div class="outline-text-4" id="text-org69c6422">
<div class="org-src-container">
<pre class="src src-scheme">
&#12;
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">Set Utils</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">element-of-set?</span> elt ss<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>empty? ss<span style="color: #6c71c4;">)</span> false<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>equal? elt <span style="color: #859900;">(</span>car ss<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> true<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #6c71c4;">(</span>element-of-set? elt <span style="color: #859900;">(</span>cdr ss<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">adjoin-set</span> elt ss<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>element-of-set? elt ss<span style="color: #268bd2;">)</span>
      set
      <span style="color: #268bd2;">(</span>cons elt ss<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">intersection</span> ss1 ss2<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">or</span> <span style="color: #859900;">(</span>empty? ss1<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>empty? ss2<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> null<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>element-of-set? <span style="color: #859900;">(</span>car ss1<span style="color: #859900;">)</span> ss2<span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>cons <span style="color: #859900;">(</span>car ss1<span style="color: #859900;">)</span>
               <span style="color: #859900;">(</span>intersection <span style="color: #b58900;">(</span>cdr ss1<span style="color: #b58900;">)</span> ss2<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #6c71c4;">(</span>intersection <span style="color: #859900;">(</span>cdr ss1<span style="color: #859900;">)</span> ss2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf34a106" class="outline-3">
<h3 id="orgf34a106">Exercise: 2.59</h3>
<div class="outline-text-3" id="text-orgf34a106">
<p class="verse">
Implement the `union-set' operation for the unordered-list representation<br>
of sets.<br>
</p>
</div>
<div id="outline-container-orgea8e0ea" class="outline-4">
<h4 id="orgea8e0ea">Answer</h4>
<div class="outline-text-4" id="text-orgea8e0ea">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">union-set</span> ss1 ss2<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">or</span> <span style="color: #859900;">(</span>empty? ss1<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>empty? ss2<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>append ss1 ss2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>element-of-set? <span style="color: #859900;">(</span>car ss1<span style="color: #859900;">)</span> ss2<span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>union-set <span style="color: #859900;">(</span>cdr ss1<span style="color: #859900;">)</span> ss2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #859900; font-weight: bold;">else</span>
         <span style="color: #6c71c4;">(</span>cons <span style="color: #859900;">(</span>car ss1<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>union-set <span style="color: #b58900;">(</span>cdr ss1<span style="color: #b58900;">)</span> ss2<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1cb1be1" class="outline-3">
<h3 id="org1cb1be1">Exercise: 2.60</h3>
<div class="outline-text-3" id="text-org1cb1be1">
<p class="verse">
We specified that a set would be represented as a list with no duplicates.<br>
Now suppose we allow duplicates. For instance, the set {1,2,3} could be<br>
represented as the list `(2 3 2 1 3 2 2)'. Design procedures<br>
`element-of-set?', `adjoin-set', `union-set', and `intersection-set' that<br>
operate on this representation. How does the efficiency of each compare<br>
with the corresponding procedure for the non-duplicate representation? Are<br>
there applications for which you would use this representation in<br>
preference to the non-duplicate one?<br>
</p>
</div>
<div id="outline-container-org32726fa" class="outline-4">
<h4 id="org32726fa">Answer</h4>
<div class="outline-text-4" id="text-org32726fa">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">element-of-joined-set?</span> elt ss<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>element-of-set? elt ss<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">adjoin-joined-set</span> elt ss<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>cons elt ss<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">adjoin-intersection</span> ss1 ss2<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>intersection ss1 ss2<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">adjoin-union-set</span> ss1 ss2<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>append ss1 ss2<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">Much cheaper, but to be useful it would require another deduplication pass.</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">element-of-set-ordered?</span> elt ss<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>empty? ss<span style="color: #6c71c4;">)</span> false<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>= elt <span style="color: #859900;">(</span>car ss<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> true<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>&lt; elt <span style="color: #859900;">(</span>car ss<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> false<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #6c71c4;">(</span>element-of-set-ordered? elt <span style="color: #859900;">(</span>cdr ss<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">intersection-ordered-set</span> set1 set2<span style="color: #b58900;">)</span>
  <span style="color: #2aa198;">"Begin by comparing the initial elements, x1 and x2, of the two sets. If x1</span>
<span style="color: #2aa198;">equals x2, then that gives an element of the intersection, and the rest of the</span>
<span style="color: #2aa198;">intersection is the intersection of the cdr-s of the two sets. Suppose, however,</span>
<span style="color: #2aa198;">that x1 is less than x2. Since x2 is the smallest element in set2, we can</span>
<span style="color: #2aa198;">immediately conclude that x1 cannot appear anywhere in set2 and hence is not in</span>
<span style="color: #2aa198;">the intersection. Hence, the intersection is equal to the intersection of set2</span>
<span style="color: #2aa198;">with the cdr of set1. Similarly, if x2 is less than x1, then the intersection is</span>
<span style="color: #2aa198;">given by the intersection of set1 with the cdr of set2. Here is the procedure"</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">or</span> <span style="color: #6c71c4;">(</span>null? set1<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>null? set2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> null
      <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #6c71c4;">[</span><span style="color: #859900;">(</span>x1 <span style="color: #b58900;">(</span>car set1<span style="color: #b58900;">)</span><span style="color: #859900;">)</span> <span style="color: #859900;">(</span>x2 <span style="color: #b58900;">(</span>car set2<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span>
        <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>= x1 x2<span style="color: #b58900;">)</span>
               <span style="color: #b58900;">(</span>cons x1 <span style="color: #268bd2;">(</span>intersection-ordered-set <span style="color: #6c71c4;">(</span>cdr set1<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>cdr set2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">]</span>
              <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>&lt; x1 x2<span style="color: #b58900;">)</span>
               <span style="color: #b58900;">(</span>intersection-ordered-set <span style="color: #268bd2;">(</span>cdr set1<span style="color: #268bd2;">)</span> set2<span style="color: #b58900;">)</span><span style="color: #859900;">]</span>
              <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>&gt; x1 x2<span style="color: #b58900;">)</span>
               <span style="color: #b58900;">(</span>intersection-ordered-set set1 <span style="color: #268bd2;">(</span>cdr set2<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">]</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2751794" class="outline-3">
<h3 id="org2751794">Exercise: 2.61</h3>
<div class="outline-text-3" id="text-org2751794">
<p class="verse">
Give an implementation of `adjoin-set' using the ordered representation. By<br>
analogy with `element-of-set?' show how to take advantage of the ordering<br>
to produce a procedure that requires on the average about half as many<br>
steps as with the unordered representation.<br>
</p>
</div>
<div id="outline-container-orge103a36" class="outline-4">
<h4 id="orge103a36">Answer</h4>
<div class="outline-text-4" id="text-orge103a36">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">adjoin-ordered-set</span> elt os<span style="color: #b58900;">)</span>
  <span style="color: #2aa198;">"Takes advantage of the ordering of the set to stop when elt &gt; (car os)"</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>empty? os<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>list elt<span style="color: #268bd2;">)</span>
      <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #6c71c4;">[</span><span style="color: #859900;">(</span>oelt <span style="color: #b58900;">(</span>car os<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span>
        <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>&lt; elt oelt<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>cons elt os<span style="color: #b58900;">)</span><span style="color: #859900;">]</span>
              <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>&gt; elt oelt<span style="color: #b58900;">)</span>
               <span style="color: #b58900;">(</span>cons oelt <span style="color: #268bd2;">(</span>adjoin-ordered-set elt <span style="color: #6c71c4;">(</span>cdr os<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">]</span>
              <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>= elt oelt<span style="color: #b58900;">)</span> os<span style="color: #859900;">]</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org47400d8" class="outline-3">
<h3 id="org47400d8">Exercise: 2.62</h3>
<div class="outline-text-3" id="text-org47400d8">
<p class="verse">
Give a [theta](n) implementation of `union-set' for sets represented as<br>
ordered lists.<br>
</p>
</div>
<div id="outline-container-org3b2f62e" class="outline-4">
<h4 id="org3b2f62e">Answer</h4>
<div class="outline-text-4" id="text-org3b2f62e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">union-ordered-set</span> ss1 ss2<span style="color: #b58900;">)</span>
  <span style="color: #2aa198;">"Perform an O(n) union of 2 ordered sets"</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">or</span> <span style="color: #6c71c4;">(</span>empty? ss1<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>empty? ss2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>append ss1 ss2<span style="color: #268bd2;">)</span>
      <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #6c71c4;">[</span><span style="color: #859900;">(</span>x1 <span style="color: #b58900;">(</span>car ss1<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
            <span style="color: #859900;">(</span>x2 <span style="color: #b58900;">(</span>car ss2<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span>
        <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>= x1 x2<span style="color: #b58900;">)</span>
               <span style="color: #b58900;">(</span>cons x1 <span style="color: #268bd2;">(</span>union-ordered-set <span style="color: #6c71c4;">(</span>cdr ss1<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>cdr ss2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">]</span>
              <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>&lt; x1 x2<span style="color: #b58900;">)</span>
               <span style="color: #b58900;">(</span>cons x1 <span style="color: #268bd2;">(</span>union-ordered-set <span style="color: #6c71c4;">(</span>cdr ss1<span style="color: #6c71c4;">)</span> ss2<span style="color: #268bd2;">)</span> <span style="color: #b58900;">)</span><span style="color: #859900;">]</span>
              <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>&gt; x1 x2<span style="color: #b58900;">)</span>
               <span style="color: #b58900;">(</span>cons x2 <span style="color: #268bd2;">(</span>union-ordered-set ss1 <span style="color: #6c71c4;">(</span>cdr ss2<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> <span style="color: #b58900;">)</span><span style="color: #859900;">]</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1f443d9" class="outline-3">
<h3 id="org1f443d9">Exercise: 2.63</h3>
<div class="outline-text-3" id="text-org1f443d9">
<p class="verse">
Each of the following two procedures converts a binary tree to a list.<br>
<br>
(define (tree-&gt;list-1 tree)<br>
&#xa0;&#xa0;(if (null? tree)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;'()<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(append (tree-&gt;list-1 (left-branch tree))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cons (entry tree)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(tree-&gt;list-1 (right-branch tree))))))<br>
<br>
(define (tree-&gt;list-2 tree)<br>
&#xa0;&#xa0;(define (copy-to-list tree result-list)<br>
&#xa0;&#xa0;&#xa0;&#xa0;(if (null? tree)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;result-list<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(copy-to-list (left-branch tree)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cons (entry tree)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(copy-to-list (right-branch tree)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;result-list)))))<br>
&#xa0;&#xa0;(copy-to-list tree '()))<br>
<br>
a. Do the two procedures produce the same result for every tree?<br>
If not, how do the results differ?  What lists do the two<br>
procedures produce for the trees in *Note Figure 2-16::?<br>
<br>
b. Do the two procedures have the same order of growth in the<br>
number of steps required to convert a balanced tree with n<br>
elements to a list?  If not, which one grows more slowly?<br>
</p>
</div>
<div id="outline-container-org321574b" class="outline-4">
<h4 id="org321574b">Answer</h4>
<div class="outline-text-4" id="text-org321574b">
<div class="org-src-container">
<pre class="src src-scheme">
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">sum-of-halves</span> n<span style="color: #b58900;">)</span>
  <span style="color: #2aa198;">"Get the limit of a half a number, plus half of that, and so on"</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>= <span style="color: #6c71c4;">0</span> n<span style="color: #268bd2;">)</span> <span style="color: #6c71c4;">0</span>
      <span style="color: #268bd2;">(</span>+ n <span style="color: #6c71c4;">(</span>sum-of-halves <span style="color: #859900;">(</span>quotient n <span style="color: #6c71c4;">2</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">get-depth</span> tree<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>null? tree<span style="color: #268bd2;">)</span> <span style="color: #6c71c4;">0</span>
      <span style="color: #268bd2;">(</span>+ <span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">(</span>max <span style="color: #859900;">(</span>get-depth <span style="color: #b58900;">(</span>node-right tree<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
           <span style="color: #859900;">(</span>get-depth <span style="color: #b58900;">(</span>node-left tree<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> <span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>struct node <span style="color: #b58900;">(</span>val left right<span style="color: #b58900;">)</span>
  <span style="color: #657b83; font-weight: bold;">#:transparent</span>
  <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">#:methods gen:custom-write</span>
  <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">[(define (write-proc self port mode)</span>
  <span style="color: #93a1a1;">;;    </span><span style="color: #93a1a1;">(fprintf port "(val: ~a left: ~a right: ~a)"</span>
  <span style="color: #93a1a1;">;;             </span><span style="color: #93a1a1;">(node-val self)</span>
  <span style="color: #93a1a1;">;;             </span><span style="color: #93a1a1;">(node-left self)</span>
  <span style="color: #93a1a1;">;;             </span><span style="color: #93a1a1;">(node-right self)))]</span>
  <span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">element-of-bset?</span> elt ss<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>null? ss<span style="color: #6c71c4;">)</span> null<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>= elt <span style="color: #859900;">(</span>node-val ss<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> true<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>&lt; elt <span style="color: #859900;">(</span>node-val ss<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>element-of-bset? elt <span style="color: #859900;">(</span>node-left ss<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>&gt; elt <span style="color: #859900;">(</span>node-val ss<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>element-of-bset? elt <span style="color: #859900;">(</span>node-right ss<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">adjoin-bset</span> elt ss<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>null? ss<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>node elt null null<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>= elt <span style="color: #859900;">(</span>node-val ss<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> ss<span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>&lt; elt <span style="color: #859900;">(</span>node-val ss<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>node <span style="color: #859900;">(</span>node-val ss<span style="color: #859900;">)</span>
               <span style="color: #859900;">(</span>adjoin-bset elt <span style="color: #b58900;">(</span>node-left ss<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
               <span style="color: #859900;">(</span>node-right ss<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>&gt; elt <span style="color: #859900;">(</span>node-val ss<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>node <span style="color: #859900;">(</span>node-val ss<span style="color: #859900;">)</span>
               <span style="color: #859900;">(</span>node-left ss<span style="color: #859900;">)</span>
               <span style="color: #859900;">(</span>adjoin-bset elt <span style="color: #b58900;">(</span>node-right ss<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-random-bset</span> maxct <span style="color: #268bd2;">[</span>ct <span style="color: #6c71c4;">0</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span>
  <span style="color: #2aa198;">"Helper function to create a binary treeset"</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>&lt; maxct ct<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>adjoin-bset <span style="color: #6c71c4;">(</span>random maxct<span style="color: #6c71c4;">)</span> null<span style="color: #268bd2;">)</span>
      <span style="color: #268bd2;">(</span>adjoin-bset <span style="color: #6c71c4;">(</span>random maxct<span style="color: #6c71c4;">)</span>
                   <span style="color: #6c71c4;">(</span>make-random-bset maxct <span style="color: #859900;">(</span>inc ct<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-linear-bset</span> maxct <span style="color: #268bd2;">[</span>ct <span style="color: #6c71c4;">0</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span>
  <span style="color: #2aa198;">"Helper function to create a binary treeset"</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>&lt; maxct ct<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>adjoin-bset ct null<span style="color: #268bd2;">)</span>
      <span style="color: #268bd2;">(</span>adjoin-bset ct
                   <span style="color: #6c71c4;">(</span>make-linear-bset maxct <span style="color: #859900;">(</span>inc ct<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc87cef5" class="outline-3">
<h3 id="orgc87cef5">Exercise: 2.63</h3>
<div class="outline-text-3" id="text-orgc87cef5">
</div>
<div id="outline-container-orge9442d7" class="outline-4">
<h4 id="orge9442d7">Answer</h4>
<div class="outline-text-4" id="text-orge9442d7">
<p class="verse">
1. I don't think they differ.<br>
2. The former grows faster than the latter because of the `append' call. The orders of growth are identical.<br>
</p>
</div>
</div>
<div id="outline-container-org17354dd" class="outline-4">
<h4 id="org17354dd">Answer</h4>
<div class="outline-text-4" id="text-org17354dd">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">tree-&gt;list-1</span> tree<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>null? tree<span style="color: #268bd2;">)</span>
      '<span style="color: #268bd2;">()</span>
      <span style="color: #268bd2;">(</span>append
       <span style="color: #6c71c4;">(</span>tree-&gt;list-1
        <span style="color: #859900;">(</span>node-left tree<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
       <span style="color: #6c71c4;">(</span>cons <span style="color: #859900;">(</span>node-val tree<span style="color: #859900;">)</span>
             <span style="color: #859900;">(</span>tree-&gt;list-1
              <span style="color: #b58900;">(</span>node-right tree<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">tree-&gt;list-2</span> tree<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">copy-to-list</span> tree result-list<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">(</span>null? tree<span style="color: #6c71c4;">)</span>
        result-list
        <span style="color: #6c71c4;">(</span>copy-to-list
         <span style="color: #859900;">(</span>node-left tree<span style="color: #859900;">)</span>
         <span style="color: #859900;">(</span>cons <span style="color: #b58900;">(</span>node-val tree<span style="color: #b58900;">)</span>
               <span style="color: #b58900;">(</span>copy-to-list
                <span style="color: #268bd2;">(</span>node-right tree<span style="color: #268bd2;">)</span>
                result-list<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>copy-to-list tree '<span style="color: #268bd2;">()</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org859fd50" class="outline-3">
<h3 id="org859fd50">Exercise: 2.64</h3>
<div class="outline-text-3" id="text-org859fd50">
<p class="verse">
<br>
Write a short paragraph explaining as clearly as you can how partial-tree works.<br>
<br>
Draw the tree produced by list-&gt;tree for the list (1 3 5 7 9 11).<br>
What is the order of growth in the number of steps required by list-&gt;tree to<br>
convert a list of n elements?<br>
<br>
Partial tree effectively performs binary search to split the tree.<br>
</p>
</div>
<div id="outline-container-org2a0fdbc" class="outline-4">
<h4 id="org2a0fdbc">Answer</h4>
<div class="outline-text-4" id="text-org2a0fdbc">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">partial-tree</span> elts n<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>= n <span style="color: #6c71c4;">0</span><span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>cons null elts<span style="color: #268bd2;">)</span>
      <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">let*</span> <span style="color: #6c71c4;">(</span><span style="color: #859900;">[</span>left-size      <span style="color: #b58900;">(</span>quotient <span style="color: #268bd2;">(</span>- n <span style="color: #6c71c4;">1</span><span style="color: #268bd2;">)</span> <span style="color: #6c71c4;">2</span><span style="color: #b58900;">)</span><span style="color: #859900;">]</span>
             <span style="color: #859900;">[</span>left-result    <span style="color: #b58900;">(</span>partial-tree elts left-size<span style="color: #b58900;">)</span><span style="color: #859900;">]</span>
             <span style="color: #859900;">[</span>left-tree      <span style="color: #b58900;">(</span>first left-result<span style="color: #b58900;">)</span><span style="color: #859900;">]</span>
             <span style="color: #859900;">[</span>right-elts     <span style="color: #b58900;">(</span>rest left-result<span style="color: #b58900;">)</span><span style="color: #859900;">]</span>
             <span style="color: #859900;">[</span>right-size     <span style="color: #b58900;">(</span>- n <span style="color: #268bd2;">(</span>+ left-size <span style="color: #6c71c4;">1</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">]</span>
             <span style="color: #859900;">[</span>this-entry     <span style="color: #b58900;">(</span>first right-elts<span style="color: #b58900;">)</span><span style="color: #859900;">]</span>
             <span style="color: #859900;">[</span>right-result   <span style="color: #b58900;">(</span>partial-tree <span style="color: #268bd2;">(</span>cdr right-elts<span style="color: #268bd2;">)</span>
                                           right-size<span style="color: #b58900;">)</span><span style="color: #859900;">]</span>
             <span style="color: #859900;">[</span>right-tree     <span style="color: #b58900;">(</span>first right-result<span style="color: #b58900;">)</span><span style="color: #859900;">]</span>
             <span style="color: #859900;">[</span>remaining-elts <span style="color: #b58900;">(</span>rest right-result<span style="color: #b58900;">)</span><span style="color: #859900;">]</span><span style="color: #6c71c4;">)</span>

        <span style="color: #6c71c4;">(</span>cons <span style="color: #859900;">(</span>node this-entry
                    left-tree
                    right-tree<span style="color: #859900;">)</span>
              remaining-elts<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">list-&gt;tree</span> elements<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>car <span style="color: #268bd2;">(</span>partial-tree
        elements <span style="color: #6c71c4;">(</span>length elements<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">tbsize</span> <span style="color: #6c71c4;">20</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">tbset</span> <span style="color: #b58900;">(</span>make-random-bset tbsize<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">tbbad</span> <span style="color: #b58900;">(</span>make-linear-bset tbsize<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">tbsorted</span> <span style="color: #b58900;">(</span>list-&gt;tree <span style="color: #268bd2;">(</span>range tbsize<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">nprint</span> p<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>pretty-print p <span style="color: #268bd2;">(</span>current-output-port<span style="color: #268bd2;">)</span> <span style="color: #6c71c4;">1</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>


<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">pprint</span> tree <span style="color: #268bd2;">[</span>depth <span style="color: #6c71c4;">0</span><span style="color: #268bd2;">]</span> <span style="color: #268bd2;">[</span>str <span style="color: #2aa198;">""</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>string-append
   <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">(</span>empty? <span style="color: #859900;">(</span>node-left tree<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> <span style="color: #2aa198;">""</span>
       <span style="color: #6c71c4;">(</span>string-append str <span style="color: #859900;">(</span>pprint <span style="color: #b58900;">(</span>node-left tree<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>+ <span style="color: #6c71c4;">1</span> depth<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>

    <span style="color: #268bd2;">(</span>string-append <span style="color: #6c71c4;">(</span>make-string <span style="color: #859900;">(</span>* <span style="color: #6c71c4;">2</span> depth<span style="color: #859900;">)</span> #\ <span style="color: #6c71c4;">)</span> str <span style="color: #6c71c4;">(</span>number-&gt;string <span style="color: #859900;">(</span>node-val tree<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> <span style="color: #2aa198;">"\n"</span><span style="color: #268bd2;">)</span>

   <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">(</span>empty? <span style="color: #859900;">(</span>node-right tree<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> <span style="color: #2aa198;">""</span>
       <span style="color: #6c71c4;">(</span>string-append str <span style="color: #859900;">(</span>pprint <span style="color: #b58900;">(</span>node-right tree<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>+ <span style="color: #6c71c4;">1</span> depth<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga9cbf0f" class="outline-3">
<h3 id="orga9cbf0f">Exercise 2.65</h3>
<div class="outline-text-3" id="text-orga9cbf0f">
<p class="verse">
Use the results of Exercise 2.63 and Exercise 2.64 to give Θ ( n )<br>
implementations of union-set and intersection-set for sets implemented as<br>
(balanced) binary trees.107<br>
</p>
</div>
<div id="outline-container-orga56b21a" class="outline-4">
<h4 id="orga56b21a">Answer</h4>
<div class="outline-text-4" id="text-orga56b21a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">union-balanced-set</span> bs1 bs2<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>list-&gt;tree <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>union-set <span style="color: #859900;">(</span>tree-&gt;list-1 bs1<span style="color: #859900;">)</span>
                          <span style="color: #859900;">(</span>tree-&gt;list-1 bs2<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>


<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">intersection-balanced-set</span> bs1 bs2<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>list-&gt;tree <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>intersection <span style="color: #859900;">(</span>tree-&gt;list-1 bs1<span style="color: #859900;">)</span>
                             <span style="color: #859900;">(</span>tree-&gt;list-1 bs2<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6df49af" class="outline-3">
<h3 id="org6df49af">Exercise 2.66</h3>
<div class="outline-text-3" id="text-org6df49af">
<p class="verse">
Implement the lookup procedure for the case where the set of records is<br>
structured as a binary tree, ordered by the numerical values of the keys.<br>
</p>
</div>
<div id="outline-container-orgc2aaa5d" class="outline-4">
<h4 id="orgc2aaa5d">Answer</h4>
<div class="outline-text-4" id="text-orgc2aaa5d">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">lookup-bset</span> elt bs<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>null? bs<span style="color: #268bd2;">)</span> false
      <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #6c71c4;">[</span><span style="color: #859900;">(</span>val <span style="color: #b58900;">(</span>node-val bs<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span>
        <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>= val elt<span style="color: #b58900;">)</span> bs<span style="color: #859900;">]</span>
              <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>&gt; val elt<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>lookup-bset elt <span style="color: #268bd2;">(</span>node-left bs<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">]</span>
              <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>&lt; val elt<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>lookup-bset elt <span style="color: #268bd2;">(</span>node-right bs<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">]</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span>struct leaf <span style="color: #b58900;">(</span>sym weight<span style="color: #b58900;">)</span>
  <span style="color: #657b83; font-weight: bold;">#:transparent</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>struct code-tree <span style="color: #b58900;">(</span>left right syms weight<span style="color: #b58900;">)</span>
  <span style="color: #657b83; font-weight: bold;">#:transparent</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-code-tree</span> left right<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>code-tree left
             right
             <span style="color: #268bd2;">(</span>append <span style="color: #6c71c4;">(</span>syms left<span style="color: #6c71c4;">)</span>
                     <span style="color: #6c71c4;">(</span>syms right<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
             <span style="color: #268bd2;">(</span>+ <span style="color: #6c71c4;">(</span>weight left<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>weight right<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">left-branch</span> tree<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>code-tree-left tree<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">right-branch</span> tree<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>code-tree-right tree<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">syms</span> tree<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>leaf? tree<span style="color: #268bd2;">)</span>
      <span style="color: #268bd2;">(</span>list <span style="color: #6c71c4;">(</span>leaf-sym tree<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
      <span style="color: #268bd2;">(</span>code-tree-syms tree<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">weight</span> tree<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>leaf? tree<span style="color: #268bd2;">)</span>
      <span style="color: #268bd2;">(</span>leaf-weight tree<span style="color: #268bd2;">)</span>
      <span style="color: #268bd2;">(</span>code-tree-weight tree<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">decode</span> bits tree<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">decode-1</span> bits current-branch<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">(</span>null? bits<span style="color: #6c71c4;">)</span>
        null
        <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>next-branch
               <span style="color: #268bd2;">(</span>choose-branch
                <span style="color: #6c71c4;">(</span>car bits<span style="color: #6c71c4;">)</span>
                current-branch<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">]</span>
          <span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #b58900;">(</span>leaf? next-branch<span style="color: #b58900;">)</span>
              <span style="color: #b58900;">(</span>cons
               <span style="color: #268bd2;">(</span>leaf-sym next-branch<span style="color: #268bd2;">)</span>
               <span style="color: #268bd2;">(</span>decode-1 <span style="color: #6c71c4;">(</span>cdr bits<span style="color: #6c71c4;">)</span> tree<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
              <span style="color: #b58900;">(</span>decode-1 <span style="color: #268bd2;">(</span>cdr bits<span style="color: #268bd2;">)</span>
                        next-branch<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>decode-1 bits tree<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">choose-branch</span> bit branch<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>= bit <span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>left-branch branch<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>= bit <span style="color: #6c71c4;">1</span><span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>right-branch branch<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
        <span style="color: #268bd2;">[</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #6c71c4;">(</span>error <span style="color: #2aa198;">"bad bit(ch?)"</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">adjoin-htset</span> x ss<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>null? ss<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>list x<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
        <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>&lt; <span style="color: #859900;">(</span>weight x<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>weight <span style="color: #b58900;">(</span>car ss<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>cons x ss<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
        <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">else</span>
         <span style="color: #6c71c4;">(</span>cons <span style="color: #859900;">(</span>car ss<span style="color: #859900;">)</span>
               <span style="color: #859900;">(</span>adjoin-htset x <span style="color: #b58900;">(</span>cdr ss<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-leaf-set</span> pairs<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>null? pairs<span style="color: #268bd2;">)</span> null
      <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #6c71c4;">(</span><span style="color: #859900;">(</span>pair <span style="color: #b58900;">(</span>car pairs<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
        <span style="color: #6c71c4;">(</span>adjoin-htset
         <span style="color: #859900;">(</span>leaf <span style="color: #b58900;">(</span>car pair<span style="color: #b58900;">)</span>    <span style="color: #93a1a1;">; </span><span style="color: #93a1a1;">symbol</span>
               <span style="color: #b58900;">(</span>cadr pair<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>  <span style="color: #93a1a1;">; </span><span style="color: #93a1a1;">frequency</span>
         <span style="color: #859900;">(</span>make-leaf-set <span style="color: #b58900;">(</span>cdr pairs<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgda0a980" class="outline-3">
<h3 id="orgda0a980">Exercise 2.67:</h3>
<div class="outline-text-3" id="text-orgda0a980">
<p class="verse">
Define an encoding tree and a sample message:<br>
<br>
(define sample-tree<br>
&#xa0;&#xa0;(make-code-tree (make-leaf 'A 4)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(make-code-tree<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(make-leaf 'B 2)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(make-code-tree (make-leaf 'D 1)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(make-leaf 'C 1)))))<br>
<br>
(define sample-message '(0 1 1 0 0 1 0 1 0 1 1 1 0))<br>
<br>
Use the `decode' procedure to decode the message, and give the<br>
result.<br>
</p>
</div>
<div id="outline-container-org22b9686" class="outline-4">
<h4 id="org22b9686">Answer</h4>
<div class="outline-text-4" id="text-org22b9686">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">sample-tree</span>
  <span style="color: #b58900;">(</span>make-code-tree
   <span style="color: #268bd2;">(</span>leaf 'A <span style="color: #6c71c4;">4</span><span style="color: #268bd2;">)</span>
   <span style="color: #268bd2;">(</span>make-code-tree
    <span style="color: #6c71c4;">(</span>leaf 'B <span style="color: #6c71c4;">2</span><span style="color: #6c71c4;">)</span>
    <span style="color: #6c71c4;">(</span>make-code-tree
     <span style="color: #859900;">(</span>leaf 'D <span style="color: #6c71c4;">1</span><span style="color: #859900;">)</span>
     <span style="color: #859900;">(</span>leaf 'C <span style="color: #6c71c4;">1</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">A D A B B C A</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">sample-message</span>
  '<span style="color: #b58900;">(</span><span style="color: #6c71c4;">0</span> <span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">0</span> <span style="color: #6c71c4;">0</span> <span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">0</span> <span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">0</span> <span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">0</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">decode-sample</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>decode sample-message sample-tree<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span> <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">=&gt; '(A D A B B C A)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8441b86" class="outline-3">
<h3 id="org8441b86">Exercise 2.68</h3>
<div class="outline-text-3" id="text-org8441b86">
<p class="verse">
The encode procedure takes as arguments a message and a tree and produces the<br>
list of bits that gives the encoded message.<br>
<br>
Encode-symbol is a procedure, which you must write, that returns the list of<br>
bits that encodes a given symbol according to a given tree. You should design<br>
encode-symbol so that it signals an error if the symbol is not in the tree at<br>
all. Test your procedure by encoding the result you obtained in Exercise 2.67<br>
with the sample tree and seeing whether it is the same as the original sample<br>
message.<br>
</p>
</div>
<div id="outline-container-org9cdea35" class="outline-4">
<h4 id="org9cdea35">Answer</h4>
<div class="outline-text-4" id="text-org9cdea35">
<div class="org-src-container">
<pre class="src src-scheme">
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">encode</span> message tree<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>null? message<span style="color: #268bd2;">)</span>
      '<span style="color: #268bd2;">()</span>
      <span style="color: #268bd2;">(</span>append
       <span style="color: #6c71c4;">(</span>encode-symbol <span style="color: #859900;">(</span>car message<span style="color: #859900;">)</span>
                      tree<span style="color: #6c71c4;">)</span>
       <span style="color: #6c71c4;">(</span>encode <span style="color: #859900;">(</span>cdr message<span style="color: #859900;">)</span> tree<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">encode-symbol</span> symbol tree<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span>
    <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>null? tree<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>error <span style="color: #2aa198;">"Not found"</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
    <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>leaf? tree<span style="color: #6c71c4;">)</span> null<span style="color: #268bd2;">]</span>
    <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>memq symbol <span style="color: #859900;">(</span>syms <span style="color: #b58900;">(</span>left-branch tree<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
     <span style="color: #6c71c4;">(</span>cons <span style="color: #6c71c4;">0</span> <span style="color: #859900;">(</span>encode-symbol symbol <span style="color: #b58900;">(</span>left-branch tree<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span>
    <span style="color: #268bd2;">[</span><span style="color: #6c71c4;">(</span>memq symbol <span style="color: #859900;">(</span>syms <span style="color: #b58900;">(</span>right-branch tree<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
     <span style="color: #6c71c4;">(</span>cons <span style="color: #6c71c4;">1</span> <span style="color: #859900;">(</span>encode-symbol symbol <span style="color: #b58900;">(</span>right-branch tree<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">]</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5410e64" class="outline-3">
<h3 id="org5410e64">Exercise 2.69</h3>
<div class="outline-text-3" id="text-org5410e64">
<p class="verse">
The following procedure takes as its argument a list of symbol-frequency pairs<br>
(where no symbol appears in more than one pair) and generates a Huffman encoding<br>
tree according to the Huffman algorithm.<br>
<br>
Make-leaf-set is the procedure given above that transforms the list of pairs<br>
into an ordered set of leaves. Successive-merge is the procedure you must write,<br>
using make-code-tree to successively merge the smallest-weight elements of the<br>
set until there is only one element left, which is the desired Huffman tree.<br>
(This procedure is slightly tricky, but not really complicated. If you find<br>
yourself designing a complex procedure, then you are almost certainly doing<br>
something wrong. You can take significant advantage of the fact that we are<br>
using an ordered set representation.)<br>
</p>
</div>
<div id="outline-container-org643deb1" class="outline-4">
<h4 id="org643deb1">Answer</h4>
<div class="outline-text-4" id="text-org643deb1">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">generate-huffman-tree</span> pairs<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>successive-merge
   <span style="color: #268bd2;">(</span>make-leaf-set pairs<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">successive-merge</span> xs<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>= <span style="color: #6c71c4;">1</span> <span style="color: #6c71c4;">(</span>length xs<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span>car xs<span style="color: #268bd2;">)</span>
      <span style="color: #268bd2;">(</span>successive-merge
       <span style="color: #6c71c4;">(</span>cons <span style="color: #859900;">(</span>make-code-tree <span style="color: #b58900;">(</span>cadr xs<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>car xs<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
             <span style="color: #859900;">(</span>cddr xs<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3f7aec1" class="outline-3">
<h3 id="org3f7aec1">Exercise 2.70</h3>
<div class="outline-text-3" id="text-org3f7aec1">
<p class="verse">
The following eight-symbol alphabet with associated relative frequencies was<br>
designed to efficiently encode the lyrics of 1950s rock songs. (Note that the<br>
“symbols” of an “alphabet” need not be individual letters.)<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;A    2    NA  16<br>
&#xa0;&#xa0;&#xa0;&#xa0;BOOM 1    SHA  3<br>
&#xa0;&#xa0;&#xa0;&#xa0;GET  2    YIP  9<br>
&#xa0;&#xa0;&#xa0;&#xa0;JOB  2    WAH  1<br>
<br>
Use generate-huffman-tree (Exercise 2.69) to generate a corresponding Huffman<br>
tree, and use encode (Exercise 2.68) to encode the following message:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;Get a job<br>
&#xa0;&#xa0;&#xa0;&#xa0;Sha na na na na na na na na<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;Get a job<br>
&#xa0;&#xa0;&#xa0;&#xa0;Sha na na na na na na na na<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;Wah yip yip yip yip<br>
&#xa0;&#xa0;&#xa0;&#xa0;yip yip yip yip yip<br>
&#xa0;&#xa0;&#xa0;&#xa0;Sha boom<br>
</p>
</div>
<div id="outline-container-org6cf1ad6" class="outline-4">
<h4 id="org6cf1ad6">Answer</h4>
<div class="outline-text-4" id="text-org6cf1ad6">
<div class="org-src-container">
<pre class="src src-scheme">
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">generate-rock-n-roll-htree</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">rockfreq</span> <span style="color: #268bd2;">(</span>generate-huffman-tree
                    '<span style="color: #6c71c4;">(</span><span style="color: #859900;">(</span>A <span style="color: #6c71c4;">2</span><span style="color: #859900;">)</span>    <span style="color: #859900;">(</span>NA  <span style="color: #6c71c4;">16</span><span style="color: #859900;">)</span>
                      <span style="color: #859900;">(</span>BOOM <span style="color: #6c71c4;">1</span><span style="color: #859900;">)</span> <span style="color: #859900;">(</span>SHA  <span style="color: #6c71c4;">3</span><span style="color: #859900;">)</span>
                      <span style="color: #859900;">(</span>GET  <span style="color: #6c71c4;">2</span><span style="color: #859900;">)</span> <span style="color: #859900;">(</span>YIP  <span style="color: #6c71c4;">9</span><span style="color: #859900;">)</span>
                      <span style="color: #859900;">(</span>JOB  <span style="color: #6c71c4;">2</span><span style="color: #859900;">)</span> <span style="color: #859900;">(</span>WAH  <span style="color: #6c71c4;">1</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">msg-to-youth</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">map</span> <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #859900;">(</span>s<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>string-&gt;symbol <span style="color: #b58900;">(</span>string-upcase s<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>string-split <span style="color: #2aa198;">"Get a job Sha na na na na na na na na</span>
<span style="color: #2aa198;">                        Get a job Sha na na na na na na na na Wah yip yip</span>
<span style="color: #2aa198;">                        yip yip yip yip yip yip yip Sha boom"</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">rock-bits</span> <span style="color: #268bd2;">(</span>encode msg-to-youth rockfreq<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>printf <span style="color: #2aa198;">"bits: ~a\n"</span> rock-bits<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>printf <span style="color: #2aa198;">"decoded: ~a\n"</span> <span style="color: #268bd2;">(</span>decode rock-bits rockfreq<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org97c9c87" class="outline-3">
<h3 id="org97c9c87">Exercise 2.72</h3>
<div class="outline-text-3" id="text-org97c9c87">
<p class="verse">
Consider the encoding procedure that you designed in Exercise 2.68. What is the<br>
order of growth in the number of steps needed to encode a symbol? Be sure to<br>
include the number of steps needed to search the symbol list at each node<br>
encountered. To answer this question in general is difficult. Consider the<br>
special case where the relative frequencies of the n symbols are as described in<br>
Exercise 2.71, and give the order of growth (as a function of n ) of the number<br>
of steps needed to encode the most frequent and least frequent symbols in the<br>
alphabet.<br>
</p>
</div>
<div id="outline-container-org7d4ee5c" class="outline-4">
<h4 id="org7d4ee5c">Answer</h4>
<div class="outline-text-4" id="text-org7d4ee5c">
<blockquote>
<p>
(Copied from Eli Bendersky)
</p>

<p>
In general, in the worst case we’d need to descend n levels (as Exercise 2.71
shows), and at each step we have to find the symbol in a set of symbols at that
node. The implementation of encode used an unordered set to keep the symbols, so
the search takes O(n)[3]. Therefore, the whole encoding procedure takes O(n<sup>2</sup>).
Had we used a binary tree for the sets of symbols, we could bring this time down
to O(n<sup>2</sup>). Of course, building the tree would then take longer.
</p>
</blockquote>
</div>
</div>
</div>
</section>
