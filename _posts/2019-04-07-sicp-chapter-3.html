---
layout: page
title: SICP Chapter 3 Exercises & Solutions
category: note
tags:
  - post
  - SICP
  - solutions
---
<style>
.outline-text-3 > p.verse {
    background-color: #eee8d5;
    font: italic 400 1.0em Calibri,-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol" !important;
    padding: 1em;
    padding-left: 1.5em;
    border-left: 3px solid #2aa198;
}
</style>

<section id="outline-container-org245628e" class="outline-2">
<h2 id="org245628e"></h2>
<div class="outline-text-2" id="text-org245628e">
<p>
The HTML for this page has been automatically generated by parsing the loosely
formatted source code &amp; comments included in my solutions repository
(<a href="https://github.com/zv/SICP-guile">https://github.com/zv/SICP-guile</a>), if you encounter any unformatted
solutions, you think you've spotted an error or you have something you'd like
to share about the exercises, don't hesitate to leave a comment below
(or a pull request on the source repo).
</p>
</div>
</section>


<section id="outline-container-org483c64b" class="outline-2">
<h2 id="org483c64b">Exercises Chapter 3</h2>
<div class="outline-text-2" id="text-org483c64b">
</div>
<div id="outline-container-org04a1687" class="outline-3">
<h3 id="org04a1687">Exercise 3.1</h3>
<div class="outline-text-3" id="text-org04a1687">
<p class="verse">
An accumulator is a procedure that is called repeatedly with a single numeric<br>
argument and accumulates its arguments into a sum. Each time it is called, it<br>
returns the currently accumulated sum. Write a procedure make-accumulator that<br>
generates accumulators, each maintaining an independent sum. The input to<br>
make-accumulator should specify the initial value of the sum;<br>
<br>
(define A (make-accumulator 5))<br>
</p>
</div>
<div id="outline-container-org715614a" class="outline-4">
<h4 id="org715614a">Answer</h4>
<div class="outline-text-4" id="text-org715614a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-accumulator</span> x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #268bd2;">(</span>n<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span>+ x n<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org02e098f" class="outline-3">
<h3 id="org02e098f">Exercise 3.2</h3>
<div class="outline-text-3" id="text-org02e098f">
<p class="verse">
In software-testing applications, it is useful to be able to count<br>
the number of times a given procedure is called during the course of a<br>
computation. Write a procedure make-monitored that takes as input a procedure,<br>
f, that itself takes one input. The result returned by make-monitored is a third<br>
procedure, say mf, that keeps track of the number of times it has been called by<br>
maintaining an internal counter. If the input to mf is the special symbol<br>
how-many-calls?, then mf returns the value of the counter. If the input is the<br>
special symbol reset-count, then mf resets the counter to zero. For any other<br>
input, mf returns the result of calling f on that input and increments the<br>
counter. For instance, we could make a monitored version of the sqrt procedure:<br>
</p>
</div>
<div id="outline-container-org7b5306d" class="outline-4">
<h4 id="org7b5306d">Answer</h4>
<div class="outline-text-4" id="text-org7b5306d">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-monitored</span> f<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">calls</span> <span style="color: #6c71c4;">0</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #268bd2;">(</span>n<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">(</span>eq? n 'how-many-calls?<span style="color: #6c71c4;">)</span>
        calls
        <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">begin</span>
          <span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">set!</span> calls <span style="color: #b58900;">(</span>inc calls<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
          <span style="color: #859900;">(</span>f n<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org911f505" class="outline-4">
<h4 id="org911f505">Exercise 3.3</h4>
<div class="outline-text-4" id="text-org911f505">
<p class="verse">
Modify the make-account procedure so that it creates password-protected<br>
accounts. That is, make-account should take a symbol as an additional argument,<br>
as in<br>
</p>
</div>
</div>
<div id="outline-container-org5209863" class="outline-4">
<h4 id="org5209863">Answer</h4>
<div class="outline-text-4" id="text-org5209863">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">3.3/acc</span> <span style="color: #b58900;">(</span>make-account <span style="color: #6c71c4;">100</span> 'secret-password<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">3.3/make-account</span> acct# passwd<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">withdraw</span> amount<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #6c71c4;">(</span>&gt;= balance amount<span style="color: #6c71c4;">)</span>
        <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">begin</span> <span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">set!</span> balance
                 <span style="color: #b58900;">(</span>- balance amount<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
               balance<span style="color: #6c71c4;">)</span>
        <span style="color: #2aa198;">"Insufficient funds"</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">deposit</span> amount<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">set!</span> balance <span style="color: #6c71c4;">(</span>+ balance amount<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    balance<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">dispatch</span> m<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #6c71c4;">(</span><span style="color: #859900;">(</span>eq? m 'withdraw<span style="color: #859900;">)</span> withdraw<span style="color: #6c71c4;">)</span>
          <span style="color: #6c71c4;">(</span><span style="color: #859900;">(</span>eq? m 'deposit<span style="color: #859900;">)</span> deposit<span style="color: #6c71c4;">)</span>
          <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #859900;">(</span>error <span style="color: #2aa198;">"Unknown request:</span>
<span style="color: #2aa198;">                 MAKE-ACCOUNT"</span> m<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  dispatch<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org75cb4a3" class="outline-3">
<h3 id="org75cb4a3">Exercise 3.5</h3>
<div class="outline-text-3" id="text-org75cb4a3">
<p class="verse">
Monte Carlo integration is a method of estimating definite integrals by means of<br>
Monte Carlo simulation. Consider computing the area of a region of space<br>
described by a predicate p ( x , y ) that is true for points ( x , y ) in the<br>
region and #f for points not in the region. For example, the region contained<br>
within a circle of radius 3 centered at (5, 7) is described by the predicate<br>
that tests whether ( x − 5 ) 2 + ( y − 7 ) 2 ≤ 3 2 . To estimate the area of the<br>
region described by such a predicate, begin by choosing a rectangle that<br>
contains the region. For example, a rectangle with diagonally opposite corners<br>
at (2, 4) and (8, 10) contains the circle above. The desired integral is the<br>
area of that portion of the rectangle that lies in the region. We can estimate<br>
the integral by picking, at random, points ( x , y ) that lie in the rectangle,<br>
and testing p ( x , y ) for each point to determine whether the point lies in<br>
the region. If we try this with many points, then the fraction of points that<br>
fall in the region should give an estimate of the proportion of the rectangle<br>
that lies in the region. Hence, multiplying this fraction by the area of the<br>
entire rectangle should produce an estimate of the integral.<br>
<br>
Implement Monte Carlo integration as a procedure estimate-integral that takes as<br>
arguments a predicate p, upper and lower bounds x1, x2, y1, and y2 for the<br>
rectangle, and the number of trials to perform in order to produce the estimate.<br>
Your procedure should use the same monte-carlo procedure that was used above to<br>
estimate π . Use your estimate-integral to produce an estimate of π by measuring<br>
the area of a unit circle.<br>
<br>
You will find it useful to have a procedure that returns a number chosen at<br>
random from a given range. The following random-in-range procedure implements<br>
this in terms of the random procedure used in 1.2.6, which returns a nonnegative<br>
number less than its input.136<br>
</p>
</div>
<div id="outline-container-orgf1d75d3" class="outline-4">
<h4 id="orgf1d75d3">Answer</h4>
<div class="outline-text-4" id="text-orgf1d75d3">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">random-in-range</span> low high<span style="color: #b58900;">)</span>
  <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">had to write my own</span>
  <span style="color: #b58900;">(</span>+ low <span style="color: #268bd2;">(</span>random high<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">estimate-integral</span> p x1 x2 y1 y2 trials<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">width</span> <span style="color: #268bd2;">(</span>abs <span style="color: #6c71c4;">(</span>- x2 x1<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">height</span> <span style="color: #268bd2;">(</span>abs <span style="color: #6c71c4;">(</span>- y2 y1<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">area</span> <span style="color: #268bd2;">(</span>* width height<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">iter</span> remaining passed<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">let*</span> <span style="color: #6c71c4;">(</span><span style="color: #859900;">(</span>x <span style="color: #b58900;">(</span>random-in-range x1 x2<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
           <span style="color: #859900;">(</span>y <span style="color: #b58900;">(</span>random-in-range y1 y2<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
           <span style="color: #859900;">(</span>is-contained? <span style="color: #b58900;">(</span>p x y<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
      <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #859900;">(</span><span style="color: #b58900;">(</span>= remaining <span style="color: #6c71c4;">0</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>/ passed trials<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
            <span style="color: #859900;">(</span>is-contained? <span style="color: #b58900;">(</span>iter <span style="color: #268bd2;">(</span>dec remaining<span style="color: #268bd2;">)</span>
                                 <span style="color: #268bd2;">(</span>inc passed<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
            <span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">else</span>
             <span style="color: #b58900;">(</span>iter <span style="color: #268bd2;">(</span>dec remaining<span style="color: #268bd2;">)</span> passed<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>* area
     <span style="color: #268bd2;">(</span>iter trials <span style="color: #6c71c4;">0</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">unit-circle-pred</span> x y<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>&lt;= <span style="color: #268bd2;">(</span>+ <span style="color: #6c71c4;">(</span>* x x<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>* y y<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span> <span style="color: #6c71c4;">1</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga398c6c" class="outline-3">
<h3 id="orga398c6c">Exercise 3.6</h3>
<div class="outline-text-3" id="text-orga398c6c">
<p class="verse">
It is useful to be able to reset a random-number generator to produce a sequence<br>
starting from a given value. Design a new rand procedure that is called with an<br>
argument that is either the symbol generate or the symbol reset and behaves as<br>
follows: (rand 'generate) produces a new random number; ((rand 'reset)<br>
⟨new-value⟩) resets the internal state variable to the designated ⟨new-value⟩.<br>
Thus, by resetting the state, one can generate repeatable sequences. These are<br>
very handy to have when testing and debugging programs that use random numbers.<br>
</p>
</div>
<div id="outline-container-orgb4c11cd" class="outline-4">
<h4 id="orgb4c11cd">Answer</h4>
<div class="outline-text-4" id="text-orgb4c11cd">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">This is what I assume he meant??</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">rand</span> command<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">case</span> command
    <span style="color: #268bd2;">(</span>'generate <span style="color: #6c71c4;">(</span>random <span style="color: #6c71c4;">10</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #859900;">(</span>new<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>seed-&gt;random-state new<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">Utilities</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">count-pairs</span> x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>not <span style="color: #6c71c4;">(</span>pair? x<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
      <span style="color: #6c71c4;">0</span>
      <span style="color: #268bd2;">(</span>+ <span style="color: #6c71c4;">(</span>count-pairs <span style="color: #859900;">(</span>car x<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">(</span>count-pairs <span style="color: #859900;">(</span>cdr x<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
         <span style="color: #6c71c4;">1</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbf4c3df" class="outline-3">
<h3 id="orgbf4c3df">Exercise 3.12:</h3>
<div class="outline-text-3" id="text-orgbf4c3df">
<p class="verse">
The following procedure for appending lists was introduced in 2.2.1:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (append x y)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(if (null? x)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;y<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cons (car x) (append (cdr x) y))))<br>
<br>
Append forms a new list by successively consing the elements of x onto y. The<br>
procedure append! is similar to append, but it is a mutator rather than a<br>
constructor. It appends the lists by splicing them together, modifying the final<br>
pair of x so that its cdr is now y. (It is an error to call append! with an<br>
empty x.)<br>
</p>
</div>

<div id="outline-container-org2a7da8f" class="outline-4">
<h4 id="org2a7da8f">Answer</h4>
<div class="outline-text-4" id="text-org2a7da8f">
<blockquote>
<p>
An infinite loop occurs (a cycle in the linked list has been made)
</p>
</blockquote>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">last-pair</span> x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #268bd2;">(</span>null? <span style="color: #6c71c4;">(</span>cdr x<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
      x
      <span style="color: #268bd2;">(</span>last-pair <span style="color: #6c71c4;">(</span>cdr x<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">x</span> <span style="color: #b58900;">(</span>list 'a 'b<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">y</span> <span style="color: #b58900;">(</span>list 'c 'd<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">z</span> <span style="color: #b58900;">(</span>append x y<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">Exercise 3.13</span>
<span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">What happens if we try to compute (last-pair z)?</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-cycle</span> x<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>set-cdr! <span style="color: #268bd2;">(</span>last-pair x<span style="color: #268bd2;">)</span> x<span style="color: #b58900;">)</span>
  x<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5f9425b" class="outline-3">
<h3 id="org5f9425b">Exercise 3.14:</h3>
<div class="outline-text-3" id="text-org5f9425b">
<p class="verse">
The following procedure is quite useful, although obscure:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (mystery x)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (loop x y)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(if (null? x)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;y<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(let ((temp (cdr x)))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set-cdr! x y)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(loop temp x))))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(loop x '()))<br>
<br>
Loop uses the “temporary” variable temp to hold the old value of the cdr of x,<br>
since the set-cdr! on the next line destroys the cdr. Explain what mystery does<br>
in general. Suppose v is defined by (define v (list 'a 'b 'c 'd)). Draw the<br>
box-and-pointer diagram that represents the list to which v is bound. Suppose<br>
that we now evaluate (define w (mystery v)). Draw box-and-pointer diagrams that<br>
show the structures v and w after evaluating this expression. What would be<br>
printed as the values of v and w?<br>
</p>
</div>
<div id="outline-container-org28ff894" class="outline-4">
<h4 id="org28ff894">Answer</h4>
<div class="outline-text-4" id="text-org28ff894">
<blockquote>
<p>
Mystery requotes an array "in-place"
</p>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-orgb52712c" class="outline-3">
<h3 id="orgb52712c">Exercise 3.16</h3>
<div class="outline-text-3" id="text-orgb52712c">
<p class="verse">
Ben Bitdiddle decides to write a procedure to count the number of pairs in any<br>
list structure. “It’s easy,” he reasons. “The number of pairs in any structure<br>
is the number in the car plus the number in the cdr plus one more to count the<br>
current pair.” So Ben writes the following procedure:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (count-pairs x)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(if (not (pair? x))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;0<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(+ (count-pairs (car x))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(count-pairs (cdr x))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;1)))<br>
<br>
Show that this procedure is not correct. In particular, draw box-and-pointer<br>
diagrams representing list structures made up of exactly three pairs for which<br>
Ben’s procedure would return 3; return 4; return 7; never return at all.<br>
</p>
</div>

<div id="outline-container-orgca15917" class="outline-4">
<h4 id="orgca15917">Answer</h4>
<div class="outline-text-4" id="text-orgca15917">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">count-three-pairs</span> '<span style="color: #b58900;">(</span>a b c<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">count-four-pairs</span> '<span style="color: #b58900;">(</span>a b c<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">count-seven-pairs</span> '<span style="color: #b58900;">(</span>a b c<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>set-car! <span style="color: #b58900;">(</span>cdr count-four-pairs<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>cdr <span style="color: #268bd2;">(</span>cdr count-four-pairs<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span>set-car! count-seven-pairs <span style="color: #b58900;">(</span>cdr count-seven-pairs<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #93a1a1;">#|</span>
<span style="color: #93a1a1;">Answer:</span>
<span style="color: #93a1a1;">(count-pairs count-three-pairs) =&gt; 3</span>
<span style="color: #93a1a1;">(count-pairs count-four-pairs)  =&gt; 4</span>
<span style="color: #93a1a1;">(count-pairs count-seven-pairs) =&gt; 7</span>
<span style="color: #93a1a1;">|#</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb5700d4" class="outline-3">
<h3 id="orgb5700d4">Exercise 3.17</h3>
<div class="outline-text-3" id="text-orgb5700d4">
<p class="verse">
Devise a correct version of the count-pairs procedure of Exercise 3.16 that<br>
returns the number of distinct pairs in any structure.<br>
<br>
(Hint: Traverse the structure, maintaining an auxiliary data structure that is<br>
used to keep track of which pairs have already been counted.)<br>
</p>
</div>

<div id="outline-container-orgc1bfe21" class="outline-4">
<h4 id="orgc1bfe21">Answer</h4>
<div class="outline-text-4" id="text-orgc1bfe21">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">zv-count-pairs</span> xs<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">counted</span> '<span style="color: #268bd2;">()</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">loop</span> xs<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #6c71c4;">(</span><span style="color: #859900;">(</span>not <span style="color: #b58900;">(</span>pair? xs<span style="color: #b58900;">)</span><span style="color: #859900;">)</span> <span style="color: #6c71c4;">1</span><span style="color: #6c71c4;">)</span>
          <span style="color: #6c71c4;">(</span><span style="color: #859900;">(</span>null? xs<span style="color: #859900;">)</span> <span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">)</span>
          <span style="color: #6c71c4;">(</span><span style="color: #859900;">(</span>memq <span style="color: #b58900;">(</span>car xs<span style="color: #b58900;">)</span> counted<span style="color: #859900;">)</span> <span style="color: #6c71c4;">0</span><span style="color: #6c71c4;">)</span>
          <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">else</span>
           <span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">begin</span>
             <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">set!</span> counted <span style="color: #268bd2;">(</span>cons <span style="color: #6c71c4;">(</span>car xs<span style="color: #6c71c4;">)</span> counted<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
             <span style="color: #b58900;">(</span>+ <span style="color: #268bd2;">(</span>loop <span style="color: #6c71c4;">(</span>car xs<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
                <span style="color: #268bd2;">(</span>loop <span style="color: #6c71c4;">(</span>cdr xs<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>loop xs<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org42900f2" class="outline-3">
<h3 id="org42900f2">Exercise 3.18</h3>
<div class="outline-text-3" id="text-org42900f2">
<p class="verse">
Write a procedure that examines a list and determines whether it contains a<br>
cycle, that is, whether a program that tried to find the end of the list by<br>
taking successive cdrs would go into an infinite loop. Exercise 3.13 constructed<br>
such lists.<br>
</p>
</div>
<div id="outline-container-org76f2433" class="outline-4">
<h4 id="org76f2433">Answer</h4>
<div class="outline-text-4" id="text-org76f2433">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">has-cycles?</span> xs<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">visited</span> '<span style="color: #268bd2;">()</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">search</span> ys<span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #6c71c4;">(</span><span style="color: #859900;">(</span>null? ys<span style="color: #859900;">)</span> #f<span style="color: #6c71c4;">)</span>
          <span style="color: #6c71c4;">(</span><span style="color: #859900;">(</span>memq <span style="color: #b58900;">(</span>car ys<span style="color: #b58900;">)</span> visited<span style="color: #859900;">)</span> #t<span style="color: #6c71c4;">)</span>
          <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">else</span>
           <span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">begin</span>
             <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">set!</span> visited <span style="color: #268bd2;">(</span>cons <span style="color: #6c71c4;">(</span>car ys<span style="color: #6c71c4;">)</span> visited<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
             <span style="color: #b58900;">(</span>search <span style="color: #268bd2;">(</span>cdr ys<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>search xs<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb7562cc" class="outline-3">
<h3 id="orgb7562cc">Exercise 3.19</h3>
<div class="outline-text-3" id="text-orgb7562cc">
<p class="verse">
Redo Exercise 3.18 using an algorithm that takes only a constant amount of<br>
space. (This requires a very clever idea.)<br>
</p>
</div>
<div id="outline-container-org8441156" class="outline-4">
<h4 id="org8441156">Answer</h4>
<div class="outline-text-4" id="text-org8441156">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define*</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">linear-cycle-search</span> x1
                              <span style="color: #657b83; font-weight: bold;">#:optional</span> <span style="color: #268bd2;">(</span>x2 <span style="color: #6c71c4;">(</span>cdr x1<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">or</span> <span style="color: #859900;">(</span>null? <span style="color: #b58900;">(</span>cdr x1<span style="color: #b58900;">)</span><span style="color: #859900;">)</span> <span style="color: #859900;">(</span>null? <span style="color: #b58900;">(</span>cdr x2<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span> #f<span style="color: #268bd2;">)</span>
        <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>eq? x1 x2<span style="color: #6c71c4;">)</span> #t<span style="color: #268bd2;">)</span>
        <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #6c71c4;">(</span>linear-cycle-search <span style="color: #859900;">(</span>cdr x1<span style="color: #859900;">)</span> <span style="color: #859900;">(</span>cdr <span style="color: #b58900;">(</span>cdr x2<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org320f2ae" class="outline-3">
<h3 id="org320f2ae">Exercise 3.21</h3>
<div class="outline-text-3" id="text-org320f2ae">
<p class="verse">
Ben Bitdiddle decides to test the queue implementation described above. He types<br>
in the procedures to the Lisp interpreter and proceeds to try them out:<br>
<br>
“It’s all wrong!” he complains. “The interpreter’s response shows that the last<br>
item is inserted into the queue twice. And when I delete both items, the second<br>
b is still there, so the queue isn’t empty, even though it’s supposed to be.”<br>
Eva Lu Ator suggests that Ben has misunderstood what is happening. “It’s not<br>
that the items are going into the queue twice,” she explains. “It’s just that<br>
the standard Lisp printer doesn’t know how to make sense of the queue<br>
representation. If you want to see the queue printed correctly, you’ll have to<br>
define your own print procedure for queues.” Explain what Eva Lu is talking<br>
about. In particular, show why Ben’s examples produce the printed results that<br>
they do. Define a procedure print-queue that takes a queue as input and prints<br>
the sequence of items in the queue.<br>
</p>
</div>

<div id="outline-container-org01a16f7" class="outline-4">
<h4 id="org01a16f7">Answer</h4>
<div class="outline-text-4" id="text-org01a16f7">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">print-queue</span> qs<span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>format #t <span style="color: #2aa198;">"~a~%"</span> <span style="color: #268bd2;">(</span>car qs<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org989da69" class="outline-3">
<h3 id="org989da69">Exercise 3.22</h3>
<div class="outline-text-3" id="text-org989da69">
<p class="verse">
Instead of representing a queue as a pair of pointers, we can build a queue as a<br>
procedure with local state. The local state will consist of pointers to the<br>
beginning and the end of an ordinary list. Thus, the make-queue procedure will<br>
have the form<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;(define (make-queue)<br>
&#xa0;&#xa0;&#xa0;&#xa0;(let ((front-ptr … )<br>
&#xa0;&#xa0;&#xa0;&#xa0;(rear-ptr … ))<br>
&#xa0;&#xa0;&#xa0;&#xa0;⟨definitions of internal procedures⟩<br>
&#xa0;&#xa0;&#xa0;&#xa0;(define (dispatch m) …)<br>
&#xa0;&#xa0;&#xa0;&#xa0;dispatch))<br>
<br>
Complete the definition of make-queue and provide implementations of the queue<br>
operations using this representation.<br>
</p>
</div>

<div id="outline-container-orga5ca80c" class="outline-4">
<h4 id="orga5ca80c">Answer</h4>
<div class="outline-text-4" id="text-orga5ca80c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-curryq</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>front-ptr '<span style="color: #859900;">()</span><span style="color: #6c71c4;">)</span>
        <span style="color: #6c71c4;">(</span>rear-ptr '<span style="color: #859900;">()</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #6c71c4;">(</span><span style="color: #268bd2;">set-fptr!</span> item<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">set!</span> front-ptr item<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #6c71c4;">(</span><span style="color: #268bd2;">set-rptr!</span> item<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">set!</span> rear-ptr item<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #6c71c4;">(</span><span style="color: #268bd2;">empty-curryq?</span><span style="color: #6c71c4;">)</span>
      <span style="color: #6c71c4;">(</span>null? front-ptr<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #6c71c4;">(</span><span style="color: #268bd2;">front-curryq</span><span style="color: #6c71c4;">)</span>
      <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">if</span> <span style="color: #859900;">(</span>empty-curryq?<span style="color: #859900;">)</span>
          <span style="color: #859900;">(</span>error <span style="color: #2aa198;">"FRONT on empty queue"</span><span style="color: #859900;">)</span>
          <span style="color: #859900;">(</span>car front-ptr<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #6c71c4;">(</span><span style="color: #268bd2;">insert-curryq!</span> item<span style="color: #6c71c4;">)</span>
      <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #859900;">(</span><span style="color: #b58900;">(</span>new-pair <span style="color: #268bd2;">(</span>cons item '<span style="color: #6c71c4;">()</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
        <span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #b58900;">[</span><span style="color: #268bd2;">(</span>empty-curryq?<span style="color: #268bd2;">)</span>
               <span style="color: #268bd2;">(</span>set-fptr! item<span style="color: #268bd2;">)</span>
               <span style="color: #268bd2;">(</span>set-rptr! item<span style="color: #268bd2;">)</span><span style="color: #b58900;">]</span>
              <span style="color: #b58900;">[</span><span style="color: #859900; font-weight: bold;">else</span>
               <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">set!</span> rear-ptr new-pair<span style="color: #268bd2;">)</span>
               <span style="color: #268bd2;">(</span>set-rptr! new-pair<span style="color: #268bd2;">)</span><span style="color: #b58900;">]</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #6c71c4;">(</span><span style="color: #268bd2;">print-queue</span><span style="color: #6c71c4;">)</span>
      <span style="color: #6c71c4;">(</span>format #t <span style="color: #2aa198;">"~a~%"</span> front-ptr<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #6c71c4;">(</span><span style="color: #268bd2;">dispatch</span> m<span style="color: #6c71c4;">)</span>
      <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>eq? m 'front-ptr<span style="color: #b58900;">)</span> front-ptr<span style="color: #859900;">]</span>
            <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>eq? m 'rear-ptr<span style="color: #b58900;">)</span> rear-ptr<span style="color: #859900;">]</span>
            <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>eq? m 'insert-queue!<span style="color: #b58900;">)</span> insert-curryq!<span style="color: #859900;">]</span>
            <span style="color: #859900;">[</span><span style="color: #b58900;">(</span>eq? m 'print-queue<span style="color: #b58900;">)</span> print-queue<span style="color: #859900;">]</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    dispatch<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org85ae77c" class="outline-3">
<h3 id="org85ae77c">Exercise 3.23</h3>
<div class="outline-text-3" id="text-org85ae77c">
<p class="verse">
A deque (“double-ended queue”) is a sequence in which items can be inserted and<br>
deleted at either the front or the rear. Operations on deques are the<br>
constructor make-deque, the predicate empty-deque?, selectors front-deque and<br>
rear-deque, and mutators front-insert-deque!, rear-insert-deque!,<br>
front-delete-deque!, rear-delete-deque!. Show how to represent deques using<br>
pairs, and give implementations of the operations. All operations should be<br>
accomplished in Θ(1) steps.<br>
</p>
</div>

<div id="outline-container-org7ecde08" class="outline-4">
<h4 id="org7ecde08">Answer</h4>
<div class="outline-text-4" id="text-org7ecde08">
<p class="verse">
This is the structure I've decided to use for the deque. There may be other<br>
neat ways to encode a deque with cons-cells. I'd love to hear if anyone has<br>
a better structure:<br>
<br>
F: Front Ptr<br>
B: Back Ptr<br>
X: Value<br>
/: Null or End<br>
<br>
<del>---</del>&#x2014;+<br>
| F | B |------------&#x2013;&#x2014;+<br>
<del>-|-</del>&#x2014;+                 |<br>
V                       V<br>
<del>-</del>-<del>---</del>   <del>---</del>&#x2014;+   <del>-</del>-<del>---</del><br>
| * | * |&#x2013;&gt;| * | * |&#x2013;&gt;| * | / |<br>
<del>-|-</del>&#x2014;+   <del>-|-</del>&#x2014;+   <del>-|-</del>&#x2014;+<br>
V   ^&#x2014;+   V   ^&#x2014;+   V<br>
<del>-</del>-<del>---</del> | <del>---</del>&#x2014;+ | <del>---</del>&#x2014;+<br>
| X | / | | | X | * | | | X | * |<br>
<del>---</del>&#x2014;+ | <del>---</del>-<del>-</del> | <del>---</del>-<del>-</del><br>
|       |   |       |<br>
<del>-------</del>   <del>-------</del><br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (make-deque) '(() . ()))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (empty-deque? dq) (null? (front-deque dq)))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (front-deque dq) (car dq))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (rear-deque dq) (cdr dq))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (next-deque lst) (if (null? lst) '() (cdr lst)))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (prev-deque lst) (if (null? lst) '() (cdar lst)))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (front-insert-deque! dq value)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(let ([new-elt (cons (cons value '()) '())])<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cond<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;((empty-deque? dq)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set-car! dq new-elt) (set-cdr! dq new-elt)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;dq)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(else<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;;; link our next element to the current front<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set-cdr! new-elt (front-deque dq))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;;; find the next element to make a backwards link<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set-cdr! (car (front-deque dq)) new-elt)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set-car! dq new-elt)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;dq))))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (rear-insert-deque! dq value)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(let ([new-elt (cons (cons value '()) '())])<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cond<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;((empty-deque? dq)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set-car! dq new-elt) (set-cdr! dq new-elt)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;dq)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(else<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;;; Link our backwards element<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set-cdr! (car new-elt) (rear-deque dq))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set-cdr! (rear-deque dq) new-elt)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set-cdr! dq new-elt)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;dq))))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (front-delete-deque! dq)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(let ([next (next-deque (front-deque dq))]<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;[front (front-deque dq)])<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cond<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;((null? next) (set-car! dq '()) (set-cdr! dq '()))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(else<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set-car! dq next)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set-cdr! (car (front-deque dq)) '())))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;front))<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (rear-delete-deque! dq)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(let ([rear (rear-deque dq)]<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;[prev (prev-deque (rear-deque dq))])<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cond<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;((null? rear) (set-car! dq '()) (set-cdr! dq '()))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(else<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set-cdr! dq prev)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set-cdr! (rear-deque dq) '())))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;rear))<br>
</p>
</div>
</div>
</div>

<div id="outline-container-org5e43b64" class="outline-3">
<h3 id="org5e43b64">Exercise 3.24:</h3>
<div class="outline-text-3" id="text-org5e43b64">
<p class="verse">
In the table implementations above, the keys are tested for equality using<br>
`equal?' (called by `assoc'). This is not always the appropriate test. For<br>
instance, we might have a table with numeric keys in which we don't need an<br>
exact match to the number we're looking up, but only a number within some<br>
tolerance of it. Design a table constructor `make-table' that takes as an<br>
argument a `same-key?' procedure that will be used to test "equality" of<br>
keys. `Make-table' should return a `dispatch' procedure that can be used to<br>
access appropriate `lookup' and `insert!' procedures for a local table.<br>
</p>
</div>
<div id="outline-container-orge15427c" class="outline-4">
<h4 id="orge15427c">Answer</h4>
<div class="outline-text-4" id="text-orge15427c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">make-table-with-key</span> same-key?<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>local-table <span style="color: #859900;">(</span>list '*table*<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">just redefine `assoc' with `same-key?'</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #6c71c4;">(</span><span style="color: #268bd2;">assoc</span> key records<span style="color: #6c71c4;">)</span>
      <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #859900;">(</span><span style="color: #b58900;">(</span>null? records<span style="color: #b58900;">)</span> #f<span style="color: #859900;">)</span>
            <span style="color: #859900;">(</span><span style="color: #b58900;">(</span>same-key? key <span style="color: #268bd2;">(</span>caar records<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span> <span style="color: #b58900;">(</span>car records<span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
            <span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">else</span> <span style="color: #b58900;">(</span>assoc key <span style="color: #268bd2;">(</span>cdr records<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #6c71c4;">(</span><span style="color: #268bd2;">lookup</span> key-1 key-2<span style="color: #6c71c4;">)</span>
      <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #859900;">(</span><span style="color: #b58900;">(</span>subtable <span style="color: #268bd2;">(</span>assoc key-1 <span style="color: #6c71c4;">(</span>cdr local-table<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
        <span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">if</span> subtable
            <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>record <span style="color: #859900;">(</span>assoc key-2 <span style="color: #2aa198;">(</span>cdr subtable<span style="color: #2aa198;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
              <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> record
                  <span style="color: #6c71c4;">(</span>cdr record<span style="color: #6c71c4;">)</span>
                  #f<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
            #f<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #6c71c4;">(</span><span style="color: #268bd2;">insert!</span> key-1 key-2 value<span style="color: #6c71c4;">)</span>
      <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #859900;">(</span><span style="color: #b58900;">(</span>subtable <span style="color: #268bd2;">(</span>assoc key-1 <span style="color: #6c71c4;">(</span>cdr local-table<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
        <span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">if</span> subtable
            <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">(</span>record <span style="color: #859900;">(</span>assoc key-2 <span style="color: #2aa198;">(</span>cdr subtable<span style="color: #2aa198;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
              <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">if</span> record
                  <span style="color: #6c71c4;">(</span>set-cdr! record value<span style="color: #6c71c4;">)</span>
                  <span style="color: #6c71c4;">(</span>set-cdr! subtable
                            <span style="color: #859900;">(</span>cons <span style="color: #2aa198;">(</span>cons key-2 value<span style="color: #2aa198;">)</span>
                                  <span style="color: #2aa198;">(</span>cdr subtable<span style="color: #2aa198;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
            <span style="color: #b58900;">(</span>set-cdr! local-table
                      <span style="color: #268bd2;">(</span>cons <span style="color: #6c71c4;">(</span>list key-1
                                  <span style="color: #859900;">(</span>cons key-2 value<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
                            <span style="color: #6c71c4;">(</span>cdr local-table<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #6c71c4;">(</span><span style="color: #268bd2;">dispatch</span> m<span style="color: #6c71c4;">)</span>
      <span style="color: #6c71c4;">(</span><span style="color: #859900; font-weight: bold;">cond</span> <span style="color: #859900;">(</span><span style="color: #b58900;">(</span>eq? m 'lookup-proc<span style="color: #b58900;">)</span> lookup<span style="color: #859900;">)</span>
            <span style="color: #859900;">(</span><span style="color: #b58900;">(</span>eq? m 'insert-proc!<span style="color: #b58900;">)</span> insert!<span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
    dispatch<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd187ae4" class="outline-3">
<h3 id="orgd187ae4">Exercise 3.25</h3>
<div class="outline-text-3" id="text-orgd187ae4">
<p class="verse">
Generalizing one and two-dimensional tables, show how to implement a table<br>
in which values are stored under an arbitrary number of keys and different<br>
values may be stored under different numbers of keys. The `lookup' and<br>
`insert!' procedures should take as input a list of keys used to access the<br>
table.<br>
</p>
</div>

<div id="outline-container-orgc2d7e4a" class="outline-4">
<h4 id="orgc2d7e4a">Answer</h4>
<div class="outline-text-4" id="text-orgc2d7e4a">
<blockquote>
<p>
The easiest way to accomplish this is to accept variadic arguments to
`insert' and `lookup', folding them into a string or using the list
directly (which `equal?' can compare)
</p>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-org33472af" class="outline-3">
<h3 id="org33472af">Exercise 3.26</h3>
<div class="outline-text-3" id="text-org33472af">
<p class="verse">
To search a table as implemented above, one needs to scan through the list<br>
of records. This is basically the unordered list representation of section<br>
*Note 2-3-3. For large tables, it may be more efficient to structure the<br>
table in a different manner. Describe a table implementation where the<br>
(key, value) records are organized using a binary tree, assuming that keys<br>
can be ordered in some way (e.g., numerically or alphabetically). (Compare<br>
Exercise 2-66 of Chapter 2)<br>
</p>
</div>

<div id="outline-container-orgd5c883f" class="outline-4">
<h4 id="orgd5c883f">Answer:</h4>
<div class="outline-text-4" id="text-orgd5c883f">
<blockquote>
<p>
The value that is to be inserted is converted into it's numeric form. Insert &amp;
Lookup function as you would expect
</p>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-org5467dff" class="outline-3">
<h3 id="org5467dff">Exercise 3.27</h3>
<div class="outline-text-3" id="text-org5467dff">
<p class="verse">
"Memoization" (also called "tabulation") is a technique that enables a<br>
procedure to record, in a local table, values that have previously been<br>
computed. This technique can make a vast difference in the performance of a<br>
program. A memoized procedure maintains a table in which values of previous<br>
calls are stored using as keys the arguments that produced the values. When<br>
the memoized procedure is asked to compute a value, it first checks the<br>
table to see if the value is already there and, if so, just returns that<br>
value. Otherwise, it computes the new value in the ordinary way and stores<br>
this in the table. As an example of memoization, recall from section<br>
1-2-2 the exponential process for computing Fibonacci numbers:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;(define (fib n)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cond ((= n 0) 0)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;((= n 1) 1)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(else (+ (fib (- n 1))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(fib (- n 2))))))<br>
<br>
The memoized version of the same procedure is<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;(define memo-fib<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(memoize (lambda (n)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cond ((= n 0) 0)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;((= n 1) 1)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(else (+ (memo-fib (- n 1))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(memo-fib (- n 2))))))))<br>
<br>
where the memoizer is defined as<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;(define (memoize f)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(let ((table (make-table)))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(lambda (x)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(let ((previously-computed-result (lookup x table)))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(or previously-computed-result<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(let ((result (f x)))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(insert! x result table)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;result))))))<br>
<br>
Draw an environment diagram to analyze the computation of `(memo-fib<br>
3)'. Explain why `memo-fib' computes the nth Fibonacci number in a number<br>
of steps proportional to n. Would the scheme still work if we had simply<br>
defined `memo-fib' to be `(memoize fib)'?<br>
</p>
</div>

<div id="outline-container-org859cc7f" class="outline-4">
<h4 id="org859cc7f">Answer:</h4>
<div class="outline-text-4" id="text-org859cc7f">
<blockquote>
<p>
memo-fib is O(N) because the fibonacci sequence can simply be computed in
2*(Σ(N)) steps (half of which are 'precomputed')
The scheme would not work if each function were freshly memoized because
the `table' would not be shared between the various applications of
`memo-fib'. 
</p>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-orgd34772c" class="outline-3">
<h3 id="orgd34772c">Exercise 3.28</h3>
<div class="outline-text-3" id="text-orgd34772c">
<p class="verse">
Define an or-gate as a primitive function box. Your or-gate constructor should<br>
be similar to and-gate.<br>
</p>
</div>

<div id="outline-container-org9b89cc3" class="outline-4">
<h4 id="org9b89cc3">Answer</h4>
<div class="outline-text-4" id="text-org9b89cc3">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">or-gate-delay</span> <span style="color: #6c71c4;">5</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">or-gate</span> a1 a2 output<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2;">or-action-procedure</span><span style="color: #268bd2;">)</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #6c71c4;">(</span><span style="color: #859900;">(</span>new-value
           <span style="color: #b58900;">(</span>logior <span style="color: #268bd2;">(</span>signal-value a1<span style="color: #268bd2;">)</span>
                   <span style="color: #268bd2;">(</span>signal-value a2<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span>
      <span style="color: #6c71c4;">(</span>after-delay
       or-gate-delay
       <span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">&#955;</span> <span style="color: #b58900;">()</span>
         <span style="color: #b58900;">(</span>set-signal! output new-value<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>add-action! a1 or-action-procedure<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>add-action! a2 or-action-procedure<span style="color: #b58900;">)</span>
  'ok<span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org39489d0" class="outline-3">
<h3 id="org39489d0">Exercise 3.29</h3>
<div class="outline-text-3" id="text-org39489d0">
<p class="verse">
Another way to construct an or-gate is as a compound digital logic device, built<br>
from and-gates and inverters. Define a procedure or-gate that accomplishes this.<br>
What is the delay time of the or-gate in terms of and-gate-delay and<br>
inverter-delay?<br>
</p>
</div>

<div id="outline-container-org135c4e6" class="outline-4">
<h4 id="org135c4e6">Answer</h4>
<div class="outline-text-4" id="text-org135c4e6">
<p class="verse">
(!a1) &amp;&amp; a2 is congruent to a1 || a2, it is as fast as (AND-DELAY + INVERTER<sub>DELAY</sub>)<br>
</p>
</div>
</div>
</div>

<div id="outline-container-orga641840" class="outline-3">
<h3 id="orga641840"><span class="todo TODO">TODO</span> Exercise 3.30</h3>
<div class="outline-text-3" id="text-orga641840">
<p class="verse">
Figure 3.27 shows a ripple-carry adder formed by stringing together n<br>
full-adders. This is the simplest form of parallel adder for adding two n -bit<br>
binary numbers. The inputs A 1 , A 2 , A 3 , …, A n and B 1 , B 2 , B 3 , …, B n<br>
are the two binary numbers to be added (each A k and B k is a 0 or a 1). The<br>
circuit generates S 1 , S 2 , S 3 , …, S n , the n bits of the sum, and C , the<br>
carry from the addition. Write a procedure ripple-carry-adder that generates<br>
this circuit. The procedure should take as arguments three lists of n wires<br>
each—the A k , the B k , and the S k —and also another wire C . The major<br>
drawback of the ripple-carry adder is the need to wait for the carry signals to<br>
propagate. What is the delay needed to obtain the complete output from an n -bit<br>
ripple-carry adder, expressed in terms of the delays for and-gates, or-gates,<br>
and inverters?<br>
</p>
</div>
</div>

<div id="outline-container-org2b6c328" class="outline-3">
<h3 id="org2b6c328">Exercise 3.31</h3>
<div class="outline-text-3" id="text-org2b6c328">
<p class="verse">
The internal procedure `accept-action-procedure!' defined in make-wire specifies<br>
that when a new action procedure is added to a wire, the procedure is<br>
immediately run. Explain why this initialization is necessary. In particular,<br>
trace through the half-adder example in the paragraphs above and say how the<br>
system’s response would differ if we had defined accept-action-procedure! as<br>
<br>
&#xa0;&#xa0;&#xa0;(define (accept-action-procedure! proc)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set! action-procedures (cons proc action-procedures)))<br>
</p>
</div>

<div id="outline-container-orgf7dbc01" class="outline-4">
<h4 id="orgf7dbc01">Answer:</h4>
<div class="outline-text-4" id="text-orgf7dbc01">
<p class="verse">
the signal value must be initialized or the entire system will run the action<br>
procedures (no matter what has changed)<br>
</p>
</div>
</div>
</div>

<div id="outline-container-org9a71609" class="outline-3">
<h3 id="org9a71609"><span class="todo TODO">TODO</span> Exercise 3.32</h3>
<div class="outline-text-3" id="text-org9a71609">
<p class="verse">
The procedures to be run during each time segment of the agenda are kept in a<br>
queue. Thus, the procedures for each segment are called in the order in which<br>
they were added to the agenda (first in, first out). Explain why this order must<br>
be used. In particular, trace the behavior of an and-gate whose inputs change<br>
from 0, 1 to 1, 0 in the same segment and say how the behavior would differ if<br>
we stored a segment’s procedures in an ordinary list, adding and removing<br>
procedures only at the front (last in, first out).<br>
</p>
</div>
</div>

<div id="outline-container-org05c4565" class="outline-3">
<h3 id="org05c4565">Exercise 3.33</h3>
<div class="outline-text-3" id="text-org05c4565">
<p class="verse">
Using primitive multiplier, adder, and constant constraints, define a procedure<br>
averager that takes three connectors a, b, and c as inputs and establishes the<br>
constraint that the value of c is the average of the values of a and b.<br>
</p>
</div>

<div id="outline-container-orgf8ac236" class="outline-4">
<h4 id="orgf8ac236">Answer</h4>
<div class="outline-text-4" id="text-orgf8ac236">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">averager</span> a b c<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>with-connectors <span style="color: #268bd2;">(</span>half sum<span style="color: #268bd2;">)</span>
                   <span style="color: #268bd2;">(</span>constant <span style="color: #6c71c4;">0.5</span> half<span style="color: #268bd2;">)</span>
                   <span style="color: #268bd2;">(</span>adder a b sum<span style="color: #268bd2;">)</span>
                   <span style="color: #268bd2;">(</span>multiplier half sum c<span style="color: #268bd2;">)</span>
                   'ok<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org682d66e" class="outline-3">
<h3 id="org682d66e">Exercise 3.34</h3>
<div class="outline-text-3" id="text-org682d66e">
<p class="verse">
Louis Reasoner wants to build a squarer, a constraint device with two terminals<br>
such that the value of connector b on the second terminal will always be the<br>
square of the value a on the first terminal. He proposes the following simple<br>
device made from a multiplier:<br>
<br>
&#xa0;&#xa0;&#xa0;(define (squarer a b) (multiplier a a b))<br>
<br>
There is a serious flaw in this idea. Explain.<br>
</p>
</div>

<div id="outline-container-orgaff25f7" class="outline-4">
<h4 id="orgaff25f7">Answer</h4>
<div class="outline-text-4" id="text-orgaff25f7">
<blockquote>
<p>
The value of `a' is not "duplicated" across &#x2013; so `process-new-value' only reads either `rhs' or `lhs''s value
</p>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-org07abbab" class="outline-3">
<h3 id="org07abbab">Exercise 3.35</h3>
<div class="outline-text-3" id="text-org07abbab">
<p class="verse">
Ben Bitdiddle tells Louis that one way to avoid the trouble in<br>
Exercise 3.34 is to define a squarer as a new primitive constraint. Fill in the<br>
missing portions in Ben’s outline for a procedure to implement such a<br>
constraint:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (squarer a b)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (process-new-value)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(if (has-value? b)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(if (&lt; (get-value b) 0)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(error "square less than 0:<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;SQUARER"<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(get-value b))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;⟨alternative1⟩)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;⟨alternative2⟩))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (process-forget-value) ⟨body1⟩)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (me request) ⟨body2⟩)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;⟨rest of definition⟩<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;me)<br>
</p>
</div>

<div id="outline-container-orgc3dc55e" class="outline-4">
<h4 id="orgc3dc55e">Answer</h4>
<div class="outline-text-4" id="text-orgc3dc55e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define-class</span> <span style="color: #b58900;">&lt;squarer&gt;</span> <span style="color: #b58900;">(</span><span style="color: #b58900;">&lt;constraint&gt;</span><span style="color: #b58900;">)</span>
  <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">in squarer, there is essentially only one value</span>
  <span style="color: #b58900;">(</span>rhs <span style="color: #657b83; font-weight: bold;">#:allocation</span> <span style="color: #657b83; font-weight: bold;">#:virtual</span>
       <span style="color: #657b83; font-weight: bold;">#:slot-ref</span> <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #6c71c4;">(</span>o<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>slot-ref o 'lhs<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span>
       <span style="color: #657b83; font-weight: bold;">#:slot-set!</span> <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">lambda</span> <span style="color: #6c71c4;">(</span>o s<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">(</span>slot-set! o 'lhs s<span style="color: #6c71c4;">)</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">strictly speaking these are not nessasary, as they are defined directly in</span>
  <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">`process-new-value', they are kept for posteriety.</span>
  <span style="color: #b58900;">(</span>operator <span style="color: #657b83; font-weight: bold;">#:init-value</span> square<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>inverse-operator <span style="color: #657b83; font-weight: bold;">#:init-value</span> sqrt<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define-method</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">process-new-value</span> <span style="color: #268bd2;">(</span>c <span style="color: #b58900;">&lt;squarer&gt;</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span><span style="color: #859900; font-weight: bold;">let*</span> <span style="color: #268bd2;">(</span><span style="color: #6c71c4;">[</span>lhs-conn <span style="color: #859900;">(</span>lhs c<span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span>
         <span style="color: #6c71c4;">[</span>total-conn <span style="color: #859900;">(</span>total c<span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span>
         <span style="color: #6c71c4;">[</span>has-total? <span style="color: #859900;">(</span>has-value? total-conn<span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span>
         <span style="color: #6c71c4;">[</span>has-lhs? <span style="color: #859900;">(</span>has-value? lhs-conn<span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span><span style="color: #268bd2;">)</span>
    <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">Determine what values *are* known and set the appropriate connector.</span>
    <span style="color: #268bd2;">(</span><span style="color: #859900; font-weight: bold;">cond</span>
     <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">(lhs &lt; 0) =&gt; error</span>
     <span style="color: #6c71c4;">[</span><span style="color: #859900;">(</span><span style="color: #859900; font-weight: bold;">and</span> <span style="color: #b58900;">(</span>has-lhs?
            <span style="color: #268bd2;">(</span>&lt; <span style="color: #6c71c4;">(</span>connector-value lhs-conn<span style="color: #6c71c4;">)</span> <span style="color: #6c71c4;">0</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #859900;">)</span>
      <span style="color: #859900;">(</span>error <span style="color: #2aa198;">"square less than 0: SQUARER"</span> <span style="color: #b58900;">(</span>connector-value lhs-conn<span style="color: #b58900;">)</span><span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span>

     <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">lhs = &#8730;total</span>
     <span style="color: #6c71c4;">[</span>has-total?
      <span style="color: #859900;">(</span>set-value! lhs-conn <span style="color: #b58900;">(</span>sqrt <span style="color: #268bd2;">(</span>connector-value total-conn<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span> c<span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span>

     <span style="color: #93a1a1;">;; </span><span style="color: #93a1a1;">total = lh&#178;</span>
     <span style="color: #6c71c4;">[</span>has-lhs?
      <span style="color: #859900;">(</span>set-value! total-conn <span style="color: #b58900;">(</span>square <span style="color: #268bd2;">(</span>connector-value lhs-conn<span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span> c<span style="color: #859900;">)</span><span style="color: #6c71c4;">]</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define-method</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">process-forget-value</span> <span style="color: #268bd2;">(</span>c <span style="color: #b58900;">&lt;squarer&gt;</span><span style="color: #268bd2;">)</span><span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>forget-value! <span style="color: #268bd2;">(</span>lhs c<span style="color: #268bd2;">)</span> c<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>forget-value! <span style="color: #268bd2;">(</span>total c<span style="color: #268bd2;">)</span> c<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>process-new-value c<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd362b32" class="outline-3">
<h3 id="orgd362b32"><span class="todo TODO">TODO</span> Exercise 3.36</h3>
<div class="outline-text-3" id="text-orgd362b32">
<p class="verse">
Suppose we evaluate the following sequence of expressions in the global<br>
environment:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define a (make-connector)) (define b (make-connector)) (set-value! a 10 'user)<br>
<br>
At some time during evaluation of the set-value!, the following expression from<br>
the connector’s local procedure is evaluated:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(for-each-except setter inform-about-value constraints)<br>
<br>
Draw an environment diagram showing the environment in which the above<br>
expression is evaluated.<br>
</p>
</div>
</div>

<div id="outline-container-orgab30513" class="outline-3">
<h3 id="orgab30513">Exercise 3.37</h3>
<div class="outline-text-3" id="text-orgab30513">
<p class="verse">
The celsius-fahrenheit-converter procedure is cumbersome when compared with a<br>
more expression-oriented style of definition, such as<br>
<br>
&#xa0;&#xa0;&#xa0;(define (celsius-fahrenheit-converter x)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(c+ (c* (c/ (cv 9) (cv 5)) x)<br>
<br>
&#xa0;&#xa0;&#xa0;(cv 32)))<br>
<br>
&#xa0;&#xa0;&#xa0;(define C (make-connector))<br>
&#xa0;&#xa0;&#xa0;(define F (celsius-fahrenheit-converter C))<br>
<br>
Here c+, c*, etc. are the “constraint” versions of the arithmetic operations.<br>
For example, c+ takes two connectors as arguments and returns a connector that<br>
is related to these by an adder constraint:<br>
<br>
&#xa0;&#xa0;&#xa0;(define (c+ x y)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(let ((z (make-connector))) (adder x y z) z))<br>
<br>
Define analogous procedures c-, c*, c/, and cv (constant value) that enable us<br>
to define compound constraints as in the converter example above.<br>
</p>
</div>

<div id="outline-container-org1d1ad07" class="outline-4">
<h4 id="org1d1ad07">Answer</h4>
<div class="outline-text-4" id="text-org1d1ad07">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">c+</span> augend addend<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>with-connectors <span style="color: #268bd2;">(</span>sum<span style="color: #268bd2;">)</span>
                   <span style="color: #268bd2;">(</span>adder augend addend sum<span style="color: #268bd2;">)</span>
                   sum<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">c-</span> minuend subtrahend<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>with-connectors <span style="color: #268bd2;">(</span>difference<span style="color: #268bd2;">)</span>
                   <span style="color: #268bd2;">(</span>adder difference subtrahend minuend<span style="color: #268bd2;">)</span>
                   difference<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">c*</span> multiplicand m2<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>with-connectors <span style="color: #268bd2;">(</span>product<span style="color: #268bd2;">)</span>
                   <span style="color: #268bd2;">(</span>multiplier multiplicand  m2 product<span style="color: #268bd2;">)</span>
                   product<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>

<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">c/</span> dividend divisor<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>with-connectors <span style="color: #268bd2;">(</span>quotient<span style="color: #268bd2;">)</span>
                   <span style="color: #268bd2;">(</span>multiplier quotient divisor dividend<span style="color: #268bd2;">)</span>
                   quotient<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
<span style="color: #2aa198;">(</span><span style="color: #859900; font-weight: bold;">define</span> <span style="color: #b58900;">(</span><span style="color: #268bd2;">cv</span> value<span style="color: #b58900;">)</span>
  <span style="color: #b58900;">(</span>with-connectors <span style="color: #268bd2;">(</span>result<span style="color: #268bd2;">)</span>
                   <span style="color: #268bd2;">(</span>constant value result<span style="color: #268bd2;">)</span>
                   result<span style="color: #b58900;">)</span><span style="color: #2aa198;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc259212" class="outline-3">
<h3 id="orgc259212">Exercise 3.38</h3>
<div class="outline-text-3" id="text-orgc259212">
<p class="verse">
Suppose that Peter, Paul, and Mary share a joint bank account that initially<br>
contains $100. Concurrently, Peter deposits $10, Paul withdraws $20, and Mary<br>
withdraws half the money in the account, by executing the following commands:<br>
<br>
Peter: (set! balance (+ balance 10))<br>
Paul:  (set! balance (- balance 20))<br>
Mary:  (set! balance (- balance (/ balance 2)))<br>
<br>
1.  List all the different possible values for balance after these three<br>
&#xa0;&#xa0;&#xa0;transactions have been completed, assuming that the banking system forces the<br>
&#xa0;&#xa0;&#xa0;three processes to run sequentially in some order.<br>
<br>
2.  What are some other values that could be produced if the system allows the<br>
&#xa0;&#xa0;&#xa0;processes to be interleaved? Draw timing diagrams like the one in Figure 3.29 to<br>
&#xa0;&#xa0;&#xa0;explain how these values can occur.<br>
<br>
</p>
</div>
<div id="outline-container-orgd470985" class="outline-4">
<h4 id="orgd470985">Answer</h4>
<div class="outline-text-4" id="text-orgd470985">
<p class="verse">
Peter-&gt;Paul-&gt;Mary: (calc-eval "((100+10)-20)/2")       =&gt; 45<br>
Peter-&gt;Mary-&gt;Paul: (calc-eval "((100+10)/2)-20")       =&gt; 35<br>
Mary-&gt;Paul-&gt;Peter: (calc-eval "((100 / 2) - 20) + 20") =&gt; 50<br>
Mary-&gt;Peter-&gt;Paul: (calc-eval "((100 / 2) + 10) - 20") =&gt; 40<br>
Paul-&gt;Peter-&gt;Mary: (calc-eval "((100 - 20) + 10) / 2") =&gt; 45<br>
Paul-&gt;Mary-&gt;Peter: (calc-eval "((100 - 20) / 2) + 10") =&gt; 50<br>
</p>
</div>
</div>
</div>

<div id="outline-container-org76a5273" class="outline-3">
<h3 id="org76a5273">Exercise 3.39</h3>
<div class="outline-text-3" id="text-org76a5273">
<p class="verse">
Which of the five possibilities in the parallel execution shown above remain if<br>
we instead serialize execution as follows:<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;(define x 10)<br>
&#xa0;&#xa0;&#xa0;&#xa0;(define s (make-serializer))<br>
&#xa0;&#xa0;&#xa0;&#xa0;(parallel-execute<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(lambda ()<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set! x ((s (lambda () (* x x))))))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(s (lambda () (set! x (+ x 1)))))<br>
</p>
</div>
<div id="outline-container-orga3528e8" class="outline-4">
<h4 id="orga3528e8">Answer</h4>
<div class="outline-text-4" id="text-orga3528e8">
<p class="verse">
101, 100, 121<br>
</p>
</div>
</div>
</div>


<div id="outline-container-orge74b41c" class="outline-3">
<h3 id="orge74b41c">Exercise 3.40</h3>
<div class="outline-text-3" id="text-orge74b41c">
<p class="verse">
Give all possible values of x that can result from executing<br>
<br>
(define x 10)<br>
(parallel-execute<br>
&#xa0;(lambda () (set! x (* x x)))<br>
&#xa0;(lambda () (set! x (* x x x))))<br>
<br>
Which of these possibilities remain if we instead use serialized procedures:<br>
<br>
(define x 10)<br>
(define s (make-serializer))<br>
(parallel-execute<br>
&#xa0;(s (lambda () (set! x (* x x))))<br>
&#xa0;(s (lambda () (set! x (* x x x)))))<br>
<br>
</p>
</div>
<div id="outline-container-orgeabf337" class="outline-4">
<h4 id="orgeabf337">Answer</h4>
<div class="outline-text-4" id="text-orgeabf337">
<p class="verse">
x*6 (multiplication is commutative)<br>
</p>
</div>
</div>
</div>

<div id="outline-container-org051e1e3" class="outline-3">
<h3 id="org051e1e3">Exercise 3.41</h3>
<div class="outline-text-3" id="text-org051e1e3">
<p class="verse">
Ben Bitdiddle worries that it would be better to implement the bank account as<br>
follows (where the commented line has been changed):<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (make-account balance)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (withdraw amount)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(if (&gt;= balance amount)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(begin<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set! balance<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(- balance amount))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;balance)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;"Insufficient funds"))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (deposit amount)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set! balance (+ balance amount))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;balance)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(let ((protected (make-serializer)))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (dispatch m)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cond ((eq? m 'withdraw)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(protected withdraw))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;((eq? m 'deposit)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(protected deposit))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;((eq? m 'balance)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;((protected<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(lambda ()<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;balance)))) ; serialized<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(else<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(error<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;"Unknown request:<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;MAKE-ACCOUNT"<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;m))))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;dispatch))<br>
<br>
because allowing unserialized access to the bank balance can result in anomalous<br>
behavior. Do you agree? Is there any scenario that demonstrates Ben’s concern?<br>
</p>
</div>

<div id="outline-container-orgb1d2b05" class="outline-4">
<h4 id="orgb1d2b05">Answer</h4>
<div class="outline-text-4" id="text-orgb1d2b05">
<blockquote>
<p>
First off, this question is phrased in a really shitty way. Second off, no
<b>BALANCE</b> is safe. the other functions are <b>UNSAFE</b>
</p>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-org9833340" class="outline-3">
<h3 id="org9833340">Exercise 3.42</h3>
<div class="outline-text-3" id="text-org9833340">
<p class="verse">
Ben Bitdiddle suggests that it’s a waste of time to create a new serialized<br>
procedure in response to every withdraw and deposit message. He says that<br>
make-account could be changed so that the calls to protected are done outside<br>
the dispatch procedure. That is, an account would return the same serialized<br>
procedure (which was created at the same time as the account) each time it is<br>
asked for a withdrawal procedure.<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (make-account balance)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (withdraw amount)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(if (&gt;= balance amount)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(begin (set! balance<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(- balance amount))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;balance)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;"Insufficient funds"))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (deposit amount)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(set! balance (+ balance amount))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;balance)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(let ((protected (make-serializer)))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(let ((protected-withdraw<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(protected withdraw))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(protected-deposit<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(protected deposit)))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(define (dispatch m)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(cond ((eq? m 'withdraw)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;protected-withdraw)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;((eq? m 'deposit)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;protected-deposit)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;((eq? m 'balance)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;balance)<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(else<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(error "Unknown request: MAKE-ACCOUNT"<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;m))))<br>
&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;dispatch)))<br>
</p>
</div>

<div id="outline-container-orgeed142a" class="outline-4">
<h4 id="orgeed142a">Answer</h4>
<div class="outline-text-4" id="text-orgeed142a">
<p class="verse">
This is fine<br>
</p>
</div>
</div>
</div>

<div id="outline-container-org8c4b657" class="outline-3">
<h3 id="org8c4b657"><span class="todo TODO">TODO</span> Exercise 3.43</h3>
<div class="outline-text-3" id="text-org8c4b657">
<p class="verse">
Suppose that the balances in three accounts start out as $10, $20, and $30,<br>
and that multiple processes run, exchanging the balances in the accounts.<br>
Argue that if the processes are run sequentially, after any number of<br>
concurrent exchanges, the account balances should be $10, $20, and $30 in<br>
some order. Draw a timing diagram like the one in *Note Figure 3-29:: to<br>
show how this condition can be violated if the exchanges are implemented<br>
using the first version of the account-exchange program in this section. On<br>
the other hand, argue that even with this `exchange' program, the sum of<br>
the balances in the accounts will be preserved. Draw a timing diagram to<br>
show how even this condition would be violated if we did not serialize the<br>
transactions on individual accounts.<br>
</p>
</div>
<div id="outline-container-orgf769266" class="outline-4">
<h4 id="orgf769266">Answer</h4>
<div class="outline-text-4" id="text-orgf769266">
<blockquote>
<p>
SKIPPED: Timing diagram
</p>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-orgce9aaee" class="outline-3">
<h3 id="orgce9aaee"><span class="todo TODO">TODO</span> Exercise 3.47</h3>
<div class="outline-text-3" id="text-orgce9aaee">
<p class="verse">
A semaphore (of size n ) is a generalization of a mutex. Like a mutex, a<br>
semaphore supports acquire and release operations, but it is more general in<br>
that up to n processes can acquire it concurrently. Additional processes that<br>
attempt to acquire the semaphore must wait for release operations. Give<br>
implementations of semaphores<br>
<br>
&#xa0;&#xa0;&#xa0;&#xa0;1. In terms of mutexes<br>
&#xa0;&#xa0;&#xa0;&#xa0;2. In terms of atomic test-and-set! operations.<br>
</p>
</div>
</div>
</section>
