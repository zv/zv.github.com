---
layout: page
title: SICP Chapter 3 Exercises & Solutions
category: note
tags:
 - post
 - SICP
 - solutions
---
<section id="outline-container-orgc4949ca" class="outline-2">
<h2 id="orgc4949ca"></h2>
<div class="outline-text-2" id="text-orgc4949ca">
<p>
The HTML for this page has been automatically generated by parsing the loosely
formatted source code &amp; comments included in my solutions repository
(<a href="https://github.com/zv/SICP-guile">https://github.com/zv/SICP-guile</a>), if you encounter any unformatted
solutions, you think you&rsquo;ve spotted an error or you have something you&rsquo;d like
to share about the exercises, don&rsquo;t hesitate to leave a comment below
(or a pull request on the source repo).
</p>
</div>
</section>


<section id="outline-container-org2e24b31" class="outline-2">
<h2 id="org2e24b31">Exercises Chapter 3</h2>
<div class="outline-text-2" id="text-org2e24b31">
</div>
<div id="outline-container-org56891fe" class="outline-3">
<h3 id="org56891fe">Exercise 3.1</h3>
<div class="outline-text-3" id="text-org56891fe">
<div class="question" id="orgd789081">
<p>
An accumulator is a procedure that is called repeatedly with a single numeric
argument and accumulates its arguments into a sum. Each time it is called, it
returns the currently accumulated sum. Write a procedure make-accumulator that
generates accumulators, each maintaining an independent sum. The input to
make-accumulator should specify the initial value of the sum;
</p>

<p>
(define A (make-accumulator 5)) 
</p>

</div>
</div>
<div id="outline-container-org68d0b28" class="outline-4">
<h4 id="org68d0b28">Answer</h4>
<div class="outline-text-4" id="text-org68d0b28">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">make-accumulator</span> x<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">lambda</span> <span style="color: #2d9574;">(</span>n<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span>+ x n<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf7b6985" class="outline-3">
<h3 id="orgf7b6985">Exercise 3.2</h3>
<div class="outline-text-3" id="text-orgf7b6985">
<div class="question" id="org8cc0e31">
<p>
In software-testing applications, it is useful to be able to count
the number of times a given procedure is called during the course of a
computation. Write a procedure make-monitored that takes as input a procedure,
f, that itself takes one input. The result returned by make-monitored is a third
procedure, say mf, that keeps track of the number of times it has been called by
maintaining an internal counter. If the input to mf is the special symbol
how-many-calls?, then mf returns the value of the counter. If the input is the
special symbol reset-count, then mf resets the counter to zero. For any other
input, mf returns the result of calling f on that input and increments the
counter. For instance, we could make a monitored version of the sqrt procedure: 
</p>

</div>
</div>
<div id="outline-container-orgf77a17a" class="outline-4">
<h4 id="orgf77a17a">Answer</h4>
<div class="outline-text-4" id="text-orgf77a17a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">make-monitored</span> f<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163; font-weight: bold;">calls</span> <span style="color: #4e3163;">0</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">lambda</span> <span style="color: #2d9574;">(</span>n<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #67b11d;">(</span>eq? n 'how-many-calls?<span style="color: #67b11d;">)</span>
        calls
        <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">begin</span>
          <span style="color: #b1951d;">(</span>set! calls <span style="color: #3a81c3;">(</span>inc calls<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span>
          <span style="color: #b1951d;">(</span>f n<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga1d4192" class="outline-4">
<h4 id="orga1d4192">Exercise 3.3</h4>
<div class="outline-text-4" id="text-orga1d4192">
<div class="question" id="org2a1ab0a">
<p>
Modify the make-account procedure so that it creates password-protected
accounts. That is, make-account should take a symbol as an additional argument,
as in
</p>

</div>
</div>
</div>
<div id="outline-container-orgd4b2729" class="outline-4">
<h4 id="orgd4b2729">Answer</h4>
<div class="outline-text-4" id="text-orgd4b2729">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163; font-weight: bold;">3.3/acc</span> <span style="color: #6c3163;">(</span>make-account <span style="color: #4e3163;">100</span> 'secret-password<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">3.3/make-account</span> acct# passwd<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #2d9574;">(</span><span style="color: #6c3163; font-weight: bold;">withdraw</span> amount<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #67b11d;">(</span>&gt;= balance amount<span style="color: #67b11d;">)</span>
        <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">begin</span> <span style="color: #b1951d;">(</span>set! balance
                 <span style="color: #3a81c3;">(</span>- balance amount<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span>
               balance<span style="color: #67b11d;">)</span>
        <span style="color: #2d9574;">"Insufficient funds"</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #2d9574;">(</span><span style="color: #6c3163; font-weight: bold;">deposit</span> amount<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span>set! balance <span style="color: #67b11d;">(</span>+ balance amount<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    balance<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #2d9574;">(</span><span style="color: #6c3163; font-weight: bold;">dispatch</span> m<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">cond</span> <span style="color: #67b11d;">(</span><span style="color: #b1951d;">(</span>eq? m 'withdraw<span style="color: #b1951d;">)</span> withdraw<span style="color: #67b11d;">)</span>
          <span style="color: #67b11d;">(</span><span style="color: #b1951d;">(</span>eq? m 'deposit<span style="color: #b1951d;">)</span> deposit<span style="color: #67b11d;">)</span>
          <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">else</span> <span style="color: #b1951d;">(</span>error <span style="color: #2d9574;">"Unknown request:</span>
<span style="color: #2d9574;">                 MAKE-ACCOUNT"</span> m<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  dispatch<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgabd0856" class="outline-3">
<h3 id="orgabd0856">Exercise 3.5</h3>
<div class="outline-text-3" id="text-orgabd0856">
<div class="question" id="orgc263033">
<p>
Monte Carlo integration is a method of estimating definite integrals by means of
Monte Carlo simulation. Consider computing the area of a region of space
described by a predicate p ( x , y ) that is true for points ( x , y ) in the
region and #f for points not in the region. For example, the region contained
within a circle of radius 3 centered at (5, 7) is described by the predicate
that tests whether ( x − 5 ) 2 + ( y − 7 ) 2 ≤ 3 2 . To estimate the area of the
region described by such a predicate, begin by choosing a rectangle that
contains the region. For example, a rectangle with diagonally opposite corners
at (2, 4) and (8, 10) contains the circle above. The desired integral is the
area of that portion of the rectangle that lies in the region. We can estimate
the integral by picking, at random, points ( x , y ) that lie in the rectangle,
and testing p ( x , y ) for each point to determine whether the point lies in
the region. If we try this with many points, then the fraction of points that
fall in the region should give an estimate of the proportion of the rectangle
that lies in the region. Hence, multiplying this fraction by the area of the
entire rectangle should produce an estimate of the integral.
</p>

<p>
Implement Monte Carlo integration as a procedure estimate-integral that takes as
arguments a predicate p, upper and lower bounds x1, x2, y1, and y2 for the
rectangle, and the number of trials to perform in order to produce the estimate.
Your procedure should use the same monte-carlo procedure that was used above to
estimate π . Use your estimate-integral to produce an estimate of π by measuring
the area of a unit circle.
</p>

<p>
You will find it useful to have a procedure that returns a number chosen at
random from a given range. The following random-in-range procedure implements
this in terms of the random procedure used in 1.2.6, which returns a nonnegative
number less than its input.136 
</p>

</div>
</div>
<div id="outline-container-org7c36794" class="outline-4">
<h4 id="org7c36794">Answer</h4>
<div class="outline-text-4" id="text-org7c36794">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">random-in-range</span> low high<span style="color: #6c3163;">)</span>
  <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">had to write my own</span>
  <span style="color: #6c3163;">(</span>+ low <span style="color: #2d9574;">(</span>random high<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">estimate-integral</span> p x1 x2 y1 y2 trials<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163; font-weight: bold;">width</span> <span style="color: #2d9574;">(</span>abs <span style="color: #67b11d;">(</span>- x2 x1<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163; font-weight: bold;">height</span> <span style="color: #2d9574;">(</span>abs <span style="color: #67b11d;">(</span>- y2 y1<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163; font-weight: bold;">area</span> <span style="color: #2d9574;">(</span>* width height<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #2d9574;">(</span><span style="color: #6c3163; font-weight: bold;">iter</span> remaining passed<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">let*</span> <span style="color: #67b11d;">(</span><span style="color: #b1951d;">(</span>x <span style="color: #3a81c3;">(</span>random-in-range x1 x2<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span>
           <span style="color: #b1951d;">(</span>y <span style="color: #3a81c3;">(</span>random-in-range y1 y2<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span>
           <span style="color: #b1951d;">(</span>is-contained? <span style="color: #3a81c3;">(</span>p x y<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">cond</span> <span style="color: #b1951d;">(</span><span style="color: #3a81c3;">(</span>= remaining <span style="color: #4e3163;">0</span><span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">(</span>/ passed trials<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span>
            <span style="color: #b1951d;">(</span>is-contained? <span style="color: #3a81c3;">(</span>iter <span style="color: #6c3163;">(</span>dec remaining<span style="color: #6c3163;">)</span>
                                 <span style="color: #6c3163;">(</span>inc passed<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span>
            <span style="color: #b1951d;">(</span><span style="color: #3a81c3; font-weight: bold;">else</span>
             <span style="color: #3a81c3;">(</span>iter <span style="color: #6c3163;">(</span>dec remaining<span style="color: #6c3163;">)</span> passed<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>* area
     <span style="color: #2d9574;">(</span>iter trials <span style="color: #4e3163;">0</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">unit-circle-pred</span> x y<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>&lt;= <span style="color: #2d9574;">(</span>+ <span style="color: #67b11d;">(</span>* x x<span style="color: #67b11d;">)</span> <span style="color: #67b11d;">(</span>* y y<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span> <span style="color: #4e3163;">1</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2258025" class="outline-3">
<h3 id="org2258025">Exercise 3.6</h3>
<div class="outline-text-3" id="text-org2258025">
<div class="question" id="org8a5ae27">
<p>
It is useful to be able to reset a random-number generator to produce a sequence
starting from a given value. Design a new rand procedure that is called with an
argument that is either the symbol generate or the symbol reset and behaves as
follows: (rand &rsquo;generate) produces a new random number; ((rand &rsquo;reset)
⟨new-value⟩) resets the internal state variable to the designated ⟨new-value⟩.
Thus, by resetting the state, one can generate repeatable sequences. These are
very handy to have when testing and debugging programs that use random numbers. 
</p>

</div>
</div>
<div id="outline-container-org866abbc" class="outline-4">
<h4 id="org866abbc">Answer</h4>
<div class="outline-text-4" id="text-org866abbc">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">This is what I assume he meant??</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">rand</span> command<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">case</span> command
    <span style="color: #2d9574;">(</span>'generate <span style="color: #67b11d;">(</span>random <span style="color: #4e3163;">10</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">else</span> <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">&#955;</span> <span style="color: #b1951d;">(</span>new<span style="color: #b1951d;">)</span> <span style="color: #b1951d;">(</span>seed-&gt;random-state new<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Utilities</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">count-pairs</span> x<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #2d9574;">(</span>not <span style="color: #67b11d;">(</span>pair? x<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
      <span style="color: #4e3163;">0</span>
      <span style="color: #2d9574;">(</span>+ <span style="color: #67b11d;">(</span>count-pairs <span style="color: #b1951d;">(</span>car x<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
         <span style="color: #67b11d;">(</span>count-pairs <span style="color: #b1951d;">(</span>cdr x<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
         <span style="color: #4e3163;">1</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfab8fee" class="outline-3">
<h3 id="orgfab8fee">Exercise 3.12:</h3>
<div class="outline-text-3" id="text-orgfab8fee">
<div class="question" id="orge8bd4a6">
<p>
The following procedure for appending lists was introduced in 2.2.1:
</p>

<p>
(define (append x y)
(if (null? x)
y
(cons (car x) (append (cdr x) y))))
</p>

<p>
Append forms a new list by successively consing the elements of x onto y. The
procedure append! is similar to append, but it is a mutator rather than a
constructor. It appends the lists by splicing them together, modifying the final
pair of x so that its cdr is now y. (It is an error to call append! with an
empty x.)
</p>

</div>
</div>

<div id="outline-container-org809b624" class="outline-4">
<h4 id="org809b624">Answer</h4>
<div class="outline-text-4" id="text-org809b624">
<div class="textanswer" id="org31a1c13">
<p>
An infinite loop occurs (a cycle in the linked list has been made)
</p>

</div>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">last-pair</span> x<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #2d9574;">(</span>null? <span style="color: #67b11d;">(</span>cdr x<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
      x
      <span style="color: #2d9574;">(</span>last-pair <span style="color: #67b11d;">(</span>cdr x<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163; font-weight: bold;">x</span> <span style="color: #6c3163;">(</span>list 'a 'b<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163; font-weight: bold;">y</span> <span style="color: #6c3163;">(</span>list 'c 'd<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163; font-weight: bold;">z</span> <span style="color: #6c3163;">(</span>append x y<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Exercise 3.13</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">What happens if we try to compute (last-pair z)?</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">make-cycle</span> x<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>set-cdr! <span style="color: #2d9574;">(</span>last-pair x<span style="color: #2d9574;">)</span> x<span style="color: #6c3163;">)</span>
  x<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7e2c904" class="outline-3">
<h3 id="org7e2c904">Exercise 3.14:</h3>
<div class="outline-text-3" id="text-org7e2c904">
<div class="question" id="orgb83790c">
<p>
The following procedure is quite useful, although obscure:
</p>

<p>
(define (mystery x)
  (define (loop x y)
    (if (null? x)
        y
        (let ((temp (cdr x)))
          (set-cdr! x y)
          (loop temp x))))
  (loop x &rsquo;()))
</p>

<p>
Loop uses the “temporary” variable temp to hold the old value of the cdr of x,
since the set-cdr! on the next line destroys the cdr. Explain what mystery does
in general. Suppose v is defined by (define v (list &rsquo;a &rsquo;b &rsquo;c &rsquo;d)). Draw the
box-and-pointer diagram that represents the list to which v is bound. Suppose
that we now evaluate (define w (mystery v)). Draw box-and-pointer diagrams that
show the structures v and w after evaluating this expression. What would be
printed as the values of v and w?
</p>

</div>
</div>
<div id="outline-container-orgfe2af2f" class="outline-4">
<h4 id="orgfe2af2f">Answer</h4>
<div class="outline-text-4" id="text-orgfe2af2f">
<div class="textanswer" id="org851b47a">
<p>
Mystery requotes an array &ldquo;in-place&rdquo;
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-org990b436" class="outline-3">
<h3 id="org990b436">Exercise 3.16</h3>
<div class="outline-text-3" id="text-org990b436">
<div class="question" id="orgf5e72cc">
<p>
Ben Bitdiddle decides to write a procedure to count the number of pairs in any
list structure. “It’s easy,” he reasons. “The number of pairs in any structure
is the number in the car plus the number in the cdr plus one more to count the
current pair.” So Ben writes the following procedure:
</p>

<p>
(define (count-pairs x)
  (if (not (pair? x))
      0
      (+ (count-pairs (car x))
        (count-pairs (cdr x))
        1)))
</p>

<p>
Show that this procedure is not correct. In particular, draw box-and-pointer
diagrams representing list structures made up of exactly three pairs for which
Ben’s procedure would return 3; return 4; return 7; never return at all.
</p>

</div>
</div>

<div id="outline-container-orgeebb137" class="outline-4">
<h4 id="orgeebb137">Answer</h4>
<div class="outline-text-4" id="text-orgeebb137">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163; font-weight: bold;">count-three-pairs</span> '<span style="color: #6c3163;">(</span>a b c<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163; font-weight: bold;">count-four-pairs</span> '<span style="color: #6c3163;">(</span>a b c<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163; font-weight: bold;">count-seven-pairs</span> '<span style="color: #6c3163;">(</span>a b c<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span>set-car! <span style="color: #6c3163;">(</span>cdr count-four-pairs<span style="color: #6c3163;">)</span> <span style="color: #6c3163;">(</span>cdr <span style="color: #2d9574;">(</span>cdr count-four-pairs<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span>set-car! count-seven-pairs <span style="color: #6c3163;">(</span>cdr count-seven-pairs<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">#|</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">Answer:</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">(count-pairs count-three-pairs) =&gt; 3</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">(count-pairs count-four-pairs)  =&gt; 4</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">(count-pairs count-seven-pairs) =&gt; 7</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">|#</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2ae6dad" class="outline-3">
<h3 id="org2ae6dad">Exercise 3.17</h3>
<div class="outline-text-3" id="text-org2ae6dad">
<div class="question" id="org044822c">
<p>
Devise a correct version of the count-pairs procedure of Exercise 3.16 that
returns the number of distinct pairs in any structure.
</p>

<p>
(Hint: Traverse the structure, maintaining an auxiliary data structure that is
used to keep track of which pairs have already been counted.)
</p>

</div>
</div>

<div id="outline-container-org4131c52" class="outline-4">
<h4 id="org4131c52">Answer</h4>
<div class="outline-text-4" id="text-org4131c52">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">zv-count-pairs</span> xs<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163; font-weight: bold;">counted</span> '<span style="color: #2d9574;">()</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #2d9574;">(</span><span style="color: #6c3163; font-weight: bold;">loop</span> xs<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">cond</span> <span style="color: #67b11d;">(</span><span style="color: #b1951d;">(</span>not <span style="color: #3a81c3;">(</span>pair? xs<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span> <span style="color: #4e3163;">1</span><span style="color: #67b11d;">)</span>
          <span style="color: #67b11d;">(</span><span style="color: #b1951d;">(</span>null? xs<span style="color: #b1951d;">)</span> <span style="color: #4e3163;">0</span><span style="color: #67b11d;">)</span>
          <span style="color: #67b11d;">(</span><span style="color: #b1951d;">(</span>memq <span style="color: #3a81c3;">(</span>car xs<span style="color: #3a81c3;">)</span> counted<span style="color: #b1951d;">)</span> <span style="color: #4e3163;">0</span><span style="color: #67b11d;">)</span>
          <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">else</span>
           <span style="color: #b1951d;">(</span><span style="color: #3a81c3; font-weight: bold;">begin</span>
             <span style="color: #3a81c3;">(</span>set! counted <span style="color: #6c3163;">(</span>cons <span style="color: #2d9574;">(</span>car xs<span style="color: #2d9574;">)</span> counted<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
             <span style="color: #3a81c3;">(</span>+ <span style="color: #6c3163;">(</span>loop <span style="color: #2d9574;">(</span>car xs<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
                <span style="color: #6c3163;">(</span>loop <span style="color: #2d9574;">(</span>cdr xs<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>loop xs<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5834b0c" class="outline-3">
<h3 id="org5834b0c">Exercise 3.18</h3>
<div class="outline-text-3" id="text-org5834b0c">
<div class="question" id="org116fe22">
<p>
Write a procedure that examines a list and determines whether it contains a
cycle, that is, whether a program that tried to find the end of the list by
taking successive cdrs would go into an infinite loop. Exercise 3.13 constructed
such lists.
</p>

</div>
</div>
<div id="outline-container-org8e31465" class="outline-4">
<h4 id="org8e31465">Answer</h4>
<div class="outline-text-4" id="text-org8e31465">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">has-cycles?</span> xs<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163; font-weight: bold;">visited</span> '<span style="color: #2d9574;">()</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #2d9574;">(</span><span style="color: #6c3163; font-weight: bold;">search</span> ys<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">cond</span> <span style="color: #67b11d;">(</span><span style="color: #b1951d;">(</span>null? ys<span style="color: #b1951d;">)</span> #f<span style="color: #67b11d;">)</span>
          <span style="color: #67b11d;">(</span><span style="color: #b1951d;">(</span>memq <span style="color: #3a81c3;">(</span>car ys<span style="color: #3a81c3;">)</span> visited<span style="color: #b1951d;">)</span> #t<span style="color: #67b11d;">)</span>
          <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">else</span>
           <span style="color: #b1951d;">(</span><span style="color: #3a81c3; font-weight: bold;">begin</span>
             <span style="color: #3a81c3;">(</span>set! visited <span style="color: #6c3163;">(</span>cons <span style="color: #2d9574;">(</span>car ys<span style="color: #2d9574;">)</span> visited<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
             <span style="color: #3a81c3;">(</span>search <span style="color: #6c3163;">(</span>cdr ys<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>search xs<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1b5740c" class="outline-3">
<h3 id="org1b5740c">Exercise 3.19</h3>
<div class="outline-text-3" id="text-org1b5740c">
<div class="question" id="org897094b">
<p>
Redo Exercise 3.18 using an algorithm that takes only a constant amount of
space. (This requires a very clever idea.)
</p>

</div>
</div>
<div id="outline-container-orge3b9c61" class="outline-4">
<h4 id="orge3b9c61">Answer</h4>
<div class="outline-text-4" id="text-orge3b9c61">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define*</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">linear-cycle-search</span> x1
                              <span style="color: #3a81c3;">#:optional</span> <span style="color: #2d9574;">(</span>x2 <span style="color: #67b11d;">(</span>cdr x1<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">cond</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">or</span> <span style="color: #b1951d;">(</span>null? <span style="color: #3a81c3;">(</span>cdr x1<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span> <span style="color: #b1951d;">(</span>null? <span style="color: #3a81c3;">(</span>cdr x2<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span> #f<span style="color: #2d9574;">)</span>
        <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>eq? x1 x2<span style="color: #67b11d;">)</span> #t<span style="color: #2d9574;">)</span>
        <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">else</span> <span style="color: #67b11d;">(</span>linear-cycle-search <span style="color: #b1951d;">(</span>cdr x1<span style="color: #b1951d;">)</span> <span style="color: #b1951d;">(</span>cdr <span style="color: #3a81c3;">(</span>cdr x2<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb0e41a5" class="outline-3">
<h3 id="orgb0e41a5">Exercise 3.21</h3>
<div class="outline-text-3" id="text-orgb0e41a5">
<div class="question" id="org04eab62">
<p>
Ben Bitdiddle decides to test the queue implementation described above. He types
in the procedures to the Lisp interpreter and proceeds to try them out:
</p>

<p>
“It’s all wrong!” he complains. “The interpreter’s response shows that the last
item is inserted into the queue twice. And when I delete both items, the second
b is still there, so the queue isn’t empty, even though it’s supposed to be.”
Eva Lu Ator suggests that Ben has misunderstood what is happening. “It’s not
that the items are going into the queue twice,” she explains. “It’s just that
the standard Lisp printer doesn’t know how to make sense of the queue
representation. If you want to see the queue printed correctly, you’ll have to
define your own print procedure for queues.” Explain what Eva Lu is talking
about. In particular, show why Ben’s examples produce the printed results that
they do. Define a procedure print-queue that takes a queue as input and prints
the sequence of items in the queue.
</p>

</div>
</div>

<div id="outline-container-orgad52612" class="outline-4">
<h4 id="orgad52612">Answer</h4>
<div class="outline-text-4" id="text-orgad52612">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">print-queue</span> qs<span style="color: #6c3163;">)</span> <span style="color: #6c3163;">(</span>format #t <span style="color: #2d9574;">"~a~%"</span> <span style="color: #2d9574;">(</span>car qs<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4e2446d" class="outline-3">
<h3 id="org4e2446d">Exercise 3.22</h3>
<div class="outline-text-3" id="text-org4e2446d">
<div class="question" id="org32fa5fc">
<p>
Instead of representing a queue as a pair of pointers, we can build a queue as a
procedure with local state. The local state will consist of pointers to the
beginning and the end of an ordinary list. Thus, the make-queue procedure will
have the form
</p>

<p>
(define (make-queue)
(let ((front-ptr … )
(rear-ptr … ))
⟨definitions of internal procedures⟩
(define (dispatch m) …)
dispatch))
</p>

<p>
Complete the definition of make-queue and provide implementations of the queue
operations using this representation.
</p>

</div>
</div>

<div id="outline-container-org33e7922" class="outline-4">
<h4 id="org33e7922">Answer</h4>
<div class="outline-text-4" id="text-org33e7922">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">make-curryq</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>front-ptr '<span style="color: #b1951d;">()</span><span style="color: #67b11d;">)</span>
        <span style="color: #67b11d;">(</span>rear-ptr '<span style="color: #b1951d;">()</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #67b11d;">(</span><span style="color: #6c3163; font-weight: bold;">set-fptr!</span> item<span style="color: #67b11d;">)</span> <span style="color: #67b11d;">(</span>set! front-ptr item<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #67b11d;">(</span><span style="color: #6c3163; font-weight: bold;">set-rptr!</span> item<span style="color: #67b11d;">)</span> <span style="color: #67b11d;">(</span>set! rear-ptr item<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #67b11d;">(</span><span style="color: #6c3163; font-weight: bold;">empty-curryq?</span><span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span>null? front-ptr<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #67b11d;">(</span><span style="color: #6c3163; font-weight: bold;">front-curryq</span><span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #b1951d;">(</span>empty-curryq?<span style="color: #b1951d;">)</span>
          <span style="color: #b1951d;">(</span>error <span style="color: #2d9574;">"FRONT on empty queue"</span><span style="color: #b1951d;">)</span>
          <span style="color: #b1951d;">(</span>car front-ptr<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #67b11d;">(</span><span style="color: #6c3163; font-weight: bold;">insert-curryq!</span> item<span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #b1951d;">(</span><span style="color: #3a81c3;">(</span>new-pair <span style="color: #6c3163;">(</span>cons item '<span style="color: #2d9574;">()</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span>
        <span style="color: #b1951d;">(</span><span style="color: #3a81c3; font-weight: bold;">cond</span> <span style="color: #3a81c3;">[</span><span style="color: #6c3163;">(</span>empty-curryq?<span style="color: #6c3163;">)</span>
               <span style="color: #6c3163;">(</span>set-fptr! item<span style="color: #6c3163;">)</span>
               <span style="color: #6c3163;">(</span>set-rptr! item<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">]</span>
              <span style="color: #3a81c3;">[</span>else
               <span style="color: #6c3163;">(</span>set! rear-ptr new-pair<span style="color: #6c3163;">)</span>
               <span style="color: #6c3163;">(</span>set-rptr! new-pair<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">]</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #67b11d;">(</span><span style="color: #6c3163; font-weight: bold;">print-queue</span><span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span>format #t <span style="color: #2d9574;">"~a~%"</span> front-ptr<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #67b11d;">(</span><span style="color: #6c3163; font-weight: bold;">dispatch</span> m<span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">cond</span> <span style="color: #b1951d;">[</span><span style="color: #3a81c3;">(</span>eq? m 'front-ptr<span style="color: #3a81c3;">)</span> front-ptr<span style="color: #b1951d;">]</span>
            <span style="color: #b1951d;">[</span><span style="color: #3a81c3;">(</span>eq? m 'rear-ptr<span style="color: #3a81c3;">)</span> rear-ptr<span style="color: #b1951d;">]</span>
            <span style="color: #b1951d;">[</span><span style="color: #3a81c3;">(</span>eq? m 'insert-queue!<span style="color: #3a81c3;">)</span> insert-curryq!<span style="color: #b1951d;">]</span>
            <span style="color: #b1951d;">[</span><span style="color: #3a81c3;">(</span>eq? m 'print-queue<span style="color: #3a81c3;">)</span> print-queue<span style="color: #b1951d;">]</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    dispatch<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org047b1b6" class="outline-3">
<h3 id="org047b1b6">Exercise 3.23</h3>
<div class="outline-text-3" id="text-org047b1b6">
<div class="question" id="org20ec9b4">
<p>
A deque (“double-ended queue”) is a sequence in which items can be inserted and
deleted at either the front or the rear. Operations on deques are the
constructor make-deque, the predicate empty-deque?, selectors front-deque and
rear-deque, and mutators front-insert-deque!, rear-insert-deque!,
front-delete-deque!, rear-delete-deque!. Show how to represent deques using
pairs, and give implementations of the operations. All operations should be
accomplished in Θ(1) steps.
</p>

</div>
</div>

<div id="outline-container-org3c7a7b5" class="outline-4">
<h4 id="org3c7a7b5">Answer</h4>
<div class="outline-text-4" id="text-org3c7a7b5">
<div class="question" id="orgcd25073">
<p>
This is the structure I&rsquo;ve decided to use for the deque. There may be other
neat ways to encode a deque with cons-cells. I&rsquo;d love to hear if anyone has
a better structure:
</p>

<p>
F: Front Ptr
B: Back Ptr
X: Value
/: Null or End
</p>

<p>
<del>---</del>&#x2014;+
</p>
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">F</td>
<td class="org-left">B</td>
<td class="org-left">------------&#x2013;&#x2014;+</td>
</tr>
</tbody>
</table>
<p>
<del>-|-</del>&#x2014;+                 |
V                       V
<del>-</del>-<del>---</del>   <del>---</del>&#x2014;+   <del>-</del>-<del>---</del>
</p>
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">*</td>
<td class="org-left">&#x2013;&gt;</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">&#x2013;&gt;</td>
<td class="org-left">*</td>
<td class="org-left">/</td>
</tr>
</tbody>
</table>
<p>
<del>-|-</del>&#x2014;+   <del>-|-</del>&#x2014;+   <del>-|-</del>&#x2014;+
V   ^&#x2014;+   V   ^&#x2014;+   V
<del>-</del>-<del>---</del> | <del>---</del>&#x2014;+ | <del>---</del>&#x2014;+
</p>
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">X</td>
<td class="org-left">/</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">X</td>
<td class="org-left">*</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">X</td>
<td class="org-left">*</td>
</tr>
</tbody>
</table>
<p>
<del>---</del>&#x2014;+ | <del>---</del>-<del>-</del> | <del>---</del>-<del>-</del>
</p>
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<p>
<del>-------</del>   <del>-------</del>
</p>

<p>
(define (make-deque) &rsquo;(() . ()))
(define (empty-deque? dq) (null? (front-deque dq)))
(define (front-deque dq) (car dq))
(define (rear-deque dq) (cdr dq))
(define (next-deque lst) (if (null? lst) &rsquo;() (cdr lst)))
(define (prev-deque lst) (if (null? lst) &rsquo;() (cdar lst)))
</p>

<p>
(define (front-insert-deque! dq value)
  (let ([new-elt (cons (cons value &rsquo;()) &rsquo;())])
    (cond
    ((empty-deque? dq)
      (set-car! dq new-elt) (set-cdr! dq new-elt)
      dq)
    (else
      ;; link our next element to the current front
      (set-cdr! new-elt (front-deque dq))
      ;; find the next element to make a backwards link
      (set-cdr! (car (front-deque dq)) new-elt)
      (set-car! dq new-elt)
      dq))))
</p>

<p>
(define (rear-insert-deque! dq value)
  (let ([new-elt (cons (cons value &rsquo;()) &rsquo;())])
    (cond
    ((empty-deque? dq)
      (set-car! dq new-elt) (set-cdr! dq new-elt)
      dq)
    (else
      ;; Link our backwards element
      (set-cdr! (car new-elt) (rear-deque dq))
      (set-cdr! (rear-deque dq) new-elt)
      (set-cdr! dq new-elt)
      dq))))
</p>

<p>
(define (front-delete-deque! dq)
  (let ([next (next-deque (front-deque dq))]
        [front (front-deque dq)])
    (cond
    ((null? next) (set-car! dq &rsquo;()) (set-cdr! dq &rsquo;()))
    (else
      (set-car! dq next)
      (set-cdr! (car (front-deque dq)) &rsquo;())))
    front))
</p>

<p>
(define (rear-delete-deque! dq)
  (let ([rear (rear-deque dq)]
        [prev (prev-deque (rear-deque dq))])
    (cond
    ((null? rear) (set-car! dq &rsquo;()) (set-cdr! dq &rsquo;()))
    (else
      (set-cdr! dq prev)
      (set-cdr! (rear-deque dq) &rsquo;())))
    rear))
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-org402518e" class="outline-3">
<h3 id="org402518e">Exercise 3.24:</h3>
<div class="outline-text-3" id="text-org402518e">
<div class="question" id="org1eef648">
<p>
In the table implementations above, the keys are tested for equality using
`equal?&rsquo; (called by `assoc&rsquo;). This is not always the appropriate test. For
instance, we might have a table with numeric keys in which we don&rsquo;t need an
exact match to the number we&rsquo;re looking up, but only a number within some
tolerance of it. Design a table constructor `make-table&rsquo; that takes as an
argument a `same-key?&rsquo; procedure that will be used to test &ldquo;equality&rdquo; of
keys. `Make-table&rsquo; should return a `dispatch&rsquo; procedure that can be used to
access appropriate `lookup&rsquo; and `insert!&rsquo; procedures for a local table.
</p>

</div>
</div>
<div id="outline-container-org1e269ab" class="outline-4">
<h4 id="org1e269ab">Answer</h4>
<div class="outline-text-4" id="text-org1e269ab">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">make-table-with-key</span> same-key?<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>local-table <span style="color: #b1951d;">(</span>list '*table*<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">just redefine `assoc' with `same-key?'</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #67b11d;">(</span><span style="color: #6c3163; font-weight: bold;">assoc</span> key records<span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">cond</span> <span style="color: #b1951d;">(</span><span style="color: #3a81c3;">(</span>null? records<span style="color: #3a81c3;">)</span> #f<span style="color: #b1951d;">)</span>
            <span style="color: #b1951d;">(</span><span style="color: #3a81c3;">(</span>same-key? key <span style="color: #6c3163;">(</span>caar records<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">(</span>car records<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span>
            <span style="color: #b1951d;">(</span><span style="color: #3a81c3; font-weight: bold;">else</span> <span style="color: #3a81c3;">(</span>assoc key <span style="color: #6c3163;">(</span>cdr records<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #67b11d;">(</span><span style="color: #6c3163; font-weight: bold;">lookup</span> key-1 key-2<span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #b1951d;">(</span><span style="color: #3a81c3;">(</span>subtable <span style="color: #6c3163;">(</span>assoc key-1 <span style="color: #2d9574;">(</span>cdr local-table<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span>
        <span style="color: #b1951d;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> subtable
            <span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #6c3163;">(</span><span style="color: #2d9574;">(</span>record <span style="color: #887070;">(</span>assoc key-2 <span style="color: #3a81c3;">(</span>cdr subtable<span style="color: #3a81c3;">)</span><span style="color: #887070;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
              <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> record
                  <span style="color: #2d9574;">(</span>cdr record<span style="color: #2d9574;">)</span>
                  #f<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
            #f<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #67b11d;">(</span><span style="color: #6c3163; font-weight: bold;">insert!</span> key-1 key-2 value<span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #b1951d;">(</span><span style="color: #3a81c3;">(</span>subtable <span style="color: #6c3163;">(</span>assoc key-1 <span style="color: #2d9574;">(</span>cdr local-table<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span>
        <span style="color: #b1951d;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> subtable
            <span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #6c3163;">(</span><span style="color: #2d9574;">(</span>record <span style="color: #887070;">(</span>assoc key-2 <span style="color: #3a81c3;">(</span>cdr subtable<span style="color: #3a81c3;">)</span><span style="color: #887070;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
              <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> record
                  <span style="color: #2d9574;">(</span>set-cdr! record value<span style="color: #2d9574;">)</span>
                  <span style="color: #2d9574;">(</span>set-cdr! subtable
                            <span style="color: #887070;">(</span>cons <span style="color: #3a81c3;">(</span>cons key-2 value<span style="color: #3a81c3;">)</span>
                                  <span style="color: #3a81c3;">(</span>cdr subtable<span style="color: #3a81c3;">)</span><span style="color: #887070;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
            <span style="color: #3a81c3;">(</span>set-cdr! local-table
                      <span style="color: #6c3163;">(</span>cons <span style="color: #2d9574;">(</span>list key-1
                                  <span style="color: #887070;">(</span>cons key-2 value<span style="color: #887070;">)</span><span style="color: #2d9574;">)</span>
                            <span style="color: #2d9574;">(</span>cdr local-table<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #67b11d;">(</span><span style="color: #6c3163; font-weight: bold;">dispatch</span> m<span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">cond</span> <span style="color: #b1951d;">(</span><span style="color: #3a81c3;">(</span>eq? m 'lookup-proc<span style="color: #3a81c3;">)</span> lookup<span style="color: #b1951d;">)</span>
            <span style="color: #b1951d;">(</span><span style="color: #3a81c3;">(</span>eq? m 'insert-proc!<span style="color: #3a81c3;">)</span> insert!<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    dispatch<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4e669b0" class="outline-3">
<h3 id="org4e669b0">Exercise 3.25</h3>
<div class="outline-text-3" id="text-org4e669b0">
<div class="question" id="org3fe3ce6">
<p>
Generalizing one and two-dimensional tables, show how to implement a table
in which values are stored under an arbitrary number of keys and different
values may be stored under different numbers of keys. The `lookup&rsquo; and
`insert!&rsquo; procedures should take as input a list of keys used to access the
table.
</p>

</div>
</div>

<div id="outline-container-orge485da4" class="outline-4">
<h4 id="orge485da4">Answer</h4>
<div class="outline-text-4" id="text-orge485da4">
<div class="textanswer" id="org640df63">
<p>
The easiest way to accomplish this is to accept variadic arguments to
`insert&rsquo; and `lookup&rsquo;, folding them into a string or using the list
directly (which `equal?&rsquo; can compare)
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-org20905a8" class="outline-3">
<h3 id="org20905a8">Exercise 3.26</h3>
<div class="outline-text-3" id="text-org20905a8">
<div class="question" id="org173296e">
<p>
To search a table as implemented above, one needs to scan through the list
of records. This is basically the unordered list representation of section
*Note 2-3-3. For large tables, it may be more efficient to structure the
table in a different manner. Describe a table implementation where the
(key, value) records are organized using a binary tree, assuming that keys
can be ordered in some way (e.g., numerically or alphabetically). (Compare
Exercise 2-66 of Chapter 2)
</p>

</div>
</div>

<div id="outline-container-org21c52e9" class="outline-4">
<h4 id="org21c52e9">Answer:</h4>
<div class="outline-text-4" id="text-org21c52e9">
<div class="textanswer" id="org8539bed">
<p>
The value that is to be inserted is converted into it&rsquo;s numeric form. Insert &amp;
Lookup function as you would expect
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-org9d7e1a0" class="outline-3">
<h3 id="org9d7e1a0">Exercise 3.27</h3>
<div class="outline-text-3" id="text-org9d7e1a0">
<div class="question" id="orgf450f8e">
<p>
&ldquo;Memoization&rdquo; (also called &ldquo;tabulation&rdquo;) is a technique that enables a
procedure to record, in a local table, values that have previously been
computed. This technique can make a vast difference in the performance of a
program. A memoized procedure maintains a table in which values of previous
calls are stored using as keys the arguments that produced the values. When
the memoized procedure is asked to compute a value, it first checks the
table to see if the value is already there and, if so, just returns that
value. Otherwise, it computes the new value in the ordinary way and stores
this in the table. As an example of memoization, recall from section
1-2-2 the exponential process for computing Fibonacci numbers:
</p>

<p>
(define (fib n)
  (cond ((= n 0) 0)
    ((= n 1) 1)
  (else (+ (fib (- n 1))
    (fib (- n 2))))))
</p>

<p>
The memoized version of the same procedure is
</p>

<p>
(define memo-fib
  (memoize (lambda (n)
  (cond ((= n 0) 0)
    ((= n 1) 1)
  (else (+ (memo-fib (- n 1))
    (memo-fib (- n 2))))))))
</p>

<p>
where the memoizer is defined as
</p>

<p>
(define (memoize f)
  (let ((table (make-table)))
    (lambda (x)
      (let ((previously-computed-result (lookup x table)))
       (or previously-computed-result
      (let ((result (f x)))
        (insert! x result table)
  result))))))
</p>

<p>
Draw an environment diagram to analyze the computation of `(memo-fib
3)&rsquo;. Explain why `memo-fib&rsquo; computes the nth Fibonacci number in a number
of steps proportional to n. Would the scheme still work if we had simply
defined `memo-fib&rsquo; to be `(memoize fib)&rsquo;?
</p>

</div>
</div>

<div id="outline-container-orgd61ca3b" class="outline-4">
<h4 id="orgd61ca3b">Answer:</h4>
<div class="outline-text-4" id="text-orgd61ca3b">
<div class="textanswer" id="orga6de9cf">
<p>
memo-fib is O(N) because the fibonacci sequence can simply be computed in
2*(Σ(N)) steps (half of which are &rsquo;precomputed&rsquo;)
The scheme would not work if each function were freshly memoized because
the `table&rsquo; would not be shared between the various applications of
`memo-fib&rsquo;. 
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-orgfed4f11" class="outline-3">
<h3 id="orgfed4f11">Exercise 3.28</h3>
<div class="outline-text-3" id="text-orgfed4f11">
<div class="question" id="org57b8e90">
<p>
Define an or-gate as a primitive function box. Your or-gate constructor should
be similar to and-gate.
</p>

</div>
</div>

<div id="outline-container-org6bc59ee" class="outline-4">
<h4 id="org6bc59ee">Answer</h4>
<div class="outline-text-4" id="text-org6bc59ee">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163; font-weight: bold;">or-gate-delay</span> <span style="color: #4e3163;">5</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">or-gate</span> a1 a2 output<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #2d9574;">(</span><span style="color: #6c3163; font-weight: bold;">or-action-procedure</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #67b11d;">(</span><span style="color: #b1951d;">(</span>new-value
           <span style="color: #3a81c3;">(</span>logior <span style="color: #6c3163;">(</span>signal-value a1<span style="color: #6c3163;">)</span>
                   <span style="color: #6c3163;">(</span>signal-value a2<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span>after-delay
       or-gate-delay
       <span style="color: #b1951d;">(</span><span style="color: #3a81c3; font-weight: bold;">&#955;</span> <span style="color: #3a81c3;">()</span>
         <span style="color: #3a81c3;">(</span>set-signal! output new-value<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>add-action! a1 or-action-procedure<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>add-action! a2 or-action-procedure<span style="color: #6c3163;">)</span>
  'ok<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org495ed30" class="outline-3">
<h3 id="org495ed30">Exercise 3.29</h3>
<div class="outline-text-3" id="text-org495ed30">
<div class="question" id="orgeb7a182">
<p>
Another way to construct an or-gate is as a compound digital logic device, built
from and-gates and inverters. Define a procedure or-gate that accomplishes this.
What is the delay time of the or-gate in terms of and-gate-delay and
inverter-delay? 
</p>

</div>
</div>

<div id="outline-container-org9a012ca" class="outline-4">
<h4 id="org9a012ca">Answer</h4>
<div class="outline-text-4" id="text-org9a012ca">
<div class="question" id="org084aaf0">
<p>
(!a1) &amp;&amp; a2 is congruent to a1 || a2, it is as fast as (AND-DELAY + INVERTER<sub>DELAY</sub>)
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-org6c9d1c3" class="outline-3">
<h3 id="org6c9d1c3"><span class="todo TODO">TODO</span> Exercise 3.30</h3>
<div class="outline-text-3" id="text-org6c9d1c3">
<div class="question" id="org829618c">
<p>
Figure 3.27 shows a ripple-carry adder formed by stringing together n
full-adders. This is the simplest form of parallel adder for adding two n -bit
binary numbers. The inputs A 1 , A 2 , A 3 , …, A n and B 1 , B 2 , B 3 , …, B n
are the two binary numbers to be added (each A k and B k is a 0 or a 1). The
circuit generates S 1 , S 2 , S 3 , …, S n , the n bits of the sum, and C , the
carry from the addition. Write a procedure ripple-carry-adder that generates
this circuit. The procedure should take as arguments three lists of n wires
each—the A k , the B k , and the S k —and also another wire C . The major
drawback of the ripple-carry adder is the need to wait for the carry signals to
propagate. What is the delay needed to obtain the complete output from an n -bit
ripple-carry adder, expressed in terms of the delays for and-gates, or-gates,
and inverters?
</p>

</div>
</div>
</div>

<div id="outline-container-org3f5d17e" class="outline-3">
<h3 id="org3f5d17e">Exercise 3.31</h3>
<div class="outline-text-3" id="text-org3f5d17e">
<div class="question" id="org2f17226">
<p>
The internal procedure `accept-action-procedure!&rsquo; defined in make-wire specifies
that when a new action procedure is added to a wire, the procedure is
immediately run. Explain why this initialization is necessary. In particular,
trace through the half-adder example in the paragraphs above and say how the
system’s response would differ if we had defined accept-action-procedure! as
</p>

<p>
(define (accept-action-procedure! proc)
  (set! action-procedures (cons proc action-procedures)))
</p>

</div>
</div>

<div id="outline-container-orge10b395" class="outline-4">
<h4 id="orge10b395">Answer:</h4>
<div class="outline-text-4" id="text-orge10b395">
<div class="question" id="org282543e">
<p>
the signal value must be initialized or the entire system will run the action
procedures (no matter what has changed)
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-org7f20207" class="outline-3">
<h3 id="org7f20207"><span class="todo TODO">TODO</span> Exercise 3.32</h3>
<div class="outline-text-3" id="text-org7f20207">
<div class="question" id="org1145e39">
<p>
The procedures to be run during each time segment of the agenda are kept in a
queue. Thus, the procedures for each segment are called in the order in which
they were added to the agenda (first in, first out). Explain why this order must
be used. In particular, trace the behavior of an and-gate whose inputs change
from 0, 1 to 1, 0 in the same segment and say how the behavior would differ if
we stored a segment’s procedures in an ordinary list, adding and removing
procedures only at the front (last in, first out).
</p>

</div>
</div>
</div>

<div id="outline-container-org590b0b6" class="outline-3">
<h3 id="org590b0b6">Exercise 3.33</h3>
<div class="outline-text-3" id="text-org590b0b6">
<div class="question" id="orga191403">
<p>
Using primitive multiplier, adder, and constant constraints, define a procedure
averager that takes three connectors a, b, and c as inputs and establishes the
constraint that the value of c is the average of the values of a and b. 
</p>

</div>
</div>

<div id="outline-container-orga6308a5" class="outline-4">
<h4 id="orga6308a5">Answer</h4>
<div class="outline-text-4" id="text-orga6308a5">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">averager</span> a b c<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>with-connectors <span style="color: #2d9574;">(</span>half sum<span style="color: #2d9574;">)</span>
                   <span style="color: #2d9574;">(</span>constant <span style="color: #4e3163;">0.5</span> half<span style="color: #2d9574;">)</span>
                   <span style="color: #2d9574;">(</span>adder a b sum<span style="color: #2d9574;">)</span>
                   <span style="color: #2d9574;">(</span>multiplier half sum c<span style="color: #2d9574;">)</span>
                   'ok<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd4cde4f" class="outline-3">
<h3 id="orgd4cde4f">Exercise 3.34</h3>
<div class="outline-text-3" id="text-orgd4cde4f">
<div class="question" id="orgb23a285">
<p>
Louis Reasoner wants to build a squarer, a constraint device with two terminals
such that the value of connector b on the second terminal will always be the
square of the value a on the first terminal. He proposes the following simple
device made from a multiplier:
</p>

<p>
(define (squarer a b) (multiplier a a b))
</p>

<p>
There is a serious flaw in this idea. Explain.
</p>

</div>
</div>

<div id="outline-container-orgc79a7be" class="outline-4">
<h4 id="orgc79a7be">Answer</h4>
<div class="outline-text-4" id="text-orgc79a7be">
<div class="textanswer" id="org5ac9288">
<p>
The value of `a&rsquo; is not &ldquo;duplicated&rdquo; across &#x2013; so `process-new-value&rsquo; only reads either `rhs&rsquo; or `lhs&rsquo;&rsquo;s value
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-org1b34dd6" class="outline-3">
<h3 id="org1b34dd6">Exercise 3.35</h3>
<div class="outline-text-3" id="text-org1b34dd6">
<div class="question" id="orgee44f1b">
<p>
Ben Bitdiddle tells Louis that one way to avoid the trouble in
Exercise 3.34 is to define a squarer as a new primitive constraint. Fill in the
missing portions in Ben’s outline for a procedure to implement such a
constraint:
</p>

<p>
(define (squarer a b)
(define (process-new-value)
(if (has-value? b)
(if (&lt; (get-value b) 0)
(error &ldquo;square less than 0:
SQUARER&rdquo;
(get-value b))
⟨alternative1⟩)
⟨alternative2⟩))
(define (process-forget-value) ⟨body1⟩)
(define (me request) ⟨body2⟩)
⟨rest of definition⟩
me)
</p>

</div>
</div>

<div id="outline-container-orgbdea1f8" class="outline-4">
<h4 id="orgbdea1f8">Answer</h4>
<div class="outline-text-4" id="text-orgbdea1f8">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define-class</span> <span style="color: #ba2f59; font-weight: bold;">&lt;squarer&gt;</span> <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">&lt;constraint&gt;</span><span style="color: #6c3163;">)</span>
  <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">in squarer, there is essentially only one value</span>
  <span style="color: #6c3163;">(</span>rhs <span style="color: #3a81c3;">#:allocation</span> <span style="color: #3a81c3;">#:virtual</span>
       <span style="color: #3a81c3;">#:slot-ref</span> <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">lambda</span> <span style="color: #67b11d;">(</span>o<span style="color: #67b11d;">)</span> <span style="color: #67b11d;">(</span>slot-ref o 'lhs<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
       <span style="color: #3a81c3;">#:slot-set!</span> <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">lambda</span> <span style="color: #67b11d;">(</span>o s<span style="color: #67b11d;">)</span> <span style="color: #67b11d;">(</span>slot-set! o 'lhs s<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">strictly speaking these are not nessasary, as they are defined directly in</span>
  <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">`process-new-value', they are kept for posteriety.</span>
  <span style="color: #6c3163;">(</span>operator <span style="color: #3a81c3;">#:init-value</span> square<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>inverse-operator <span style="color: #3a81c3;">#:init-value</span> sqrt<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define-method</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">process-new-value</span> <span style="color: #2d9574;">(</span>c <span style="color: #ba2f59; font-weight: bold;">&lt;squarer&gt;</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">let*</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">[</span>lhs-conn <span style="color: #b1951d;">(</span>lhs c<span style="color: #b1951d;">)</span><span style="color: #67b11d;">]</span>
         <span style="color: #67b11d;">[</span>total-conn <span style="color: #b1951d;">(</span>total c<span style="color: #b1951d;">)</span><span style="color: #67b11d;">]</span>
         <span style="color: #67b11d;">[</span>has-total? <span style="color: #b1951d;">(</span>has-value? total-conn<span style="color: #b1951d;">)</span><span style="color: #67b11d;">]</span>
         <span style="color: #67b11d;">[</span>has-lhs? <span style="color: #b1951d;">(</span>has-value? lhs-conn<span style="color: #b1951d;">)</span><span style="color: #67b11d;">]</span><span style="color: #2d9574;">)</span>
    <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Determine what values *are* known and set the appropriate connector.</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">cond</span>
     <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(lhs &lt; 0) =&gt; error</span>
     <span style="color: #67b11d;">[</span><span style="color: #b1951d;">(</span><span style="color: #3a81c3; font-weight: bold;">and</span> <span style="color: #3a81c3;">(</span>has-lhs?
            <span style="color: #6c3163;">(</span>&lt; <span style="color: #2d9574;">(</span>connector-value lhs-conn<span style="color: #2d9574;">)</span> <span style="color: #4e3163;">0</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span>
      <span style="color: #b1951d;">(</span>error <span style="color: #2d9574;">"square less than 0: SQUARER"</span> <span style="color: #3a81c3;">(</span>connector-value lhs-conn<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">]</span>

     <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">lhs = &#8730;total</span>
     <span style="color: #67b11d;">[</span>has-total?
      <span style="color: #b1951d;">(</span>set-value! lhs-conn <span style="color: #3a81c3;">(</span>sqrt <span style="color: #6c3163;">(</span>connector-value total-conn<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span> c<span style="color: #b1951d;">)</span><span style="color: #67b11d;">]</span>

     <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">total = lh&#178;</span>
     <span style="color: #67b11d;">[</span>has-lhs?
      <span style="color: #b1951d;">(</span>set-value! total-conn <span style="color: #3a81c3;">(</span>square <span style="color: #6c3163;">(</span>connector-value lhs-conn<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span> c<span style="color: #b1951d;">)</span><span style="color: #67b11d;">]</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define-method</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">process-forget-value</span> <span style="color: #2d9574;">(</span>c <span style="color: #ba2f59; font-weight: bold;">&lt;squarer&gt;</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>forget-value! <span style="color: #2d9574;">(</span>lhs c<span style="color: #2d9574;">)</span> c<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>forget-value! <span style="color: #2d9574;">(</span>total c<span style="color: #2d9574;">)</span> c<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>process-new-value c<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1bbd6db" class="outline-3">
<h3 id="org1bbd6db"><span class="todo TODO">TODO</span> Exercise 3.36</h3>
<div class="outline-text-3" id="text-org1bbd6db">
<div class="question" id="orgdba712c">
<p>
Suppose we evaluate the following sequence of expressions in the global
environment:
</p>

<p>
(define a (make-connector)) (define b (make-connector)) (set-value! a 10 &rsquo;user)
</p>

<p>
At some time during evaluation of the set-value!, the following expression from
the connector’s local procedure is evaluated:
</p>

<p>
(for-each-except setter inform-about-value constraints)
</p>

<p>
Draw an environment diagram showing the environment in which the above
expression is evaluated.
</p>

</div>
</div>
</div>

<div id="outline-container-org7ab501c" class="outline-3">
<h3 id="org7ab501c">Exercise 3.37</h3>
<div class="outline-text-3" id="text-org7ab501c">
<div class="question" id="orgfc232f7">
<p>
The celsius-fahrenheit-converter procedure is cumbersome when compared with a
more expression-oriented style of definition, such as
</p>

<p>
(define (celsius-fahrenheit-converter x)
   (c+ (c* (c/ (cv 9) (cv 5)) x) 
</p>

<p>
(cv 32)))
</p>

<p>
(define C (make-connector))
(define F (celsius-fahrenheit-converter C))
</p>

<p>
Here c+, c*, etc. are the “constraint” versions of the arithmetic operations.
For example, c+ takes two connectors as arguments and returns a connector that
is related to these by an adder constraint:
</p>

<p>
(define (c+ x y)
   (let ((z (make-connector))) (adder x y z) z))
</p>

<p>
Define analogous procedures c-, c*, c/, and cv (constant value) that enable us
to define compound constraints as in the converter example above.
</p>

</div>
</div>

<div id="outline-container-orge7d9f8f" class="outline-4">
<h4 id="orge7d9f8f">Answer</h4>
<div class="outline-text-4" id="text-orge7d9f8f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">c+</span> augend addend<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>with-connectors <span style="color: #2d9574;">(</span>sum<span style="color: #2d9574;">)</span>
                   <span style="color: #2d9574;">(</span>adder augend addend sum<span style="color: #2d9574;">)</span>
                   sum<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">c-</span> minuend subtrahend<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>with-connectors <span style="color: #2d9574;">(</span>difference<span style="color: #2d9574;">)</span>
                   <span style="color: #2d9574;">(</span>adder difference subtrahend minuend<span style="color: #2d9574;">)</span>
                   difference<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">c*</span> multiplicand m2<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>with-connectors <span style="color: #2d9574;">(</span>product<span style="color: #2d9574;">)</span>
                   <span style="color: #2d9574;">(</span>multiplier multiplicand  m2 product<span style="color: #2d9574;">)</span>
                   product<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">c/</span> dividend divisor<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>with-connectors <span style="color: #2d9574;">(</span>quotient<span style="color: #2d9574;">)</span>
                   <span style="color: #2d9574;">(</span>multiplier quotient divisor dividend<span style="color: #2d9574;">)</span>
                   quotient<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">define</span> <span style="color: #6c3163;">(</span><span style="color: #6c3163; font-weight: bold;">cv</span> value<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>with-connectors <span style="color: #2d9574;">(</span>result<span style="color: #2d9574;">)</span>
                   <span style="color: #2d9574;">(</span>constant value result<span style="color: #2d9574;">)</span>
                   result<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgee419c7" class="outline-3">
<h3 id="orgee419c7">Exercise 3.38</h3>
<div class="outline-text-3" id="text-orgee419c7">
<div class="question" id="org6b37b50">
<p>
Suppose that Peter, Paul, and Mary share a joint bank account that initially
contains $100. Concurrently, Peter deposits $10, Paul withdraws $20, and Mary
withdraws half the money in the account, by executing the following commands:
</p>

<p>
Peter: (set! balance (+ balance 10))
Paul:  (set! balance (- balance 20))
Mary:  (set! balance (- balance (/ balance 2)))
</p>

<ol class="org-ol">
<li>List all the different possible values for balance after these three
transactions have been completed, assuming that the banking system forces the
three processes to run sequentially in some order.</li>

<li>What are some other values that could be produced if the system allows the
processes to be interleaved? Draw timing diagrams like the one in Figure 3.29 to
explain how these values can occur.</li>
</ol>

</div>
</div>
<div id="outline-container-orgb393a14" class="outline-4">
<h4 id="orgb393a14">Answer</h4>
<div class="outline-text-4" id="text-orgb393a14">
<div class="question" id="orgea16b8c">
<p>
Peter-&gt;Paul-&gt;Mary: (calc-eval &ldquo;((100+10)-20)/2&rdquo;)       =&gt; 45
Peter-&gt;Mary-&gt;Paul: (calc-eval &ldquo;((100+10)/2)-20&rdquo;)       =&gt; 35
Mary-&gt;Paul-&gt;Peter: (calc-eval &ldquo;((100 / 2) - 20) + 20&rdquo;) =&gt; 50
Mary-&gt;Peter-&gt;Paul: (calc-eval &ldquo;((100 / 2) + 10) - 20&rdquo;) =&gt; 40
Paul-&gt;Peter-&gt;Mary: (calc-eval &ldquo;((100 - 20) + 10) / 2&rdquo;) =&gt; 45
Paul-&gt;Mary-&gt;Peter: (calc-eval &ldquo;((100 - 20) / 2) + 10&rdquo;) =&gt; 50
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-org02e9bc0" class="outline-3">
<h3 id="org02e9bc0">Exercise 3.39</h3>
<div class="outline-text-3" id="text-org02e9bc0">
<div class="question" id="orgb4ebf13">
<p>
Which of the five possibilities in the parallel execution shown above remain if
we instead serialize execution as follows:
</p>

<p>
(define x 10)
(define s (make-serializer))
(parallel-execute
  (lambda ()
    (set! x ((s (lambda () (* x x))))))
    (s (lambda () (set! x (+ x 1)))))
</p>

</div>
</div>
<div id="outline-container-org3078f84" class="outline-4">
<h4 id="org3078f84">Answer</h4>
<div class="outline-text-4" id="text-org3078f84">
<div class="question" id="org16df3a0">
<p>
101, 100, 121
</p>

</div>
</div>
</div>
</div>


<div id="outline-container-org6b1ac15" class="outline-3">
<h3 id="org6b1ac15">Exercise 3.40</h3>
<div class="outline-text-3" id="text-org6b1ac15">
<div class="question" id="orgfa353e8">
<p>
Give all possible values of x that can result from executing
</p>

<p>
(define x 10)
(parallel-execute
 (lambda () (set! x (* x x)))
 (lambda () (set! x (* x x x))))
</p>

<p>
Which of these possibilities remain if we instead use serialized procedures:
</p>

<p>
(define x 10)
(define s (make-serializer))
(parallel-execute
 (s (lambda () (set! x (* x x))))
 (s (lambda () (set! x (* x x x)))))
</p>

</div>
</div>
<div id="outline-container-orgd87b86d" class="outline-4">
<h4 id="orgd87b86d">Answer</h4>
<div class="outline-text-4" id="text-orgd87b86d">
<div class="question" id="orgf642650">
<p>
x*6 (multiplication is commutative)
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-org7ccf13b" class="outline-3">
<h3 id="org7ccf13b">Exercise 3.41</h3>
<div class="outline-text-3" id="text-org7ccf13b">
<div class="question" id="orgac9e41a">
<p>
Ben Bitdiddle worries that it would be better to implement the bank account as
follows (where the commented line has been changed):
</p>

<p>
(define (make-account balance)
  (define (withdraw amount)
    (if (&gt;= balance amount)
        (begin
          (set! balance
            (- balance amount))
          balance)
        &ldquo;Insufficient funds&rdquo;))
  (define (deposit amount)
    (set! balance (+ balance amount))
    balance)
  (let ((protected (make-serializer)))
    (define (dispatch m)
      (cond ((eq? m &rsquo;withdraw)
            (protected withdraw))
            ((eq? m &rsquo;deposit)
            (protected deposit))
            ((eq? m &rsquo;balance)
            ((protected
              (lambda ()
                balance)))) ; serialized
            (else
            (error
              &ldquo;Unknown request:
  MAKE-ACCOUNT&rdquo;
              m))))
    dispatch))
</p>

<p>
because allowing unserialized access to the bank balance can result in anomalous
behavior. Do you agree? Is there any scenario that demonstrates Ben’s concern?
</p>

</div>
</div>

<div id="outline-container-orgfa7459f" class="outline-4">
<h4 id="orgfa7459f">Answer</h4>
<div class="outline-text-4" id="text-orgfa7459f">
<div class="textanswer" id="org77f997a">
<p>
First off, this question is phrased in a really shitty way. Second off, no
<b>BALANCE</b> is safe. the other functions are <b>UNSAFE</b>
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-orgbab6b97" class="outline-3">
<h3 id="orgbab6b97">Exercise 3.42</h3>
<div class="outline-text-3" id="text-orgbab6b97">
<div class="question" id="org1bd0778">
<p>
Ben Bitdiddle suggests that it’s a waste of time to create a new serialized
procedure in response to every withdraw and deposit message. He says that
make-account could be changed so that the calls to protected are done outside
the dispatch procedure. That is, an account would return the same serialized
procedure (which was created at the same time as the account) each time it is
asked for a withdrawal procedure.
</p>

<p>
(define (make-account balance)
  (define (withdraw amount)
    (if (&gt;= balance amount)
        (begin (set! balance
                (- balance amount))
              balance)
        &ldquo;Insufficient funds&rdquo;))
  (define (deposit amount)
    (set! balance (+ balance amount))
    balance)
  (let ((protected (make-serializer)))
    (let ((protected-withdraw
          (protected withdraw))
          (protected-deposit
          (protected deposit)))
      (define (dispatch m)
        (cond ((eq? m &rsquo;withdraw)
              protected-withdraw)
              ((eq? m &rsquo;deposit)
              protected-deposit)
              ((eq? m &rsquo;balance)
              balance)
              (else
              (error &ldquo;Unknown request: MAKE-ACCOUNT&rdquo;
                      m))))
      dispatch)))
</p>

</div>
</div>

<div id="outline-container-org6430165" class="outline-4">
<h4 id="org6430165">Answer</h4>
<div class="outline-text-4" id="text-org6430165">
<div class="question" id="org1faeff8">
<p>
This is fine
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-org72ae360" class="outline-3">
<h3 id="org72ae360"><span class="todo TODO">TODO</span> Exercise 3.43</h3>
<div class="outline-text-3" id="text-org72ae360">
<div class="question" id="org0abb544">
<p>
Suppose that the balances in three accounts start out as $10, $20, and $30,
and that multiple processes run, exchanging the balances in the accounts.
Argue that if the processes are run sequentially, after any number of
concurrent exchanges, the account balances should be $10, $20, and $30 in
some order. Draw a timing diagram like the one in *Note Figure 3-29:: to
show how this condition can be violated if the exchanges are implemented
using the first version of the account-exchange program in this section. On
the other hand, argue that even with this `exchange&rsquo; program, the sum of
the balances in the accounts will be preserved. Draw a timing diagram to
show how even this condition would be violated if we did not serialize the
transactions on individual accounts. 
</p>

</div>
</div>
<div id="outline-container-org1d28566" class="outline-4">
<h4 id="org1d28566">Answer</h4>
<div class="outline-text-4" id="text-org1d28566">
<div class="textanswer" id="orgb85b171">
<p>
SKIPPED: Timing diagram
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-org0053acb" class="outline-3">
<h3 id="org0053acb"><span class="todo TODO">TODO</span> Exercise 3.47</h3>
<div class="outline-text-3" id="text-org0053acb">
<div class="question" id="orga6a927d">
<p>
A semaphore (of size n ) is a generalization of a mutex. Like a mutex, a
semaphore supports acquire and release operations, but it is more general in
that up to n processes can acquire it concurrently. Additional processes that
attempt to acquire the semaphore must wait for release operations. Give
implementations of semaphores
</p>

<ol class="org-ol">
<li>In terms of mutexes</li>
<li>In terms of atomic test-and-set! operations.</li>
</ol>

</div>
</div>
</div>
</section>
